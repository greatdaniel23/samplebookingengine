{
  "version": 3,
  "sources": ["../src/workers/routes/rooms.ts", "../src/workers/routes/packages.ts", "../src/workers/routes/villa.ts", "../src/workers/routes/payment.ts", "../src/workers/index.ts"],
  "sourceRoot": "./dist-worker",
  "sourcesContent": ["import { Env } from '../types';\r\n\r\nexport async function handleRooms(url: URL, method: string, body: any, env: Env): Promise<Response> {\r\n  const pathParts = url.pathname.split('/').filter(Boolean);\r\n\r\n  const parseRoom = (room: any) => {\r\n    try {\r\n      if (room.amenities && typeof room.amenities === 'string') room.amenities = JSON.parse(room.amenities);\r\n      if (room.images && typeof room.images === 'string') room.images = JSON.parse(room.images);\r\n      if (room.features && typeof room.features === 'string') room.features = JSON.parse(room.features);\r\n    } catch (e) {\r\n      console.error('Error parsing room data:', e);\r\n      if (typeof room.amenities === 'string') room.amenities = [];\r\n      if (typeof room.images === 'string') room.images = [];\r\n      if (typeof room.features === 'string') room.features = [];\r\n    }\r\n    return room;\r\n  };\r\n\r\n  // GET /api/rooms - list all rooms\r\n  if (pathParts.length === 2 && method === 'GET') {\r\n    try {\r\n      const { searchParams } = url;\r\n      const includeAll = searchParams.get('all') === 'true';\r\n\r\n      const query = includeAll\r\n        ? 'SELECT * FROM rooms ORDER BY name'\r\n        : 'SELECT * FROM rooms WHERE is_active = 1 ORDER BY name';\r\n\r\n      const result = await env.DB.prepare(query).all();\r\n\r\n      const rooms = result.results.map(parseRoom);\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        data: rooms\r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // GET /api/rooms/:id - get single room\r\n  if (pathParts.length === 3 && method === 'GET') {\r\n    try {\r\n      const id = parseInt(pathParts[2]);\r\n      const result = await env.DB.prepare(\r\n        'SELECT * FROM rooms WHERE id = ?'\r\n      ).bind(id).first();\r\n\r\n      if (!result) {\r\n        return new Response(JSON.stringify({\r\n          success: false,\r\n          error: 'Room not found'\r\n        }), {\r\n          status: 404,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Access-Control-Allow-Origin': '*',\r\n          },\r\n        });\r\n      }\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        data: parseRoom(result)\r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // POST /api/rooms - create new room\r\n  if (pathParts.length === 2 && method === 'POST') {\r\n    try {\r\n      const { name, type, description, price_per_night, max_guests, amenities, images } = body;\r\n\r\n      if (!name) {\r\n        return new Response(JSON.stringify({\r\n          success: false,\r\n          error: 'Room name is required'\r\n        }), {\r\n          status: 400,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Access-Control-Allow-Origin': '*',\r\n          },\r\n        });\r\n      }\r\n\r\n      const result = await env.DB.prepare(\r\n        `INSERT INTO rooms (name, type, description, price_per_night, max_guests, amenities, images, is_active, created_at, updated_at) \r\n         VALUES (?, ?, ?, ?, ?, ?, ?, 1, datetime('now'), datetime('now'))`\r\n      ).bind(\r\n        name,\r\n        type || 'Standard',\r\n        description || '',\r\n        price_per_night || 0,\r\n        max_guests || 2,\r\n        JSON.stringify(amenities || []),\r\n        JSON.stringify(images || [])\r\n      ).run();\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        data: { id: result.meta.last_row_id, name, type },\r\n        message: 'Room created successfully'\r\n      }), {\r\n        status: 201,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // PUT /api/rooms/:id - update room\r\n  if (pathParts.length === 3 && method === 'PUT') {\r\n    try {\r\n      const id = parseInt(pathParts[2]);\r\n      const { name, type, description, price_per_night, max_guests, amenities, images, is_active } = body;\r\n\r\n      const updates: string[] = [];\r\n      const values: any[] = [];\r\n\r\n      if (name !== undefined) { updates.push('name = ?'); values.push(name); }\r\n      if (type !== undefined) { updates.push('type = ?'); values.push(type); }\r\n      if (description !== undefined) { updates.push('description = ?'); values.push(description); }\r\n      if (price_per_night !== undefined) { updates.push('price_per_night = ?'); values.push(price_per_night); }\r\n      if (max_guests !== undefined) { updates.push('max_guests = ?'); values.push(max_guests); }\r\n      if (amenities !== undefined) { updates.push('amenities = ?'); values.push(JSON.stringify(amenities)); }\r\n      if (images !== undefined) { updates.push('images = ?'); values.push(JSON.stringify(images)); }\r\n      if (is_active !== undefined) { updates.push('is_active = ?'); values.push(is_active ? 1 : 0); }\r\n\r\n      updates.push(\"updated_at = datetime('now')\");\r\n      values.push(id);\r\n\r\n      await env.DB.prepare(\r\n        `UPDATE rooms SET ${updates.join(', ')} WHERE id = ?`\r\n      ).bind(...values).run();\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        message: 'Room updated successfully'\r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // DELETE /api/rooms/:id - delete room (soft delete)\r\n  if (pathParts.length === 3 && method === 'DELETE') {\r\n    try {\r\n      const id = parseInt(pathParts[2]);\r\n\r\n      await env.DB.prepare(\r\n        \"UPDATE rooms SET is_active = 0, updated_at = datetime('now') WHERE id = ?\"\r\n      ).bind(id).run();\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        message: 'Room deleted successfully'\r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  return new Response(JSON.stringify({\r\n    success: false,\r\n    error: 'Invalid rooms endpoint'\r\n  }), {\r\n    status: 404,\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Access-Control-Allow-Origin': '*',\r\n    },\r\n  });\r\n}\r\n", "import { Env } from '../types';\r\n\r\nexport async function handlePackages(url: URL, method: string, body: any, env: Env): Promise<Response> {\r\n  const pathParts = url.pathname.split('/').filter(Boolean);\r\n\r\n  const parsePackage = (pkg: any) => {\r\n    try {\r\n      if (pkg.images && typeof pkg.images === 'string') pkg.images = JSON.parse(pkg.images);\r\n      // Parse other JSON fields if any\r\n    } catch (e) {\r\n      console.error('Error parsing package data:', e);\r\n      if (typeof pkg.images === 'string') pkg.images = [];\r\n    }\r\n    return pkg;\r\n  };\r\n\r\n  // GET /api/packages - list all packages\r\n  if (pathParts.length === 2 && method === 'GET') {\r\n    try {\r\n      const result = await env.DB.prepare(\r\n        'SELECT * FROM packages WHERE is_active = 1 ORDER BY name'\r\n      ).all();\r\n\r\n      const packages = result.results.map(parsePackage);\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        data: packages\r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // GET /api/packages/:id - get single package\r\n  if (pathParts.length === 3 && method === 'GET') {\r\n    try {\r\n      const id = parseInt(pathParts[2]);\r\n      const result = await env.DB.prepare(\r\n        'SELECT * FROM packages WHERE id = ?'\r\n      ).bind(id).first();\r\n\r\n      if (!result) {\r\n        return new Response(JSON.stringify({\r\n          success: false,\r\n          error: 'Package not found'\r\n        }), {\r\n          status: 404,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Access-Control-Allow-Origin': '*',\r\n          },\r\n        });\r\n      }\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        data: parsePackage(result)\r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // GET /api/packages/:id/rooms - get package rooms\r\n  if (pathParts.length === 4 && pathParts[3] === 'rooms' && method === 'GET') {\r\n    try {\r\n      const packageId = parseInt(pathParts[2]);\r\n      const includeInactive = url.searchParams.get('include_inactive') === '1';\r\n      \r\n      const query = includeInactive\r\n        ? `SELECT pr.*, r.name as room_name, r.description as room_description, r.images as room_images\r\n           FROM package_rooms pr\r\n           JOIN rooms r ON pr.room_id = r.id\r\n           WHERE pr.package_id = ?\r\n           ORDER BY pr.is_default DESC, pr.availability_priority`\r\n        : `SELECT pr.*, r.name as room_name, r.description as room_description, r.images as room_images\r\n           FROM package_rooms pr\r\n           JOIN rooms r ON pr.room_id = r.id\r\n           WHERE pr.package_id = ? AND pr.is_active = 1\r\n           ORDER BY pr.is_default DESC, pr.availability_priority`;\r\n      \r\n      const result = await env.DB.prepare(query).bind(packageId).all();\r\n      \r\n      // Parse room_images JSON field\r\n      const rooms = result.results.map((room: any) => {\r\n        if (room.room_images && typeof room.room_images === 'string') {\r\n          try {\r\n            room.images = JSON.parse(room.room_images);\r\n          } catch {\r\n            room.images = [];\r\n          }\r\n        } else {\r\n          room.images = room.room_images || [];\r\n        }\r\n        delete room.room_images;\r\n        return room;\r\n      });\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        data: rooms\r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // POST /api/packages/:id/rooms - add room to package\r\n  if (pathParts.length === 4 && pathParts[3] === 'rooms' && method === 'POST') {\r\n    try {\r\n      const packageId = parseInt(pathParts[2]);\r\n      const { \r\n        room_id, \r\n        is_default = 0, \r\n        price_adjustment = 0, \r\n        adjustment_type = 'fixed',\r\n        availability_priority = 1,\r\n        max_occupancy_override = null,\r\n        description = null\r\n      } = body;\r\n\r\n      if (!room_id) {\r\n        return new Response(JSON.stringify({\r\n          success: false,\r\n          error: 'room_id is required'\r\n        }), {\r\n          status: 400,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Access-Control-Allow-Origin': '*',\r\n          },\r\n        });\r\n      }\r\n\r\n      // Check if relationship already exists\r\n      const existing = await env.DB.prepare(\r\n        'SELECT * FROM package_rooms WHERE package_id = ? AND room_id = ?'\r\n      ).bind(packageId, room_id).first();\r\n\r\n      if (existing) {\r\n        // Reactivate if soft-deleted\r\n        await env.DB.prepare(\r\n          `UPDATE package_rooms \r\n           SET is_active = 1, is_default = ?, price_adjustment = ?, adjustment_type = ?, \r\n               availability_priority = ?, max_occupancy_override = ?, description = ?\r\n           WHERE package_id = ? AND room_id = ?`\r\n        ).bind(\r\n          is_default ? 1 : 0,\r\n          price_adjustment,\r\n          adjustment_type,\r\n          availability_priority,\r\n          max_occupancy_override,\r\n          description,\r\n          packageId,\r\n          room_id\r\n        ).run();\r\n\r\n        return new Response(JSON.stringify({\r\n          success: true,\r\n          message: 'Room relationship updated'\r\n        }), {\r\n          status: 200,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Access-Control-Allow-Origin': '*',\r\n          },\r\n        });\r\n      }\r\n\r\n      // If setting as default, unset other defaults first\r\n      if (is_default) {\r\n        await env.DB.prepare(\r\n          'UPDATE package_rooms SET is_default = 0 WHERE package_id = ?'\r\n        ).bind(packageId).run();\r\n      }\r\n\r\n      const result = await env.DB.prepare(\r\n        `INSERT INTO package_rooms (package_id, room_id, is_default, price_adjustment, adjustment_type, availability_priority, max_occupancy_override, description, is_active) \r\n         VALUES (?, ?, ?, ?, ?, ?, ?, ?, 1)`\r\n      ).bind(\r\n        packageId,\r\n        room_id,\r\n        is_default ? 1 : 0,\r\n        price_adjustment,\r\n        adjustment_type,\r\n        availability_priority,\r\n        max_occupancy_override,\r\n        description\r\n      ).run();\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        data: { id: result.meta.last_row_id },\r\n        message: 'Room added to package'\r\n      }), {\r\n        status: 201,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // PUT /api/packages/rooms/:id - update package room relationship\r\n  if (pathParts.length === 4 && pathParts[2] === 'rooms' && method === 'PUT') {\r\n    try {\r\n      const relationshipId = parseInt(pathParts[3]);\r\n      const { \r\n        is_default, \r\n        price_adjustment, \r\n        adjustment_type,\r\n        availability_priority,\r\n        max_occupancy_override,\r\n        description,\r\n        is_active\r\n      } = body;\r\n\r\n      const updates: string[] = [];\r\n      const values: any[] = [];\r\n\r\n      if (is_default !== undefined) {\r\n        // If setting as default, get the package_id first\r\n        if (is_default) {\r\n          const rel = await env.DB.prepare(\r\n            'SELECT package_id FROM package_rooms WHERE id = ?'\r\n          ).bind(relationshipId).first() as any;\r\n          if (rel) {\r\n            await env.DB.prepare(\r\n              'UPDATE package_rooms SET is_default = 0 WHERE package_id = ?'\r\n            ).bind(rel.package_id).run();\r\n          }\r\n        }\r\n        updates.push('is_default = ?');\r\n        values.push(is_default ? 1 : 0);\r\n      }\r\n      if (price_adjustment !== undefined) { updates.push('price_adjustment = ?'); values.push(price_adjustment); }\r\n      if (adjustment_type !== undefined) { updates.push('adjustment_type = ?'); values.push(adjustment_type); }\r\n      if (availability_priority !== undefined) { updates.push('availability_priority = ?'); values.push(availability_priority); }\r\n      if (max_occupancy_override !== undefined) { updates.push('max_occupancy_override = ?'); values.push(max_occupancy_override); }\r\n      if (description !== undefined) { updates.push('description = ?'); values.push(description); }\r\n      if (is_active !== undefined) { updates.push('is_active = ?'); values.push(is_active ? 1 : 0); }\r\n\r\n      if (updates.length === 0) {\r\n        return new Response(JSON.stringify({\r\n          success: false,\r\n          error: 'No fields to update'\r\n        }), {\r\n          status: 400,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Access-Control-Allow-Origin': '*',\r\n          },\r\n        });\r\n      }\r\n\r\n      values.push(relationshipId);\r\n\r\n      await env.DB.prepare(\r\n        `UPDATE package_rooms SET ${updates.join(', ')} WHERE id = ?`\r\n      ).bind(...values).run();\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        message: 'Package room relationship updated'\r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // DELETE /api/packages/rooms/:id - soft delete package room relationship\r\n  if (pathParts.length === 4 && pathParts[2] === 'rooms' && method === 'DELETE') {\r\n    try {\r\n      const relationshipId = parseInt(pathParts[3]);\r\n\r\n      await env.DB.prepare(\r\n        'UPDATE package_rooms SET is_active = 0 WHERE id = ?'\r\n      ).bind(relationshipId).run();\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        message: 'Room removed from package'\r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // GET /api/packages/:id/inclusions - get package inclusions\r\n  if (pathParts.length === 4 && pathParts[3] === 'inclusions' && method === 'GET') {\r\n    try {\r\n      const packageId = parseInt(pathParts[2]);\r\n      const result = await env.DB.prepare(`\r\n        SELECT pi.inclusion_id, i.name, i.description, i.package_type as category\r\n        FROM package_inclusions pi\r\n        JOIN inclusions i ON pi.inclusion_id = i.id\r\n        WHERE pi.package_id = ? AND pi.is_active = 1 AND i.is_active = 1\r\n        ORDER BY i.name\r\n      `).bind(packageId).all();\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        inclusions: result.results\r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // POST /api/packages/:id/inclusions - add inclusion to package\r\n  if (pathParts.length === 4 && pathParts[3] === 'inclusions' && method === 'POST') {\r\n    try {\r\n      const packageId = parseInt(pathParts[2]);\r\n      const { inclusion_id } = body;\r\n\r\n      if (!inclusion_id) {\r\n        return new Response(JSON.stringify({\r\n          success: false,\r\n          error: 'inclusion_id is required'\r\n        }), {\r\n          status: 400,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Access-Control-Allow-Origin': '*',\r\n          },\r\n        });\r\n      }\r\n\r\n      // Check if already exists\r\n      const existing = await env.DB.prepare(\r\n        'SELECT * FROM package_inclusions WHERE package_id = ? AND inclusion_id = ?'\r\n      ).bind(packageId, inclusion_id).first();\r\n\r\n      if (existing) {\r\n        // Reactivate if soft-deleted\r\n        await env.DB.prepare(\r\n          'UPDATE package_inclusions SET is_active = 1 WHERE package_id = ? AND inclusion_id = ?'\r\n        ).bind(packageId, inclusion_id).run();\r\n      } else {\r\n        await env.DB.prepare(\r\n          'INSERT INTO package_inclusions (package_id, inclusion_id, is_active) VALUES (?, ?, 1)'\r\n        ).bind(packageId, inclusion_id).run();\r\n      }\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        message: 'Inclusion added to package'\r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // DELETE /api/packages/:id/inclusions/:inclusionId - remove inclusion from package\r\n  if (pathParts.length === 5 && pathParts[3] === 'inclusions' && method === 'DELETE') {\r\n    try {\r\n      const packageId = parseInt(pathParts[2]);\r\n      const inclusionId = parseInt(pathParts[4]);\r\n\r\n      await env.DB.prepare(\r\n        'UPDATE package_inclusions SET is_active = 0 WHERE package_id = ? AND inclusion_id = ?'\r\n      ).bind(packageId, inclusionId).run();\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        message: 'Inclusion removed from package'\r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // GET /api/packages/:id/amenities - get package amenities\r\n  if (pathParts.length === 4 && pathParts[3] === 'amenities' && method === 'GET') {\r\n    try {\r\n      const packageId = parseInt(pathParts[2]);\r\n      const result = await env.DB.prepare(`\r\n        SELECT pa.amenity_id as id, a.name, a.description, a.category, a.icon, pa.is_highlighted, pa.custom_note\r\n        FROM package_amenities pa\r\n        JOIN amenities a ON pa.amenity_id = a.id\r\n        WHERE pa.package_id = ? AND pa.is_active = 1 AND a.is_active = 1\r\n        ORDER BY pa.is_highlighted DESC, a.name\r\n      `).bind(packageId).all();\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        amenities: result.results\r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // POST /api/packages/:id/amenities - add amenity to package\r\n  if (pathParts.length === 4 && pathParts[3] === 'amenities' && method === 'POST') {\r\n    try {\r\n      const packageId = parseInt(pathParts[2]);\r\n      const { amenity_id, is_highlighted = false } = body;\r\n\r\n      if (!amenity_id) {\r\n        return new Response(JSON.stringify({\r\n          success: false,\r\n          error: 'amenity_id is required'\r\n        }), {\r\n          status: 400,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Access-Control-Allow-Origin': '*',\r\n          },\r\n        });\r\n      }\r\n\r\n      // Check if already exists\r\n      const existing = await env.DB.prepare(\r\n        'SELECT * FROM package_amenities WHERE package_id = ? AND amenity_id = ?'\r\n      ).bind(packageId, amenity_id).first();\r\n\r\n      if (existing) {\r\n        // Update highlight status or reactivate\r\n        await env.DB.prepare(\r\n          'UPDATE package_amenities SET is_active = 1, is_highlighted = ? WHERE package_id = ? AND amenity_id = ?'\r\n        ).bind(is_highlighted ? 1 : 0, packageId, amenity_id).run();\r\n      } else {\r\n        await env.DB.prepare(\r\n          'INSERT INTO package_amenities (package_id, amenity_id, is_highlighted, is_active) VALUES (?, ?, ?, 1)'\r\n        ).bind(packageId, amenity_id, is_highlighted ? 1 : 0).run();\r\n      }\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        message: 'Amenity added to package'\r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // DELETE /api/packages/:id/amenities/:amenityId - remove amenity from package\r\n  if (pathParts.length === 5 && pathParts[3] === 'amenities' && method === 'DELETE') {\r\n    try {\r\n      const packageId = parseInt(pathParts[2]);\r\n      const amenityId = parseInt(pathParts[4]);\r\n\r\n      await env.DB.prepare(\r\n        'UPDATE package_amenities SET is_active = 0 WHERE package_id = ? AND amenity_id = ?'\r\n      ).bind(packageId, amenityId).run();\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        message: 'Amenity removed from package'\r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // POST /api/packages - create new package\r\n  if (pathParts.length === 2 && method === 'POST') {\r\n    try {\r\n      const {\r\n        name,\r\n        description,\r\n        type,\r\n        base_room_id,\r\n        base_price,\r\n        min_nights,\r\n        max_nights,\r\n        max_guests,\r\n        discount_percentage,\r\n        is_active,\r\n        inclusions,\r\n        exclusions,\r\n        featured\r\n      } = body;\r\n\r\n      if (!name) {\r\n        return new Response(JSON.stringify({\r\n          success: false,\r\n          error: 'Package name is required'\r\n        }), {\r\n          status: 400,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Access-Control-Allow-Origin': '*',\r\n          },\r\n        });\r\n      }\r\n\r\n      const result = await env.DB.prepare(\r\n        `INSERT INTO packages (name, description, package_type, base_price, discount_percentage, min_nights, max_nights, max_guests, base_room_id, is_active, is_featured, inclusions, exclusions, created_at, updated_at) \r\n         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now'))`\r\n      ).bind(\r\n        name,\r\n        description || '',\r\n        type || 'Romance',\r\n        base_price || 0,\r\n        discount_percentage || 0,\r\n        min_nights || 1,\r\n        max_nights || 30,\r\n        max_guests || 2,\r\n        base_room_id || null,\r\n        is_active !== false ? 1 : 0,\r\n        featured ? 1 : 0,\r\n        JSON.stringify(inclusions || []),\r\n        JSON.stringify(exclusions || [])\r\n      ).run();\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        data: { id: result.meta.last_row_id, name },\r\n        message: 'Package created successfully'\r\n      }), {\r\n        status: 201,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // PUT /api/packages - update package\r\n  if (pathParts.length === 2 && method === 'PUT') {\r\n    try {\r\n      const { id, ...fields } = body;\r\n\r\n      if (!id) {\r\n        return new Response(JSON.stringify({\r\n          success: false,\r\n          error: 'Package ID is required'\r\n        }), {\r\n          status: 400,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Access-Control-Allow-Origin': '*',\r\n          },\r\n        });\r\n      }\r\n\r\n      const updates: string[] = [];\r\n      const values: any[] = [];\r\n\r\n      if (fields.name !== undefined) { updates.push('name = ?'); values.push(fields.name); }\r\n      if (fields.description !== undefined) { updates.push('description = ?'); values.push(fields.description); }\r\n      if (fields.package_type !== undefined) { updates.push('package_type = ?'); values.push(fields.package_type); }\r\n      if (fields.base_price !== undefined) { updates.push('base_price = ?'); values.push(fields.base_price); }\r\n      if (fields.discount_percentage !== undefined) { updates.push('discount_percentage = ?'); values.push(fields.discount_percentage); }\r\n      if (fields.min_nights !== undefined) { updates.push('min_nights = ?'); values.push(fields.min_nights); }\r\n      if (fields.max_nights !== undefined) { updates.push('max_nights = ?'); values.push(fields.max_nights); }\r\n      if (fields.max_guests !== undefined) { updates.push('max_guests = ?'); values.push(fields.max_guests); }\r\n      if (fields.base_room_id !== undefined) { updates.push('base_room_id = ?'); values.push(fields.base_room_id || null); }\r\n      if (fields.is_active !== undefined) { updates.push('is_active = ?'); values.push(fields.is_active ? 1 : 0); }\r\n      if (fields.is_featured !== undefined) { updates.push('is_featured = ?'); values.push(fields.is_featured ? 1 : 0); }\r\n      if (fields.includes !== undefined) { updates.push('inclusions = ?'); values.push(fields.includes); }\r\n      if (fields.exclusions !== undefined) { updates.push('exclusions = ?'); values.push(fields.exclusions); }\r\n      if (fields.images !== undefined) { updates.push('images = ?'); values.push(fields.images); }\r\n      if (fields.valid_from !== undefined) { updates.push('valid_from = ?'); values.push(fields.valid_from); }\r\n      if (fields.valid_until !== undefined) { updates.push('valid_until = ?'); values.push(fields.valid_until); }\r\n      if (fields.terms_conditions !== undefined) { updates.push('terms_conditions = ?'); values.push(fields.terms_conditions); }\r\n\r\n      if (updates.length === 0) {\r\n        return new Response(JSON.stringify({\r\n          success: false,\r\n          error: 'No fields to update'\r\n        }), {\r\n          status: 400,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Access-Control-Allow-Origin': '*',\r\n          },\r\n        });\r\n      }\r\n\r\n      updates.push(\"updated_at = datetime('now')\");\r\n      values.push(id);\r\n\r\n      await env.DB.prepare(\r\n        `UPDATE packages SET ${updates.join(', ')} WHERE id = ?`\r\n      ).bind(...values).run();\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        message: 'Package updated successfully'\r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // DELETE /api/packages - soft delete package\r\n  if (pathParts.length === 2 && method === 'DELETE') {\r\n    try {\r\n      const { id } = body;\r\n\r\n      if (!id) {\r\n        return new Response(JSON.stringify({\r\n          success: false,\r\n          error: 'Package ID is required'\r\n        }), {\r\n          status: 400,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Access-Control-Allow-Origin': '*',\r\n          },\r\n        });\r\n      }\r\n\r\n      await env.DB.prepare(\r\n        \"UPDATE packages SET is_active = 0, updated_at = datetime('now') WHERE id = ?\"\r\n      ).bind(id).run();\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        message: 'Package deleted successfully'\r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  return new Response(JSON.stringify({\r\n    success: false,\r\n    error: 'Invalid packages endpoint'\r\n  }), {\r\n    status: 404,\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Access-Control-Allow-Origin': '*',\r\n    },\r\n  });\r\n}\r\n", "import { Env } from '../types';\r\n\r\nexport async function handleVilla(url: URL, method: string, body: any, env: Env): Promise<Response> {\r\n  const pathParts = url.pathname.split('/').filter(Boolean);\r\n\r\n  // GET /api/villa - get villa information\r\n  if (pathParts.length === 2 && method === 'GET') {\r\n    try {\r\n      const result = await env.DB.prepare(\r\n        'SELECT * FROM villa_info LIMIT 1'\r\n      ).first();\r\n      \r\n      if (!result) {\r\n        return new Response(JSON.stringify({ \r\n          success: false, \r\n          error: 'Villa information not found' \r\n        }), { \r\n          status: 404,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Access-Control-Allow-Origin': '*',\r\n          },\r\n        });\r\n      }\r\n      \r\n      // Transform database fields to match frontend VillaInfo interface\r\n      const transformedData = {\r\n        id: result.id,\r\n        name: result.name || 'Villa Name',\r\n        location: result.location || '',\r\n        description: result.description || '',\r\n        logo_url: result.logo_url || '',\r\n        rating: 4.5, // Default rating - can be calculated from reviews later\r\n        reviews: 0, // Default reviews count\r\n        images: result.images ? JSON.parse(result.images as string) : [],\r\n        amenities: result.amenities_summary ? \r\n          result.amenities_summary.split(',').map((item: string) => ({\r\n            name: item.trim(),\r\n            icon: 'Star' // Default icon\r\n          })) : [],\r\n        // Contact Information\r\n        phone: result.phone || '',\r\n        email: result.email || '',\r\n        website: result.website || '',\r\n        // Address Information\r\n        address: result.address || '',\r\n        city: result.location ? result.location.split(',')[0].trim() : '',\r\n        state: result.location ? result.location.split(',')[1]?.trim() || '' : '',\r\n        zipCode: '',\r\n        country: result.location ? result.location.split(',').pop()?.trim() || '' : '',\r\n        // Additional Information\r\n        checkInTime: result.check_in_time || '14:00',\r\n        checkOutTime: result.check_out_time || '12:00',\r\n        maxGuests: result.max_guests || 10,\r\n        bedrooms: result.total_rooms || 5,\r\n        bathrooms: result.total_bathrooms || 5,\r\n        pricePerNight: 0, // Will be calculated from rooms\r\n        currency: 'USD',\r\n        // Policies\r\n        cancellationPolicy: result.policies || '',\r\n        houseRules: result.policies || '',\r\n        // Social Media\r\n        socialMedia: {\r\n          facebook: '',\r\n          instagram: '',\r\n          twitter: ''\r\n        }\r\n      };\r\n      \r\n      return new Response(JSON.stringify({ \r\n        success: true, \r\n        data: transformedData \r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({ \r\n        success: false, \r\n        error: error.message \r\n      }), { \r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // PUT /api/villa - update villa information\r\n  if (pathParts.length === 2 && method === 'PUT') {\r\n    try {\r\n      if (!body) {\r\n        return new Response(JSON.stringify({ \r\n          success: false, \r\n          error: 'Request body is required' \r\n        }), { \r\n          status: 400,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Access-Control-Allow-Origin': '*',\r\n          },\r\n        });\r\n      }\r\n\r\n      // Build location from city, state, country if provided\r\n      let location = body.location;\r\n      if (!location && (body.city || body.state || body.country)) {\r\n        const parts = [body.city, body.state, body.country].filter(Boolean);\r\n        location = parts.join(', ');\r\n      }\r\n\r\n      // Transform frontend fields to database snake_case\r\n      // Support both camelCase and snake_case inputs\r\n      const updateData: any = {};\r\n      \r\n      // Basic info\r\n      if (body.name !== undefined) updateData.name = body.name;\r\n      if (body.description !== undefined) updateData.description = body.description;\r\n      if (location !== undefined) updateData.location = location;\r\n      if (body.logo_url !== undefined) updateData.logo_url = body.logo_url;\r\n      \r\n      // Contact info\r\n      if (body.phone !== undefined) updateData.phone = body.phone;\r\n      if (body.email !== undefined) updateData.email = body.email;\r\n      if (body.website !== undefined) updateData.website = body.website;\r\n      if (body.address !== undefined) updateData.address = body.address;\r\n      \r\n      // Timing - support both formats\r\n      if (body.checkInTime !== undefined) updateData.check_in_time = body.checkInTime;\r\n      if (body.check_in_time !== undefined) updateData.check_in_time = body.check_in_time;\r\n      if (body.checkOutTime !== undefined) updateData.check_out_time = body.checkOutTime;\r\n      if (body.check_out_time !== undefined) updateData.check_out_time = body.check_out_time;\r\n      \r\n      // Policies - support both\r\n      if (body.cancellationPolicy !== undefined) updateData.policies = body.cancellationPolicy;\r\n      if (body.houseRules !== undefined && !updateData.policies) updateData.policies = body.houseRules;\r\n      \r\n      // Property specs (if columns exist)\r\n      if (body.maxGuests !== undefined || body.max_guests !== undefined) {\r\n        updateData.max_guests = body.maxGuests || body.max_guests;\r\n      }\r\n      if (body.bedrooms !== undefined || body.total_rooms !== undefined) {\r\n        updateData.total_rooms = body.bedrooms || body.total_rooms;\r\n      }\r\n      if (body.bathrooms !== undefined || body.total_bathrooms !== undefined) {\r\n        updateData.total_bathrooms = body.bathrooms || body.total_bathrooms;\r\n      }\r\n      \r\n      // NOTE: currency, timezone, maintenance_mode columns don't exist in villa_info table\r\n      // These fields are ignored until DB schema is updated\r\n      // if (body.currency !== undefined) updateData.currency = body.currency;\r\n      // if (body.timezone !== undefined) updateData.timezone = body.timezone;\r\n      // if (body.maintenance_mode !== undefined) updateData.maintenance_mode = body.maintenance_mode;\r\n      \r\n      // Images and amenities\r\n      if (body.images !== undefined) {\r\n        updateData.images = typeof body.images === 'string' ? body.images : JSON.stringify(body.images);\r\n      }\r\n      if (body.amenities !== undefined) {\r\n        updateData.amenities_summary = body.amenities.map((a: any) => a.name || a).join(', ');\r\n      }\r\n\r\n      // Check if there's anything to update\r\n      const fields = Object.keys(updateData);\r\n      if (fields.length === 0) {\r\n        return new Response(JSON.stringify({ \r\n          success: false, \r\n          error: 'No valid fields to update' \r\n        }), { \r\n          status: 400,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Access-Control-Allow-Origin': '*',\r\n          },\r\n        });\r\n      }\r\n\r\n      // Build UPDATE query\r\n      const setClause = fields.map(field => `${field} = ?`).join(', ');\r\n      const values = fields.map(field => updateData[field]);\r\n\r\n      console.log('Updating villa with:', { fields, values });\r\n\r\n      await env.DB.prepare(\r\n        `UPDATE villa_info SET ${setClause} WHERE id = 1`\r\n      ).bind(...values).run();\r\n\r\n      // Fetch updated record\r\n      const result = await env.DB.prepare(\r\n        'SELECT * FROM villa_info WHERE id = 1'\r\n      ).first();\r\n\r\n      if (!result) {\r\n        return new Response(JSON.stringify({ \r\n          success: false, \r\n          error: 'Failed to fetch updated villa information' \r\n        }), { \r\n          status: 500,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Access-Control-Allow-Origin': '*',\r\n          },\r\n        });\r\n      }\r\n\r\n      // Transform response back to frontend format\r\n      const transformedData = {\r\n        id: result.id,\r\n        name: result.name,\r\n        location: result.location,\r\n        description: result.description,\r\n        rating: 4.5,\r\n        reviews: 0,\r\n        images: result.images ? JSON.parse(result.images as string) : [],\r\n        amenities: result.amenities_summary ? \r\n          result.amenities_summary.split(',').map((item: string) => ({\r\n            name: item.trim(),\r\n            icon: 'Star'\r\n          })) : [],\r\n        phone: result.phone || '',\r\n        email: result.email || '',\r\n        website: result.website || '',\r\n        address: result.address || '',\r\n        city: result.location ? result.location.split(',')[0].trim() : '',\r\n        state: result.location ? result.location.split(',')[1]?.trim() || '' : '',\r\n        zipCode: '',\r\n        country: result.location ? result.location.split(',').pop()?.trim() || '' : '',\r\n        checkInTime: result.check_in_time || '14:00',\r\n        checkOutTime: result.check_out_time || '12:00',\r\n        maxGuests: result.max_guests || 10,\r\n        bedrooms: result.total_rooms || 5,\r\n        bathrooms: result.total_bathrooms || 5,\r\n        pricePerNight: 0,\r\n        currency: 'USD',\r\n        cancellationPolicy: result.policies || '',\r\n        houseRules: result.policies || '',\r\n        socialMedia: {\r\n          facebook: '',\r\n          instagram: '',\r\n          twitter: ''\r\n        }\r\n      };\r\n\r\n      return new Response(JSON.stringify({ \r\n        success: true, \r\n        data: transformedData \r\n      }), {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({ \r\n        success: false, \r\n        error: error.message \r\n      }), { \r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Access-Control-Allow-Origin': '*',\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  return new Response(JSON.stringify({ \r\n    success: false, \r\n    error: 'Invalid villa endpoint' \r\n  }), { \r\n    status: 404,\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Access-Control-Allow-Origin': '*',\r\n    },\r\n  });\r\n}\r\n", "import { Env } from '../types';\r\n\r\n// DOKU Payment Gateway Integration\r\n// Sandbox: https://api-sandbox.doku.com\r\n// Production: https://api.doku.com\r\n\r\ninterface DokuCheckoutRequest {\r\n  order: {\r\n    amount: number;\r\n    invoice_number: string;\r\n    callback_url: string;\r\n    auto_redirect: boolean;\r\n  };\r\n  payment: {\r\n    payment_due_date: number;\r\n  };\r\n  customer: {\r\n    name: string;\r\n    email: string;\r\n    phone?: string;\r\n  };\r\n}\r\n\r\ninterface CreatePaymentBody {\r\n  booking_reference: string;\r\n  amount: number;\r\n  customer_name: string;\r\n  customer_email: string;\r\n  customer_phone?: string;\r\n  callback_url?: string;\r\n}\r\n\r\n// Generate DOKU signature\r\nfunction generateSignature(clientId: string, requestId: string, requestTarget: string, digest: string, secretKey: string, timestamp: string): string {\r\n  const componentSignature = `Client-Id:${clientId}\\nRequest-Id:${requestId}\\nRequest-Timestamp:${timestamp}\\nRequest-Target:${requestTarget}\\nDigest:${digest}`;\r\n  \r\n  // HMAC-SHA256 signature\r\n  const encoder = new TextEncoder();\r\n  const keyData = encoder.encode(secretKey);\r\n  const messageData = encoder.encode(componentSignature);\r\n  \r\n  // Note: In Cloudflare Workers, we need to use crypto.subtle\r\n  return componentSignature; // Placeholder - actual implementation needs crypto\r\n}\r\n\r\n// Generate SHA256 digest\r\nasync function generateDigest(body: string): Promise<string> {\r\n  const encoder = new TextEncoder();\r\n  const data = encoder.encode(body);\r\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\r\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n  const base64Hash = btoa(String.fromCharCode(...hashArray));\r\n  return `SHA-256=${base64Hash}`;\r\n}\r\n\r\n// Generate HMAC-SHA256\r\nasync function generateHmacSha256(message: string, secretKey: string): Promise<string> {\r\n  const encoder = new TextEncoder();\r\n  const keyData = encoder.encode(secretKey);\r\n  const messageData = encoder.encode(message);\r\n  \r\n  const cryptoKey = await crypto.subtle.importKey(\r\n    'raw',\r\n    keyData,\r\n    { name: 'HMAC', hash: 'SHA-256' },\r\n    false,\r\n    ['sign']\r\n  );\r\n  \r\n  const signature = await crypto.subtle.sign('HMAC', cryptoKey, messageData);\r\n  const signatureArray = Array.from(new Uint8Array(signature));\r\n  return btoa(String.fromCharCode(...signatureArray));\r\n}\r\n\r\nexport async function handlePayment(url: URL, method: string, body: any, env: Env): Promise<Response> {\r\n  const pathParts = url.pathname.split('/').filter(Boolean);\r\n\r\n  // CORS headers\r\n  const corsHeaders = {\r\n    'Content-Type': 'application/json',\r\n    'Access-Control-Allow-Origin': '*',\r\n    'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\r\n    'Access-Control-Allow-Headers': 'Content-Type',\r\n  };\r\n\r\n  // OPTIONS preflight\r\n  if (method === 'OPTIONS') {\r\n    return new Response(null, { status: 204, headers: corsHeaders });\r\n  }\r\n\r\n  // POST /api/payment/create - Create DOKU payment page\r\n  if (pathParts.length === 3 && pathParts[2] === 'create' && method === 'POST') {\r\n    try {\r\n      const {\r\n        booking_reference,\r\n        amount,\r\n        customer_name,\r\n        customer_email,\r\n        customer_phone,\r\n        callback_url\r\n      } = body as CreatePaymentBody;\r\n\r\n      // Validate required fields\r\n      if (!booking_reference || !amount || !customer_name || !customer_email) {\r\n        return new Response(JSON.stringify({\r\n          success: false,\r\n          error: 'Missing required fields: booking_reference, amount, customer_name, customer_email'\r\n        }), { status: 400, headers: corsHeaders });\r\n      }\r\n\r\n      // Get DOKU credentials from environment\r\n      const clientId = env.DOKU_CLIENT_ID;\r\n      const secretKey = env.DOKU_SECRET_KEY;\r\n      const isProduction = env.DOKU_ENVIRONMENT === 'production';\r\n      \r\n      if (!clientId || !secretKey) {\r\n        return new Response(JSON.stringify({\r\n          success: false,\r\n          error: 'DOKU credentials not configured'\r\n        }), { status: 500, headers: corsHeaders });\r\n      }\r\n\r\n      const baseUrl = isProduction \r\n        ? 'https://api.doku.com' \r\n        : 'https://api-sandbox.doku.com';\r\n\r\n      // Generate unique invoice number\r\n      const invoiceNumber = `${booking_reference}-${Date.now()}`;\r\n      \r\n      // Default callback URL\r\n      const defaultCallbackUrl = `${url.origin}/booking/payment-result`;\r\n      \r\n      // Build request body\r\n      const requestBody: DokuCheckoutRequest = {\r\n        order: {\r\n          amount: Math.round(amount), // DOKU requires integer\r\n          invoice_number: invoiceNumber,\r\n          callback_url: callback_url || defaultCallbackUrl,\r\n          auto_redirect: true\r\n        },\r\n        payment: {\r\n          payment_due_date: 60 // 60 minutes expiry\r\n        },\r\n        customer: {\r\n          name: customer_name,\r\n          email: customer_email,\r\n          phone: customer_phone\r\n        }\r\n      };\r\n\r\n      const requestBodyString = JSON.stringify(requestBody);\r\n      const requestTarget = '/checkout/v1/payment';\r\n      const requestId = crypto.randomUUID();\r\n      const timestamp = new Date().toISOString().replace(/\\.\\d{3}Z$/, 'Z');\r\n\r\n      // Generate digest\r\n      const digest = await generateDigest(requestBodyString);\r\n\r\n      // Generate signature components\r\n      const componentSignature = `Client-Id:${clientId}\\nRequest-Id:${requestId}\\nRequest-Timestamp:${timestamp}\\nRequest-Target:${requestTarget}\\nDigest:${digest}`;\r\n      \r\n      // Generate HMAC-SHA256 signature\r\n      const signature = await generateHmacSha256(componentSignature, secretKey);\r\n\r\n      console.log('DOKU Request:', {\r\n        url: `${baseUrl}${requestTarget}`,\r\n        invoiceNumber,\r\n        amount,\r\n        customer: customer_name\r\n      });\r\n\r\n      // Call DOKU API\r\n      const dokuResponse = await fetch(`${baseUrl}${requestTarget}`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Client-Id': clientId,\r\n          'Request-Id': requestId,\r\n          'Request-Timestamp': timestamp,\r\n          'Signature': `HMACSHA256=${signature}`\r\n        },\r\n        body: requestBodyString\r\n      });\r\n\r\n      const dokuResult = await dokuResponse.json();\r\n\r\n      console.log('DOKU Response:', dokuResult);\r\n\r\n      if (!dokuResponse.ok) {\r\n        return new Response(JSON.stringify({\r\n          success: false,\r\n          error: 'DOKU API error',\r\n          details: dokuResult\r\n        }), { status: dokuResponse.status, headers: corsHeaders });\r\n      }\r\n\r\n      // Extract payment URL\r\n      const paymentUrl = dokuResult.response?.payment?.url;\r\n\r\n      if (!paymentUrl) {\r\n        return new Response(JSON.stringify({\r\n          success: false,\r\n          error: 'No payment URL returned from DOKU',\r\n          details: dokuResult\r\n        }), { status: 500, headers: corsHeaders });\r\n      }\r\n\r\n      // Save payment record to database\r\n      try {\r\n        await env.DB.prepare(`\r\n          INSERT INTO payment_transactions (\r\n            booking_reference, invoice_number, amount, status, \r\n            payment_url, customer_name, customer_email, created_at\r\n          ) VALUES (?, ?, ?, 'pending', ?, ?, ?, datetime('now'))\r\n        `).bind(\r\n          booking_reference,\r\n          invoiceNumber,\r\n          amount,\r\n          paymentUrl,\r\n          customer_name,\r\n          customer_email\r\n        ).run();\r\n      } catch (dbError) {\r\n        console.error('Failed to save payment record:', dbError);\r\n        // Continue anyway - payment URL is still valid\r\n      }\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        data: {\r\n          payment_url: paymentUrl,\r\n          invoice_number: invoiceNumber,\r\n          amount: amount,\r\n          expires_in_minutes: 60\r\n        }\r\n      }), { status: 200, headers: corsHeaders });\r\n\r\n    } catch (error: any) {\r\n      console.error('Payment creation error:', error);\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message || 'Failed to create payment'\r\n      }), { status: 500, headers: corsHeaders });\r\n    }\r\n  }\r\n\r\n  // POST /api/payment/callback - DOKU callback/webhook\r\n  if (pathParts.length === 3 && pathParts[2] === 'callback' && method === 'POST') {\r\n    try {\r\n      console.log('DOKU Callback received:', body);\r\n\r\n      const invoiceNumber = body.order?.invoice_number;\r\n      const transactionStatus = body.transaction?.status;\r\n\r\n      if (invoiceNumber && transactionStatus) {\r\n        // Update payment status\r\n        await env.DB.prepare(`\r\n          UPDATE payment_transactions \r\n          SET status = ?, updated_at = datetime('now'), callback_data = ?\r\n          WHERE invoice_number = ?\r\n        `).bind(transactionStatus.toLowerCase(), JSON.stringify(body), invoiceNumber).run();\r\n\r\n        // If payment successful, update booking status\r\n        if (transactionStatus === 'SUCCESS') {\r\n          const bookingRef = invoiceNumber.split('-')[0] + '-' + invoiceNumber.split('-')[1];\r\n          await env.DB.prepare(`\r\n            UPDATE bookings SET status = 'confirmed', payment_status = 'paid' \r\n            WHERE booking_reference LIKE ?\r\n          `).bind(`${bookingRef}%`).run();\r\n        }\r\n      }\r\n\r\n      return new Response(JSON.stringify({ success: true }), { \r\n        status: 200, \r\n        headers: corsHeaders \r\n      });\r\n\r\n    } catch (error: any) {\r\n      console.error('Payment callback error:', error);\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), { status: 500, headers: corsHeaders });\r\n    }\r\n  }\r\n\r\n  // GET /api/payment/status/:invoiceNumber - Check payment status\r\n  if (pathParts.length === 4 && pathParts[2] === 'status' && method === 'GET') {\r\n    try {\r\n      const invoiceNumber = pathParts[3];\r\n      \r\n      const result = await env.DB.prepare(`\r\n        SELECT * FROM payment_transactions WHERE invoice_number = ?\r\n      `).bind(invoiceNumber).first();\r\n\r\n      if (!result) {\r\n        return new Response(JSON.stringify({\r\n          success: false,\r\n          error: 'Payment not found'\r\n        }), { status: 404, headers: corsHeaders });\r\n      }\r\n\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        data: result\r\n      }), { status: 200, headers: corsHeaders });\r\n\r\n    } catch (error: any) {\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message\r\n      }), { status: 500, headers: corsHeaders });\r\n    }\r\n  }\r\n\r\n  return new Response(JSON.stringify({\r\n    success: false,\r\n    error: 'Invalid payment endpoint'\r\n  }), { status: 404, headers: corsHeaders });\r\n}\r\n", "import { Env } from './types';\r\nimport { handleRooms } from './routes/rooms';\r\nimport { handlePackages } from './routes/packages';\r\nimport { handleVilla } from './routes/villa';\r\nimport { handlePayment } from './routes/payment';\r\n\r\n// FORCE REBUILD - Timestamp: 2026-01-09 02:37\r\n// This comment exists only to force Wrangler to rebuild the Worker\r\n\r\nasync function handleRequest(request: Request, env: Env): Promise<Response> {\r\n  const url = new URL(request.url);\r\n  const method = request.method;\r\n  const path = url.pathname;\r\n  \r\n  let body = null;\r\n  // Skip JSON parsing for image upload (needs formData)\r\n  if ((method === 'POST' || method === 'PUT' || method === 'DELETE') && path !== '/api/images/upload') {\r\n    try {\r\n      body = await request.json();\r\n    } catch (e) {\r\n      // Allow empty body for DELETE requests\r\n      if (method !== 'DELETE') {\r\n        return errorResponse('Invalid JSON body', 400);\r\n      }\r\n    }\r\n  }\r\n\r\n  try {\r\n    // Health check\r\n    if (path === '/api/health') {\r\n      return successResponse({\r\n        status: 'REVERTED - THIS SHOULD NOW APPEAR',\r\n        timestamp: new Date().toISOString(),\r\n        version: '3.0.0-reverted-test',\r\n      });\r\n    }\r\n\r\n    // Debug test endpoint\r\n    if (path === '/api/test/debug') {\r\n      return successResponse({\r\n        message: 'Debug test successful',\r\n        requestPath: path,\r\n        requestMethod: method,\r\n      });\r\n    }\r\n\r\n    // Test endpoints\r\n    if (path === '/api/test/bookings') {\r\n      const result = await env.DB.prepare('SELECT COUNT(*) as count FROM bookings').first();\r\n      return successResponse(result);\r\n    }\r\n\r\n    if (path === '/api/test/r2') {\r\n      const objects = await env.IMAGES.list();\r\n      return successResponse({\r\n        bucketAvailable: true,\r\n        objectCount: objects.objects.length,\r\n      });\r\n    }\r\n\r\n    // NEW EMAIL TEST ENDPOINT\r\n    if (path === '/api/test/send-email-test') {\r\n      return successResponse({\r\n        message: 'Email test endpoint is working!',\r\n        status: 'success',\r\n        recipient: 'greatdaniel87@gmail.com',\r\n      });\r\n    }\r\n\r\n    // Bookings routes\r\n    if (path.startsWith('/api/bookings')) {\r\n      return handleBookings(url, method, body, env);\r\n    }\r\n\r\n    // Rooms routes\r\n    if (path.startsWith('/api/rooms')) {\r\n      return handleRooms(url, method, body, env);\r\n    }\r\n\r\n    // Packages routes\r\n    if (path.startsWith('/api/packages')) {\r\n      return handlePackages(url, method, body, env);\r\n    }\r\n\r\n    // Inclusions routes\r\n    if (path.startsWith('/api/inclusions')) {\r\n      return handleInclusions(url, method, body, env);\r\n    }\r\n\r\n    // Villa routes\r\n    if (path.startsWith('/api/villa')) {\r\n      return handleVilla(url, method, body, env);\r\n    }\r\n\r\n    // Amenities routes\r\n    if (path.startsWith('/api/amenities')) {\r\n      return handleAmenities(url, method, body, env);\r\n    }\r\n\r\n    // Auth routes\r\n    if (path.startsWith('/api/auth')) {\r\n      return handleAuth(url, method, body, env);\r\n    }\r\n\r\n    // Images routes\r\n    if (path.startsWith('/api/images')) {\r\n      return handleImages(url, method, request, env);\r\n    }\r\n\r\n    // Admin routes\r\n    if (path.startsWith('/api/admin')) {\r\n      return handleAdmin(url, method, body, env);\r\n    }\r\n\r\n    // Settings routes\r\n    if (path.startsWith('/api/settings')) {\r\n      return handleSettings(url, method, body, env);\r\n    }\r\n\r\n    // Email routes\r\n    if (path.startsWith('/api/email')) {\r\n      return handleEmail(url, method, body, env);\r\n    }\r\n\r\n    // Payment routes (DOKU)\r\n    if (path.startsWith('/api/payment')) {\r\n      return handlePayment(url, method, body, env);\r\n    }\r\n\r\n    return errorResponse('Endpoint not found', 404);\r\n  } catch (error) {\r\n    console.error('Request error:', error);\r\n    return errorResponse(error.message || 'Internal server error', 500);\r\n  }\r\n}\r\n\r\nfunction successResponse(data: any): Response {\r\n  return new Response(JSON.stringify({ success: true, data }), {\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Access-Control-Allow-Origin': '*',\r\n      'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\r\n      'Access-Control-Allow-Headers': 'Content-Type, Authorization',\r\n    },\r\n  });\r\n}\r\n\r\nfunction errorResponse(message: string, status = 500): Response {\r\n  return new Response(JSON.stringify({ success: false, error: message }), {\r\n    status,\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Access-Control-Allow-Origin': '*',\r\n    },\r\n  });\r\n}\r\n\r\n// ==================== BOOKINGS ====================\r\nasync function handleBookings(url: URL, method: string, body: any, env: Env): Promise<Response> {\r\n  const pathParts = url.pathname.split('/').filter(Boolean);\r\n\r\n  // GET /api/bookings - list all bookings (default)\r\n  if (pathParts.length === 2 && method === 'GET') {\r\n    try {\r\n      const limit = parseInt(url.searchParams.get('limit') || '100');\r\n      const offset = parseInt(url.searchParams.get('offset') || '0');\r\n      const result = await env.DB.prepare(\r\n        'SELECT * FROM bookings ORDER BY created_at DESC LIMIT ? OFFSET ?'\r\n      ).bind(limit, offset).all();\r\n      return successResponse(result.results);\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // GET /api/bookings/list\r\n  if (pathParts[2] === 'list' && method === 'GET') {\r\n    try {\r\n      const limit = parseInt(url.searchParams.get('limit') || '50');\r\n      const offset = parseInt(url.searchParams.get('offset') || '0');\r\n      const result = await env.DB.prepare(\r\n        'SELECT * FROM bookings ORDER BY created_at DESC LIMIT ? OFFSET ?'\r\n      ).bind(limit, offset).all();\r\n      return successResponse(result.results);\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // GET /api/bookings/:id\r\n  if (pathParts[2] && !isNaN(Number(pathParts[2])) && method === 'GET') {\r\n    try {\r\n      const id = parseInt(pathParts[2]);\r\n      const result = await env.DB.prepare('SELECT * FROM bookings WHERE id = ?').bind(id).first();\r\n      if (!result) return errorResponse('Booking not found', 404);\r\n      return successResponse(result);\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // GET /api/bookings/ref/:reference\r\n  if (pathParts[2] === 'ref' && pathParts[3] && method === 'GET') {\r\n    try {\r\n      const ref = pathParts[3];\r\n      const result = await env.DB.prepare('SELECT * FROM bookings WHERE booking_reference = ?').bind(ref).first();\r\n      if (!result) return errorResponse('Booking not found', 404);\r\n      return successResponse(result);\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // POST /api/bookings/create\r\n  if (pathParts[2] === 'create' && method === 'POST') {\r\n    try {\r\n      if (!body.booking_reference || !body.email || !body.check_in || !body.check_out) {\r\n        return errorResponse('Missing required fields: booking_reference, email, check_in, check_out', 400);\r\n      }\r\n\r\n      await env.DB.prepare(\r\n        `INSERT INTO bookings (\r\n          booking_reference, room_id, package_id, first_name, last_name, email, phone,\r\n          check_in, check_out, guests, adults, children, total_price, currency,\r\n          special_requests, source, status, payment_status, created_at, updated_at\r\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now'))`\r\n      ).bind(\r\n        body.booking_reference,\r\n        body.room_id || null,\r\n        body.package_id || null,\r\n        body.first_name,\r\n        body.last_name,\r\n        body.email,\r\n        body.phone || null,\r\n        body.check_in,\r\n        body.check_out,\r\n        body.guests,\r\n        body.adults || body.guests,\r\n        body.children || 0,\r\n        body.total_price,\r\n        body.currency || 'USD',\r\n        body.special_requests || null,\r\n        body.source || 'direct',\r\n        'pending',\r\n        'pending'\r\n      ).run();\r\n\r\n      return successResponse({\r\n        booking_reference: body.booking_reference,\r\n        message: 'Booking created successfully',\r\n      });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // PUT /api/bookings/:id/status\r\n  if (pathParts[3] === 'status' && method === 'PUT') {\r\n    try {\r\n      const id = parseInt(pathParts[2]);\r\n      const { status, payment_status } = body;\r\n\r\n      if (!status) return errorResponse('Status is required', 400);\r\n\r\n      let query = 'UPDATE bookings SET status = ?, updated_at = datetime(\\'now\\')';\r\n      const params: any[] = [status];\r\n\r\n      if (payment_status) {\r\n        query += ', payment_status = ?';\r\n        params.push(payment_status);\r\n      }\r\n\r\n      query += ' WHERE id = ?';\r\n      params.push(id);\r\n\r\n      await env.DB.prepare(query).bind(...params).run();\r\n\r\n      return successResponse({ message: 'Booking status updated' });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // GET /api/bookings/dates/search\r\n  if (pathParts[2] === 'dates' && pathParts[3] === 'search' && method === 'GET') {\r\n    try {\r\n      const checkInBefore = url.searchParams.get('check_in_before');\r\n      const checkOutAfter = url.searchParams.get('check_out_after');\r\n\r\n      if (!checkInBefore || !checkOutAfter) {\r\n        return errorResponse('Missing query parameters: check_in_before, check_out_after', 400);\r\n      }\r\n\r\n      const result = await env.DB.prepare(\r\n        `SELECT * FROM bookings\r\n         WHERE check_in <= ? AND check_out >= ?\r\n         ORDER BY check_in ASC`\r\n      ).bind(checkOutAfter, checkInBefore).all();\r\n\r\n      return successResponse(result.results);\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  return errorResponse('Endpoint not found', 404);\r\n}\r\n\r\n// ==================== AMENITIES ====================\r\nasync function handleAmenities(url: URL, method: string, body: any, env: Env): Promise<Response> {\r\n  const pathParts = url.pathname.split('/').filter(Boolean);\r\n\r\n  // GET /api/amenities or /api/amenities/list\r\n  if ((pathParts.length === 2 || pathParts[2] === 'list') && method === 'GET') {\r\n    try {\r\n      const result = await env.DB.prepare(\r\n        'SELECT * FROM amenities WHERE is_active = 1 ORDER BY display_order ASC'\r\n      ).all();\r\n      return successResponse(result.results);\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // GET /api/amenities/featured\r\n  if (pathParts[2] === 'featured' && method === 'GET') {\r\n    try {\r\n      const result = await env.DB.prepare(\r\n        'SELECT * FROM amenities WHERE is_featured = 1 AND is_active = 1 ORDER BY display_order ASC'\r\n      ).all();\r\n      return successResponse(result.results);\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // GET /api/amenities/category/:name\r\n  if (pathParts[2] === 'category' && pathParts[3] && method === 'GET') {\r\n    try {\r\n      const category = pathParts[3];\r\n      const result = await env.DB.prepare(\r\n        'SELECT * FROM amenities WHERE category = ? AND is_active = 1 ORDER BY display_order ASC'\r\n      ).bind(category).all();\r\n      return successResponse(result.results);\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // GET /api/amenities/:id\r\n  if (pathParts[2] && !isNaN(Number(pathParts[2])) && method === 'GET') {\r\n    try {\r\n      const id = parseInt(pathParts[2]);\r\n      const result = await env.DB.prepare('SELECT * FROM amenities WHERE id = ?').bind(id).first();\r\n      if (!result) return errorResponse('Amenity not found', 404);\r\n      return successResponse(result);\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // POST /api/amenities - Create new amenity\r\n  if (pathParts.length === 2 && method === 'POST') {\r\n    try {\r\n      const { name, category, description, icon, is_featured, is_active, display_order } = body;\r\n      if (!name) return errorResponse('Name is required', 400);\r\n\r\n      const result = await env.DB.prepare(\r\n        `INSERT INTO amenities (name, category, description, icon, is_featured, is_active, display_order, created_at, updated_at) \r\n         VALUES (?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now'))`\r\n      ).bind(\r\n        name,\r\n        category || null,\r\n        description || null,\r\n        icon || 'star',\r\n        is_featured ? 1 : 0,\r\n        is_active !== false ? 1 : 0,\r\n        display_order || 0\r\n      ).run();\r\n\r\n      return successResponse({ id: result.meta.last_row_id, message: 'Amenity created successfully' });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // PUT /api/amenities/:id - Update amenity\r\n  if (pathParts[2] && !isNaN(Number(pathParts[2])) && method === 'PUT') {\r\n    try {\r\n      const id = parseInt(pathParts[2]);\r\n      const { name, category, description, icon, is_featured, is_active, display_order } = body;\r\n\r\n      // Build dynamic update query\r\n      const updates: string[] = [];\r\n      const values: any[] = [];\r\n\r\n      if (name !== undefined) { updates.push('name = ?'); values.push(name); }\r\n      if (category !== undefined) { updates.push('category = ?'); values.push(category); }\r\n      if (description !== undefined) { updates.push('description = ?'); values.push(description); }\r\n      if (icon !== undefined) { updates.push('icon = ?'); values.push(icon); }\r\n      if (is_featured !== undefined) { updates.push('is_featured = ?'); values.push(is_featured ? 1 : 0); }\r\n      if (is_active !== undefined) { updates.push('is_active = ?'); values.push(is_active ? 1 : 0); }\r\n      if (display_order !== undefined) { updates.push('display_order = ?'); values.push(display_order); }\r\n      \r\n      updates.push(\"updated_at = datetime('now')\");\r\n      values.push(id);\r\n\r\n      await env.DB.prepare(\r\n        `UPDATE amenities SET ${updates.join(', ')} WHERE id = ?`\r\n      ).bind(...values).run();\r\n\r\n      return successResponse({ message: 'Amenity updated successfully' });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // DELETE /api/amenities/:id - Delete amenity\r\n  if (pathParts[2] && !isNaN(Number(pathParts[2])) && method === 'DELETE') {\r\n    try {\r\n      const id = parseInt(pathParts[2]);\r\n      await env.DB.prepare('DELETE FROM amenities WHERE id = ?').bind(id).run();\r\n      return successResponse({ message: 'Amenity deleted successfully' });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  return errorResponse('Endpoint not found', 404);\r\n}\r\n\r\n// ==================== INCLUSIONS ====================\r\nasync function handleInclusions(url: URL, method: string, body: any, env: Env): Promise<Response> {\r\n  const pathParts = url.pathname.split('/').filter(Boolean);\r\n\r\n  // GET /api/inclusions or /api/inclusions/list - List all inclusions\r\n  if ((pathParts.length === 2 || pathParts[2] === 'list') && method === 'GET') {\r\n    try {\r\n      const result = await env.DB.prepare(\r\n        'SELECT * FROM inclusions WHERE is_active = 1 ORDER BY package_type, name ASC'\r\n      ).all();\r\n      return successResponse({ inclusions: result.results });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // GET /api/inclusions/category/:type - Get by package type/category\r\n  if (pathParts[2] === 'category' && pathParts[3] && method === 'GET') {\r\n    try {\r\n      const packageType = pathParts[3];\r\n      const result = await env.DB.prepare(\r\n        'SELECT * FROM inclusions WHERE package_type = ? AND is_active = 1 ORDER BY name ASC'\r\n      ).bind(packageType).all();\r\n      return successResponse({ inclusions: result.results });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // GET /api/inclusions/package/:id - Get inclusions for a specific package\r\n  if (pathParts[2] === 'package' && pathParts[3] && method === 'GET') {\r\n    try {\r\n      const packageId = parseInt(pathParts[3]);\r\n      const result = await env.DB.prepare(`\r\n        SELECT i.*, pi.quantity, pi.custom_description\r\n        FROM inclusions i\r\n        JOIN package_inclusions pi ON i.id = pi.inclusion_id\r\n        WHERE pi.package_id = ? AND i.is_active = 1 AND pi.is_active = 1\r\n        ORDER BY i.name ASC\r\n      `).bind(packageId).all();\r\n      return successResponse({ inclusions: result.results });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // GET /api/inclusions/:id - Get single inclusion\r\n  if (pathParts[2] && !isNaN(Number(pathParts[2])) && method === 'GET') {\r\n    try {\r\n      const id = parseInt(pathParts[2]);\r\n      const result = await env.DB.prepare('SELECT * FROM inclusions WHERE id = ?').bind(id).first();\r\n      if (!result) return errorResponse('Inclusion not found', 404);\r\n      return successResponse(result);\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // POST /api/inclusions - Create new inclusion\r\n  if (pathParts.length === 2 && method === 'POST') {\r\n    try {\r\n      const { name, description, package_type, is_active } = body;\r\n      if (!name) return errorResponse('Name is required', 400);\r\n\r\n      const result = await env.DB.prepare(\r\n        `INSERT INTO inclusions (name, description, package_type, is_active, created_at, updated_at) \r\n         VALUES (?, ?, ?, ?, datetime('now'), datetime('now'))`\r\n      ).bind(\r\n        name,\r\n        description || null,\r\n        package_type || null,\r\n        is_active !== false ? 1 : 0\r\n      ).run();\r\n\r\n      return successResponse({ id: result.meta.last_row_id, message: 'Inclusion created successfully' });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // PUT /api/inclusions/:id - Update inclusion\r\n  if (pathParts[2] && !isNaN(Number(pathParts[2])) && method === 'PUT') {\r\n    try {\r\n      const id = parseInt(pathParts[2]);\r\n      const { name, description, package_type, is_active } = body;\r\n\r\n      const updates: string[] = [];\r\n      const values: any[] = [];\r\n\r\n      if (name !== undefined) { updates.push('name = ?'); values.push(name); }\r\n      if (description !== undefined) { updates.push('description = ?'); values.push(description); }\r\n      if (package_type !== undefined) { updates.push('package_type = ?'); values.push(package_type); }\r\n      if (is_active !== undefined) { updates.push('is_active = ?'); values.push(is_active ? 1 : 0); }\r\n      \r\n      updates.push(\"updated_at = datetime('now')\");\r\n      values.push(id);\r\n\r\n      await env.DB.prepare(\r\n        `UPDATE inclusions SET ${updates.join(', ')} WHERE id = ?`\r\n      ).bind(...values).run();\r\n\r\n      return successResponse({ message: 'Inclusion updated successfully' });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // DELETE /api/inclusions/:id - Delete inclusion\r\n  if (pathParts[2] && !isNaN(Number(pathParts[2])) && method === 'DELETE') {\r\n    try {\r\n      const id = parseInt(pathParts[2]);\r\n      // Also remove from package_inclusions\r\n      await env.DB.prepare('DELETE FROM package_inclusions WHERE inclusion_id = ?').bind(id).run();\r\n      await env.DB.prepare('DELETE FROM inclusions WHERE id = ?').bind(id).run();\r\n      return successResponse({ message: 'Inclusion deleted successfully' });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // POST /api/inclusions/link-package - Link inclusion to package\r\n  if (pathParts[2] === 'link-package' && method === 'POST') {\r\n    try {\r\n      const { package_id, inclusion_id, quantity } = body;\r\n      if (!package_id || !inclusion_id) return errorResponse('package_id and inclusion_id are required', 400);\r\n\r\n      await env.DB.prepare(\r\n        `INSERT INTO package_inclusions (package_id, inclusion_id, quantity, is_active, created_at, updated_at) \r\n         VALUES (?, ?, ?, 1, datetime('now'), datetime('now'))`\r\n      ).bind(package_id, inclusion_id, quantity || 1).run();\r\n\r\n      return successResponse({ message: 'Inclusion linked to package successfully' });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // DELETE /api/inclusions/unlink-package - Unlink inclusion from package\r\n  if (pathParts[2] === 'unlink-package' && method === 'DELETE') {\r\n    try {\r\n      const { package_id, inclusion_id } = body;\r\n      if (!package_id || !inclusion_id) return errorResponse('package_id and inclusion_id are required', 400);\r\n\r\n      await env.DB.prepare(\r\n        'DELETE FROM package_inclusions WHERE package_id = ? AND inclusion_id = ?'\r\n      ).bind(package_id, inclusion_id).run();\r\n\r\n      return successResponse({ message: 'Inclusion unlinked from package successfully' });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // GET /api/inclusions/room/:id - Get inclusions for a specific room\r\n  if (pathParts[2] === 'room' && pathParts[3] && method === 'GET') {\r\n    try {\r\n      const roomId = parseInt(pathParts[3]);\r\n      const result = await env.DB.prepare(`\r\n        SELECT i.*, ri.quantity, ri.custom_description\r\n        FROM inclusions i\r\n        JOIN room_inclusions ri ON i.id = ri.inclusion_id\r\n        WHERE ri.room_id = ? AND i.is_active = 1\r\n        ORDER BY i.name ASC\r\n      `).bind(roomId).all();\r\n      return successResponse({ inclusions: result.results });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // POST /api/inclusions/link-room - Link inclusion to room\r\n  if (pathParts[2] === 'link-room' && method === 'POST') {\r\n    try {\r\n      const { room_id, inclusion_id, quantity, custom_description } = body;\r\n      if (!room_id || !inclusion_id) return errorResponse('room_id and inclusion_id are required', 400);\r\n\r\n      await env.DB.prepare(\r\n        `INSERT OR REPLACE INTO room_inclusions (room_id, inclusion_id, quantity, custom_description, created_at, updated_at) \r\n         VALUES (?, ?, ?, ?, datetime('now'), datetime('now'))`\r\n      ).bind(room_id, inclusion_id, quantity || 1, custom_description || null).run();\r\n\r\n      return successResponse({ message: 'Inclusion linked to room successfully' });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // DELETE /api/inclusions/unlink-room - Unlink inclusion from room\r\n  if (pathParts[2] === 'unlink-room' && method === 'DELETE') {\r\n    try {\r\n      const { room_id, inclusion_id } = body;\r\n      if (!room_id || !inclusion_id) return errorResponse('room_id and inclusion_id are required', 400);\r\n\r\n      await env.DB.prepare(\r\n        'DELETE FROM room_inclusions WHERE room_id = ? AND inclusion_id = ?'\r\n      ).bind(room_id, inclusion_id).run();\r\n\r\n      return successResponse({ message: 'Inclusion unlinked from room successfully' });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  return errorResponse('Endpoint not found', 404);\r\n}\r\n\r\n// ==================== AUTHENTICATION ====================\r\nasync function handleAuth(url: URL, method: string, body: any, env: Env): Promise<Response> {\r\n  // POST /api/auth/login\r\n  if (url.pathname === '/api/auth/login' && method === 'POST') {\r\n    try {\r\n      if (!body.username || !body.password) {\r\n        return errorResponse('Username and password required', 400);\r\n      }\r\n\r\n      const user = await env.DB.prepare(\r\n        'SELECT id, username, email, role, password_hash FROM users WHERE username = ? AND active = 1'\r\n      ).bind(body.username).first();\r\n\r\n      if (!user) return errorResponse('Invalid credentials', 401);\r\n\r\n      // TODO: Implement proper password verification (bcrypt)\r\n      // For now using placeholder\r\n      const token = Buffer.from(\r\n        JSON.stringify({ id: user.id, username: user.username, role: user.role })\r\n      ).toString('base64');\r\n\r\n      return successResponse({\r\n        token,\r\n        user: { id: user.id, username: user.username, email: user.email, role: user.role },\r\n      });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // POST /api/auth/verify\r\n  if (url.pathname === '/api/auth/verify' && method === 'POST') {\r\n    try {\r\n      if (!body.token) return errorResponse('Token required', 400);\r\n\r\n      // TODO: Implement proper JWT verification\r\n      const decoded = JSON.parse(Buffer.from(body.token, 'base64').toString());\r\n      return successResponse({ valid: true, user: decoded });\r\n    } catch (error) {\r\n      return errorResponse('Invalid token', 401);\r\n    }\r\n  }\r\n\r\n  return errorResponse('Endpoint not found', 404);\r\n}\r\n\r\n// ==================== IMAGES ====================\r\nasync function handleImages(url: URL, method: string, request: Request, env: Env): Promise<Response> {\r\n  const R2_PUBLIC_URL = 'https://pub-e303ec878512482fa87c065266e6bedd.r2.dev';\r\n\r\n  // GET /api/images/list\r\n  if (url.pathname === '/api/images/list' && method === 'GET') {\r\n    try {\r\n      const prefix = url.searchParams.get('prefix') || '';\r\n      const listed = await env.IMAGES.list({ prefix });\r\n      \r\n      return successResponse({\r\n        files: listed.objects.map((obj) => ({\r\n          id: obj.key,\r\n          filename: obj.key.split('/').pop(),\r\n          uploaded: obj.uploaded.toISOString(),\r\n          size: obj.size,\r\n          url: `${R2_PUBLIC_URL}/${obj.key}`,\r\n        }))\r\n      });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // POST /api/images/upload\r\n  if (url.pathname === '/api/images/upload' && method === 'POST') {\r\n    try {\r\n      const formData = await request.formData();\r\n      const file = formData.get('file') as File;\r\n      const prefix = (formData.get('prefix') as string) || '';\r\n\r\n      if (!file) return errorResponse('No file provided', 400);\r\n\r\n      // Validate file size (max 10MB)\r\n      if (file.size > 10 * 1024 * 1024) {\r\n        return errorResponse('File too large. Max 10MB', 413);\r\n      }\r\n\r\n      // Validate file type\r\n      const allowedMimes = ['image/jpeg', 'image/png', 'image/webp', 'image/avif', 'image/gif'];\r\n      if (!allowedMimes.includes(file.type)) {\r\n        return errorResponse('Invalid file type. Only JPEG, PNG, WebP, AVIF, GIF allowed', 400);\r\n      }\r\n\r\n      // Generate unique filename\r\n      const timestamp = Date.now();\r\n      const randomString = Math.random().toString(36).substring(2, 15);\r\n      const extension = file.name.split('.').pop();\r\n      const filename = `${timestamp}-${randomString}.${extension}`;\r\n      const key = prefix ? `${prefix}${filename}` : filename;\r\n\r\n      // Upload to R2\r\n      const arrayBuffer = await file.arrayBuffer();\r\n      await env.IMAGES.put(key, arrayBuffer, {\r\n        httpMetadata: {\r\n          contentType: file.type,\r\n        },\r\n        customMetadata: {\r\n          originalName: file.name,\r\n          uploadedAt: new Date().toISOString(),\r\n        },\r\n      });\r\n\r\n      return successResponse({\r\n        success: true,\r\n        id: key,\r\n        filename: file.name,\r\n        key: key,\r\n        url: `${R2_PUBLIC_URL}/${key}`,\r\n        uploaded: new Date().toISOString(),\r\n      });\r\n    } catch (error) {\r\n      console.error('R2 upload error:', error);\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // DELETE /api/images/:imageId (supports nested paths)\r\n  if (url.pathname.startsWith('/api/images/') && method === 'DELETE') {\r\n    try {\r\n      const imageKey = url.pathname.replace('/api/images/', '');\r\n      \r\n      await env.IMAGES.delete(imageKey);\r\n\r\n      return successResponse({ success: true, message: 'Image deleted', key: imageKey });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  return errorResponse('Endpoint not found', 404);\r\n}\r\n\r\n// ==================== ADMIN ====================\r\nasync function handleAdmin(url: URL, method: string, body: any, env: Env): Promise<Response> {\r\n  // GET /api/admin/dashboard\r\n  if (url.pathname === '/api/admin/dashboard' && method === 'GET') {\r\n    try {\r\n      const [bookingsCount, amenitiesCount, usersCount, totalRevenue] = await Promise.all([\r\n        env.DB.prepare('SELECT COUNT(*) as count FROM bookings').first(),\r\n        env.DB.prepare('SELECT COUNT(*) as count FROM amenities').first(),\r\n        env.DB.prepare('SELECT COUNT(*) as count FROM users').first(),\r\n        env.DB.prepare('SELECT COALESCE(SUM(total_price), 0) as total FROM bookings WHERE payment_status = ?').bind('completed').first(),\r\n      ]);\r\n\r\n      return successResponse({\r\n        bookingsCount: (bookingsCount as any).count || 0,\r\n        amenitiesCount: (amenitiesCount as any).count || 0,\r\n        usersCount: (usersCount as any).count || 0,\r\n        totalRevenue: (totalRevenue as any).total || 0,\r\n      });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // GET /api/admin/analytics\r\n  if (url.pathname === '/api/admin/analytics' && method === 'GET') {\r\n    try {\r\n      const result = await env.DB.prepare(\r\n        'SELECT SUM(bookings_count) as bookings, SUM(revenue) as revenue, COUNT(*) as days FROM daily_analytics LIMIT 30'\r\n      ).first();\r\n      return successResponse(result);\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  return errorResponse('Endpoint not found', 404);\r\n}\r\n\r\n// ==================== SETTINGS ====================\r\nasync function handleSettings(url: URL, method: string, body: any, env: Env): Promise<Response> {\r\n  const pathParts = url.pathname.split('/').filter(Boolean);\r\n  const settingKey = pathParts[2];\r\n\r\n  // GET /api/settings - Get all settings\r\n  if (method === 'GET' && !settingKey) {\r\n    try {\r\n      // Try to get from KV first (faster)\r\n      const cachedSettings = await env.CACHE.get('app_settings', 'json');\r\n      if (cachedSettings) {\r\n        return successResponse(cachedSettings);\r\n      }\r\n\r\n      // Fallback to defaults\r\n      const defaultSettings = {\r\n        admin_email: env.ADMIN_EMAIL || 'danielsantosomarketing2017@gmail.com',\r\n        villa_name: env.VILLA_NAME || 'Best Villa Bali',\r\n        from_email: env.FROM_EMAIL || 'danielsantosomarketing2017@gmail.com',\r\n      };\r\n      return successResponse(defaultSettings);\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // GET /api/settings/:key - Get specific setting\r\n  if (method === 'GET' && settingKey) {\r\n    try {\r\n      const settings = await env.CACHE.get('app_settings', 'json') as any;\r\n      if (settings && settings[settingKey]) {\r\n        return successResponse({ key: settingKey, value: settings[settingKey] });\r\n      }\r\n      // Return env default\r\n      const defaults: any = {\r\n        admin_email: env.ADMIN_EMAIL || 'danielsantosomarketing2017@gmail.com',\r\n        villa_name: env.VILLA_NAME || 'Best Villa Bali',\r\n      };\r\n      return successResponse({ key: settingKey, value: defaults[settingKey] || null });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // POST /api/settings - Update settings\r\n  if (method === 'POST') {\r\n    try {\r\n      const { admin_email, villa_name, from_email } = body;\r\n      \r\n      // Get existing settings\r\n      const existing = await env.CACHE.get('app_settings', 'json') as any || {};\r\n      \r\n      // Merge with new values\r\n      const updatedSettings = {\r\n        ...existing,\r\n        admin_email: admin_email || existing.admin_email || env.ADMIN_EMAIL,\r\n        villa_name: villa_name || existing.villa_name || env.VILLA_NAME,\r\n        from_email: from_email || existing.from_email || env.FROM_EMAIL,\r\n        updated_at: new Date().toISOString(),\r\n      };\r\n\r\n      // Store in KV (no expiration - permanent)\r\n      await env.CACHE.put('app_settings', JSON.stringify(updatedSettings));\r\n\r\n      return successResponse({\r\n        message: 'Settings updated successfully',\r\n        settings: updatedSettings,\r\n      });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  // PUT /api/settings/:key - Update single setting\r\n  if (method === 'PUT' && settingKey) {\r\n    try {\r\n      const { value } = body;\r\n      \r\n      // Get existing settings\r\n      const existing = await env.CACHE.get('app_settings', 'json') as any || {};\r\n      \r\n      // Update specific key\r\n      existing[settingKey] = value;\r\n      existing.updated_at = new Date().toISOString();\r\n\r\n      // Store in KV\r\n      await env.CACHE.put('app_settings', JSON.stringify(existing));\r\n\r\n      return successResponse({\r\n        message: `Setting '${settingKey}' updated successfully`,\r\n        key: settingKey,\r\n        value: value,\r\n      });\r\n    } catch (error) {\r\n      return errorResponse(error.message);\r\n    }\r\n  }\r\n\r\n  return errorResponse('Settings endpoint not found', 404);\r\n}\r\n\r\n// Helper function to get admin email (checks KV first, then env)\r\nasync function getAdminEmail(env: Env): Promise<string> {\r\n  try {\r\n    const settings = await env.CACHE.get('app_settings', 'json') as any;\r\n    if (settings && settings.admin_email) {\r\n      return settings.admin_email;\r\n    }\r\n  } catch (e) {\r\n    console.error('Error getting admin email from KV:', e);\r\n  }\r\n  return env.ADMIN_EMAIL || 'danielsantosomarketing2017@gmail.com';\r\n}\r\n\r\n// ==================== EMAIL ====================\r\nasync function handleEmail(url: URL, method: string, body: any, env: Env): Promise<Response> {\r\n  if (method !== 'POST') {\r\n    return errorResponse('Only POST method allowed', 405);\r\n  }\r\n\r\n  const pathParts = url.pathname.split('/').filter(Boolean);\r\n  const action = pathParts[2];\r\n\r\n  try {\r\n    // Send booking confirmation email\r\n    if (action === 'booking-confirmation') {\r\n      const { booking_data } = body;\r\n      \r\n      if (!booking_data || !booking_data.guest_email) {\r\n        return errorResponse('Missing booking_data or guest_email', 400);\r\n      }\r\n\r\n      // Send real email via Resend API\r\n      const emailHtml = getBookingConfirmationHtml(booking_data, env);\r\n      const resendResult = await sendEmailViaResend(\r\n        env,\r\n        booking_data.guest_email,\r\n        `\uD83C\uDF89 Booking Confirmation - ${env.VILLA_NAME || 'Best Villa Bali'}`,\r\n        emailHtml\r\n      );\r\n\r\n      // Store email record in KV\r\n      await env.CACHE.put(\r\n        `email:${booking_data.booking_reference}:guest`,\r\n        JSON.stringify({\r\n          to: booking_data.guest_email,\r\n          type: 'booking_confirmation',\r\n          sent_at: new Date().toISOString(),\r\n          booking_data: booking_data,\r\n          resend_id: resendResult.id,\r\n        }),\r\n        { expirationTtl: 86400 * 30 }\r\n      );\r\n\r\n      return successResponse({\r\n        success: true,\r\n        message: 'Booking confirmation email sent successfully',\r\n        recipient: booking_data.guest_email,\r\n        booking_reference: booking_data.booking_reference,\r\n        timestamp: new Date().toISOString(),\r\n        email_id: resendResult.id,\r\n        resend_error: (resendResult as any).error || null,\r\n      });\r\n    }\r\n\r\n    // Send admin notification email\r\n    if (action === 'admin-notification') {\r\n      const { booking_data } = body;\r\n      // Get admin email from KV (dynamic) or fallback to env\r\n      const adminEmail = await getAdminEmail(env);\r\n\r\n      // Send real email via Resend API\r\n      const emailHtml = getAdminNotificationHtml(booking_data, env);\r\n      const resendResult = await sendEmailViaResend(\r\n        env,\r\n        adminEmail,\r\n        `\uD83D\uDD14 New Booking Alert - ${booking_data?.booking_reference || 'New Booking'}`,\r\n        emailHtml\r\n      );\r\n\r\n      // Store email record\r\n      await env.CACHE.put(\r\n        `email:${booking_data?.booking_reference}:admin`,\r\n        JSON.stringify({\r\n          to: adminEmail,\r\n          type: 'admin_notification',\r\n          sent_at: new Date().toISOString(),\r\n          booking_data: booking_data,\r\n          resend_id: resendResult.id,\r\n        }),\r\n        { expirationTtl: 86400 * 30 }\r\n      );\r\n\r\n      return successResponse({\r\n        success: true,\r\n        message: 'Admin notification email sent successfully',\r\n        recipient: adminEmail,\r\n        booking_reference: booking_data?.booking_reference,\r\n        timestamp: new Date().toISOString(),\r\n        email_id: resendResult.id,\r\n      });\r\n    }\r\n\r\n    // Send status change notification\r\n    if (action === 'status-change') {\r\n      const { booking_data, old_status, new_status } = body;\r\n      \r\n      const emailResult = {\r\n        success: true,\r\n        message: 'Status change notification sent',\r\n        booking_reference: booking_data?.booking_reference,\r\n        status_change: `${old_status} \u2192 ${new_status}`,\r\n        timestamp: new Date().toISOString(),\r\n      };\r\n\r\n      return successResponse(emailResult);\r\n    }\r\n\r\n    return errorResponse('Unknown email action', 400);\r\n  } catch (error) {\r\n    console.error('Email handler error:', error);\r\n    return errorResponse(error.message || 'Email service error', 500);\r\n  }\r\n}\r\n\r\n// ==================== RESEND EMAIL SERVICE ====================\r\nasync function sendEmailViaResend(env: Env, to: string, subject: string, html: string): Promise<{ id: string }> {\r\n  const RESEND_API_KEY = env.RESEND_API_KEY;\r\n  \r\n  if (!RESEND_API_KEY) {\r\n    console.error('RESEND_API_KEY not configured');\r\n    return { id: 'no-api-key' };\r\n  }\r\n\r\n  try {\r\n    const response = await fetch('https://api.resend.com/emails', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${RESEND_API_KEY}`,\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        from: `${env.VILLA_NAME || 'Best Villa Bali'} <booking@alphadigitalagency.id>`,\r\n        to: [to],\r\n        subject: subject,\r\n        html: html,\r\n      }),\r\n    });\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!response.ok) {\r\n      console.error('Resend API error:', result);\r\n      return { id: 'error-' + Date.now(), error: JSON.stringify(result) };\r\n    }\r\n\r\n    return { id: result.id || 'sent-' + Date.now() };\r\n  } catch (error) {\r\n    console.error('Resend fetch error:', error);\r\n    return { id: 'error-' + Date.now() };\r\n  }\r\n}\r\n\r\nfunction getBookingConfirmationHtml(booking: any, env: Env): string {\r\n  const villaName = env.VILLA_NAME || 'Best Villa Bali';\r\n  return `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <style>\r\n    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; }\r\n    .container { max-width: 600px; margin: 0 auto; padding: 20px; }\r\n    .header { background: #2E8B57; color: white; padding: 30px; text-align: center; border-radius: 8px 8px 0 0; }\r\n    .content { padding: 30px; background: #f9f9f9; }\r\n    .booking-details { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }\r\n    .detail-row { padding: 12px 0; border-bottom: 1px solid #eee; display: flex; }\r\n    .detail-label { font-weight: bold; color: #2E8B57; width: 40%; }\r\n    .detail-value { width: 60%; }\r\n    .footer { padding: 20px; text-align: center; font-size: 12px; color: #666; background: #f0f0f0; border-radius: 0 0 8px 8px; }\r\n    .highlight { background: #e8f5e8; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #2E8B57; }\r\n    h1 { margin: 0; font-size: 28px; }\r\n    h2 { margin: 10px 0 0; font-size: 18px; font-weight: normal; }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"container\">\r\n    <div class=\"header\">\r\n      <h1>\uD83C\uDFE8 ${villaName}</h1>\r\n      <h2>Booking Confirmation</h2>\r\n    </div>\r\n    <div class=\"content\">\r\n      <div class=\"highlight\">\r\n        <h3 style=\"margin-top:0;\">\u2705 Your booking has been confirmed!</h3>\r\n        <p style=\"margin-bottom:0;\"><strong>Booking Reference:</strong> ${booking.booking_reference || 'BK-' + Date.now()}</p>\r\n      </div>\r\n      \r\n      <div class=\"booking-details\">\r\n        <h3 style=\"margin-top:0;\">\uD83D\uDCCB Booking Details</h3>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Guest Name:</span>\r\n          <span class=\"detail-value\">${booking.guest_name || 'Guest'}</span>\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Email:</span>\r\n          <span class=\"detail-value\">${booking.guest_email || ''}</span>\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Check-in:</span>\r\n          <span class=\"detail-value\">${booking.check_in || 'TBD'}</span>\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Check-out:</span>\r\n          <span class=\"detail-value\">${booking.check_out || 'TBD'}</span>\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Guests:</span>\r\n          <span class=\"detail-value\">${booking.guests || '1'} guest(s)</span>\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Room/Package:</span>\r\n          <span class=\"detail-value\">${booking.room_name || 'Standard Room'}</span>\r\n        </div>\r\n        <div class=\"detail-row\" style=\"border-bottom:none;\">\r\n          <span class=\"detail-label\">Total Amount:</span>\r\n          <span class=\"detail-value\"><strong>$${booking.total_amount || '0.00'}</strong></span>\r\n        </div>\r\n      </div>\r\n      \r\n      <p>We look forward to welcoming you!</p>\r\n    </div>\r\n    <div class=\"footer\">\r\n      <p>Thank you for choosing ${villaName} for your Bali getaway.</p>\r\n      <p>${villaName} | Luxury Accommodation in Bali</p>\r\n      <p>Email sent: ${new Date().toLocaleDateString()}</p>\r\n    </div>\r\n  </div>\r\n</body>\r\n</html>`;\r\n}\r\n\r\nfunction getAdminNotificationHtml(booking: any, env: Env): string {\r\n  const villaName = env.VILLA_NAME || 'Best Villa Bali';\r\n  return `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <style>\r\n    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; }\r\n    .container { max-width: 600px; margin: 0 auto; padding: 20px; }\r\n    .header { background: #FF6B35; color: white; padding: 30px; text-align: center; border-radius: 8px 8px 0 0; }\r\n    .content { padding: 30px; background: #f9f9f9; }\r\n    .booking-details { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }\r\n    .detail-row { padding: 12px 0; border-bottom: 1px solid #eee; }\r\n    .detail-label { font-weight: bold; color: #FF6B35; display: inline-block; width: 40%; }\r\n    .footer { padding: 20px; text-align: center; font-size: 12px; color: #666; background: #f0f0f0; border-radius: 0 0 8px 8px; }\r\n    .alert { background: #fff3cd; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #FF6B35; }\r\n    h1 { margin: 0; font-size: 28px; }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"container\">\r\n    <div class=\"header\">\r\n      <h1>\uD83D\uDD14 New Booking Alert</h1>\r\n      <p style=\"margin:10px 0 0;\">${villaName}</p>\r\n    </div>\r\n    <div class=\"content\">\r\n      <div class=\"alert\">\r\n        <h3 style=\"margin-top:0;\">\u26A1 New booking received!</h3>\r\n        <p style=\"margin-bottom:0;\"><strong>Action Required:</strong> Review and confirm booking details</p>\r\n      </div>\r\n      \r\n      <div class=\"booking-details\">\r\n        <h3 style=\"margin-top:0;\">\uD83D\uDCCB Booking Information</h3>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Booking Ref:</span> ${booking?.booking_reference || 'N/A'}\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Guest Name:</span> ${booking?.guest_name || 'Guest'}\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Email:</span> ${booking?.guest_email || 'N/A'}\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Phone:</span> ${booking?.guest_phone || booking?.phone || 'Not provided'}\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Check-in:</span> ${booking?.check_in || 'TBD'}\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Check-out:</span> ${booking?.check_out || 'TBD'}\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Guests:</span> ${booking?.guests || '1'} guest(s)\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Room/Package:</span> ${booking?.room_name || 'Standard Room'}\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Total Amount:</span> <strong>$${booking?.total_amount || '0.00'}</strong>\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Booking Time:</span> ${new Date().toISOString()}\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"footer\">\r\n      <p>${villaName} - Admin Notification System</p>\r\n      <p>${new Date().toLocaleDateString()}</p>\r\n    </div>\r\n  </div>\r\n</body>\r\n</html>`;\r\n}\r\n\r\nexport default {\r\n  async fetch(request: Request, env: Env): Promise<Response> {\r\n    // Handle CORS preflight\r\n    if (request.method === 'OPTIONS') {\r\n      return new Response(null, {\r\n        headers: {\r\n          'Access-Control-Allow-Origin': '*',\r\n          'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\r\n          'Access-Control-Allow-Headers': 'Content-Type, Authorization',\r\n        },\r\n      });\r\n    }\r\n\r\n    return handleRequest(request, env);\r\n  },\r\n};\r\n"],
  "mappings": "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",
  "names": []
}
