<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel API Diagnostics - Console & Network Monitor</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2em;
        }
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        .content {
            padding: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: #fafafa;
        }
        .section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .console-log {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .api-call {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 4px 4px 0;
        }
        .api-call.localhost {
            border-left-color: #dc3545;
            background: #fff5f5;
        }
        .api-call.production {
            border-left-color: #28a745;
            background: #f0fff4;
        }
        .button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background 0.3s;
        }
        .button:hover {
            background: #5a6fd8;
        }
        .button.danger {
            background: #dc3545;
        }
        .button.danger:hover {
            background: #c82333;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-green { background: #28a745; }
        .status-red { background: #dc3545; }
        .status-yellow { background: #ffc107; }
        .network-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .network-table th,
        .network-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .network-table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        .network-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        .live-indicator {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .timestamp {
            color: #666;
            font-size: 12px;
        }
        .code-block {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            border: 1px solid #e9ecef;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Admin Panel API Diagnostics</h1>
            <p>Real-time monitoring of console logs and API calls for http://127.0.0.1:8080/admin</p>
            <div id="liveStatus" class="live-indicator">
                <span class="status-indicator status-green"></span>
                <strong>Monitoring Active</strong>
            </div>
        </div>

        <div class="content">
            <!-- Quick Actions -->
            <div class="section">
                <h2>üöÄ Quick Actions</h2>
                <button class="button" onclick="openAdminPanel()">Open Admin Panel</button>
                <button class="button" onclick="clearLogs()">Clear All Logs</button>
                <button class="button" onclick="exportLogs()">Export Diagnostics</button>
                <button class="button danger" onclick="simulateApiCalls()">Test API Calls</button>
            </div>

            <!-- Current Environment Info -->
            <div class="section">
                <h2>üåç Environment Information</h2>
                <div id="envInfo">Loading environment info...</div>
            </div>

            <!-- Console Logs Monitor -->
            <div class="section">
                <h2>üìù Console Logs Monitor</h2>
                <p>Real-time console logs from the admin panel (errors, warnings, info)</p>
                <div class="console-log" id="consoleLogs">
                    <div class="timestamp">[Loading...] Waiting for console logs...</div>
                </div>
            </div>

            <!-- Network Requests Monitor -->
            <div class="section">
                <h2>üåê Network Requests Monitor</h2>
                <p>All API calls made by the admin panel, showing URLs and response status</p>
                <table class="network-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Method</th>
                            <th>URL</th>
                            <th>Status</th>
                            <th>Type</th>
                            <th>Response Time</th>
                        </tr>
                    </thead>
                    <tbody id="networkRequests">
                        <tr>
                            <td colspan="6" style="text-align: center; color: #666;">
                                Waiting for network requests...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- API Endpoints Analysis -->
            <div class="section">
                <h2>üéØ API Endpoints Analysis</h2>
                <div id="apiAnalysis">
                    <p>Click "Test API Calls" to analyze which endpoints are being used</p>
                </div>
            </div>

            <!-- Error Summary -->
            <div class="section">
                <h2>‚ùå Error Summary</h2>
                <div id="errorSummary">
                    <p>No errors detected yet. Errors will appear here automatically.</p>
                </div>
            </div>

            <!-- Instructions -->
            <div class="section">
                <h2>üìã How to Use This Tool</h2>
                <ol>
                    <li><strong>Open Admin Panel:</strong> Click "Open Admin Panel" to launch the admin interface</li>
                    <li><strong>Monitor Console:</strong> Watch the "Console Logs Monitor" for any errors or API calls</li>
                    <li><strong>Check Network:</strong> The "Network Requests Monitor" shows all HTTP requests in real-time</li>
                    <li><strong>Look for Issues:</strong> Red entries indicate localhost calls (should be production API)</li>
                    <li><strong>Export Data:</strong> Use "Export Diagnostics" to save the results for analysis</li>
                </ol>
                
                <div class="code-block">
                    <strong>Expected Behavior:</strong><br>
                    ‚úÖ All API calls should go to: https://api.rumahdaisycantik.com/<br>
                    ‚ùå No calls should go to: http://localhost/ or http://127.0.0.1/<br>
                    ‚úÖ Console should show: "Production API Configuration" logs<br>
                    ‚ùå Console should not show: localhost API errors
                </div>
            </div>
        </div>
    </div>

    <script>
        let logs = [];
        let networkRequests = [];
        let errorCount = 0;

        // Initialize monitoring
        function initializeMonitoring() {
            setupConsoleInterception();
            setupNetworkInterception();
            loadEnvironmentInfo();
            setInterval(updateLiveStatus, 1000);
        }

        // Console log interception
        function setupConsoleInterception() {
            const originalConsole = {
                log: console.log,
                error: console.error,
                warn: console.warn,
                info: console.info
            };

            ['log', 'error', 'warn', 'info'].forEach(method => {
                console[method] = function(...args) {
                    const timestamp = new Date().toLocaleTimeString();
                    const message = args.map(arg => 
                        typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
                    ).join(' ');
                    
                    logs.push({
                        timestamp,
                        level: method,
                        message,
                        args
                    });

                    updateConsoleDisplay();
                    
                    if (method === 'error') {
                        errorCount++;
                        updateErrorSummary();
                    }

                    // Call original console method
                    originalConsole[method].apply(console, args);
                };
            });
        }

        // Network request interception
        function setupNetworkInterception() {
            const originalFetch = window.fetch;
            
            window.fetch = async function(url, options = {}) {
                const startTime = Date.now();
                const timestamp = new Date().toLocaleTimeString();
                const method = options.method || 'GET';
                
                try {
                    const response = await originalFetch(url, options);
                    const responseTime = Date.now() - startTime;
                    
                    const isLocalhost = url.includes('localhost') || url.includes('127.0.0.1');
                    const isProduction = url.includes('api.rumahdaisycantik.com');
                    
                    networkRequests.push({
                        timestamp,
                        method,
                        url: String(url),
                        status: response.status,
                        statusText: response.statusText,
                        responseTime,
                        type: isLocalhost ? 'localhost' : isProduction ? 'production' : 'other',
                        success: response.ok
                    });

                    updateNetworkDisplay();
                    updateApiAnalysis();
                    
                    return response;
                } catch (error) {
                    const responseTime = Date.now() - startTime;
                    
                    networkRequests.push({
                        timestamp,
                        method,
                        url: String(url),
                        status: 'ERROR',
                        statusText: error.message,
                        responseTime,
                        type: 'error',
                        success: false
                    });

                    updateNetworkDisplay();
                    throw error;
                }
            };
        }

        // Update console display
        function updateConsoleDisplay() {
            const consoleDiv = document.getElementById('consoleLogs');
            const recentLogs = logs.slice(-50); // Show last 50 logs
            
            consoleDiv.innerHTML = recentLogs.map(log => {
                const levelColor = {
                    error: '#ff6b6b',
                    warn: '#ffd93d',
                    info: '#74c0fc',
                    log: '#d4d4d4'
                }[log.level] || '#d4d4d4';
                
                return `<div style="color: ${levelColor}; margin: 5px 0;">
                    <span class="timestamp">[${log.timestamp}]</span>
                    <strong>[${log.level.toUpperCase()}]</strong>
                    ${log.message}
                </div>`;
            }).join('');
            
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        // Update network display
        function updateNetworkDisplay() {
            const tbody = document.getElementById('networkRequests');
            const recentRequests = networkRequests.slice(-20); // Show last 20 requests
            
            if (recentRequests.length === 0) return;
            
            tbody.innerHTML = recentRequests.map(req => {
                const statusColor = req.success ? '#28a745' : '#dc3545';
                const typeColor = req.type === 'localhost' ? '#dc3545' : 
                                req.type === 'production' ? '#28a745' : '#ffc107';
                
                return `<tr>
                    <td class="timestamp">${req.timestamp}</td>
                    <td><strong>${req.method}</strong></td>
                    <td style="color: ${typeColor}; font-family: monospace; font-size: 12px;">
                        ${req.url.length > 60 ? req.url.substring(0, 60) + '...' : req.url}
                    </td>
                    <td style="color: ${statusColor}; font-weight: bold;">
                        ${req.status} ${req.statusText}
                    </td>
                    <td>
                        <span class="status-indicator ${req.type === 'localhost' ? 'status-red' : 
                                                      req.type === 'production' ? 'status-green' : 'status-yellow'}"></span>
                        ${req.type}
                    </td>
                    <td>${req.responseTime}ms</td>
                </tr>`;
            }).join('');
        }

        // Update API analysis
        function updateApiAnalysis() {
            const analysisDiv = document.getElementById('apiAnalysis');
            
            const localhostCalls = networkRequests.filter(req => req.type === 'localhost').length;
            const productionCalls = networkRequests.filter(req => req.type === 'production').length;
            const otherCalls = networkRequests.filter(req => req.type === 'other').length;
            const errorCalls = networkRequests.filter(req => !req.success).length;
            
            const uniqueUrls = [...new Set(networkRequests.map(req => req.url))];
            
            analysisDiv.innerHTML = `
                <div class="api-call ${localhostCalls > 0 ? 'localhost' : 'production'}">
                    <h3>üìä API Call Summary</h3>
                    <p><strong>Total Requests:</strong> ${networkRequests.length}</p>
                    <p><strong>üî¥ Localhost Calls:</strong> ${localhostCalls} ${localhostCalls > 0 ? '(‚ùå Should be 0!)' : '(‚úÖ Good!)'}</p>
                    <p><strong>üü¢ Production Calls:</strong> ${productionCalls} ${productionCalls > 0 ? '(‚úÖ Good!)' : ''}</p>
                    <p><strong>üü° Other Calls:</strong> ${otherCalls}</p>
                    <p><strong>‚ùå Failed Calls:</strong> ${errorCalls}</p>
                    <p><strong>üîó Unique URLs:</strong> ${uniqueUrls.length}</p>
                </div>
                
                <div class="code-block">
                    <strong>Unique Endpoints Called:</strong><br>
                    ${uniqueUrls.map(url => {
                        const isLocalhost = url.includes('localhost') || url.includes('127.0.0.1');
                        const color = isLocalhost ? '#dc3545' : '#28a745';
                        return `<span style="color: ${color};">${url}</span>`;
                    }).join('<br>')}
                </div>
            `;
        }

        // Update error summary
        function updateErrorSummary() {
            const errorDiv = document.getElementById('errorSummary');
            const errors = logs.filter(log => log.level === 'error');
            
            if (errors.length === 0) {
                errorDiv.innerHTML = '<p style="color: #28a745;">‚úÖ No errors detected!</p>';
                return;
            }
            
            errorDiv.innerHTML = `
                <div style="color: #dc3545; font-weight: bold;">
                    ‚ùå ${errors.length} error(s) detected:
                </div>
                ${errors.slice(-10).map(error => `
                    <div class="api-call localhost">
                        <strong>[${error.timestamp}]</strong> ${error.message}
                    </div>
                `).join('')}
            `;
        }

        // Load environment information
        function loadEnvironmentInfo() {
            const envDiv = document.getElementById('envInfo');
            
            // Try to detect current environment
            const currentUrl = window.location.href;
            const userAgent = navigator.userAgent;
            const timestamp = new Date().toLocaleString();
            
            envDiv.innerHTML = `
                <div class="code-block">
                    <strong>Current URL:</strong> ${currentUrl}<br>
                    <strong>User Agent:</strong> ${userAgent}<br>
                    <strong>Timestamp:</strong> ${timestamp}<br>
                    <strong>Admin Panel URL:</strong> <a href="http://127.0.0.1:8080/admin" target="_blank">http://127.0.0.1:8080/admin</a><br>
                    <strong>Expected API:</strong> <span style="color: #28a745;">https://api.rumahdaisycantik.com</span><br>
                    <strong>Forbidden API:</strong> <span style="color: #dc3545;">http://localhost/</span>
                </div>
            `;
        }

        // Button actions
        function openAdminPanel() {
            window.open('http://127.0.0.1:8080/admin', '_blank');
        }

        function clearLogs() {
            logs = [];
            networkRequests = [];
            errorCount = 0;
            updateConsoleDisplay();
            updateNetworkDisplay();
            updateApiAnalysis();
            updateErrorSummary();
            
            console.log('üßπ Diagnostics cleared at', new Date().toLocaleTimeString());
        }

        function exportLogs() {
            const data = {
                timestamp: new Date().toISOString(),
                environment: window.location.href,
                consoleLogs: logs,
                networkRequests: networkRequests,
                errorCount: errorCount,
                summary: {
                    totalRequests: networkRequests.length,
                    localhostCalls: networkRequests.filter(req => req.type === 'localhost').length,
                    productionCalls: networkRequests.filter(req => req.type === 'production').length,
                    errors: logs.filter(log => log.level === 'error').length
                }
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `admin-diagnostics-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function simulateApiCalls() {
            console.log('üß™ Testing API endpoints...');
            
            // Test production API
            fetch('https://api.rumahdaisycantik.com/rooms.php')
                .then(response => console.log('‚úÖ Production API test:', response.status))
                .catch(error => console.error('‚ùå Production API test failed:', error));
            
            // Test what would be a localhost call (should fail in browser)
            console.warn('‚ö†Ô∏è Testing localhost API (should fail in browser due to CORS)');
            fetch('http://localhost/fontend-bookingengine-100/frontend-booking-engine-1/api/rooms.php')
                .then(response => console.warn('üî¥ Localhost API unexpectedly accessible:', response.status))
                .catch(error => console.log('‚úÖ Localhost API correctly blocked:', error.message));
        }

        function updateLiveStatus() {
            const statusDiv = document.getElementById('liveStatus');
            const recentActivity = logs.length + networkRequests.length;
            
            if (recentActivity > 0) {
                statusDiv.innerHTML = `
                    <span class="status-indicator status-green"></span>
                    <strong>Monitoring Active</strong> - ${logs.length} logs, ${networkRequests.length} requests
                `;
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeMonitoring);
        
        // Add welcome message
        console.log('üîç Admin Panel API Diagnostics Tool Loaded');
        console.log('üìä This tool will monitor all console logs and network requests');
        console.log('üéØ Goal: Ensure all API calls go to https://api.rumahdaisycantik.com');
        console.log('‚ùå Alert: Any localhost calls should be flagged as issues');
    </script>
</body>
</html>