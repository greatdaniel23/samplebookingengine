<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Gallery - Villa Booking Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .image-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .image-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .copy-btn {
            transition: background-color 0.2s;
        }
        .copy-btn:hover {
            background-color: #f3f4f6;
        }
        
        /* Lazy loading and image optimization styles */
        .image-placeholder {
            background: linear-gradient(45deg, #f0f0f0 25%, transparent 25%), 
                        linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #f0f0f0 75%), 
                        linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            animation: loading 1.5s infinite linear;
        }
        
        @keyframes loading {
            0% { background-position: 0 0, 0 10px, 10px -10px, -10px 0px; }
            100% { background-position: 20px 20px, 20px 30px, 30px 10px, 10px 20px; }
        }
        
        .lazy-image {
            transition: opacity 0.3s ease-in-out;
        }
        
        .opacity-0 {
            opacity: 0;
        }
        
        .opacity-100 {
            opacity: 1;
        }
        
        .max-w-32 {
            max-width: 8rem;
        }
        
        .max-h-32 {
            max-height: 8rem;
        }
        
        .image-error {
            background-color: #fef2f2;
            border: 2px dashed #fca5a5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #dc2626;
            font-size: 0.875rem;
            padding: 1rem;
        }
        
        .file-size {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }

        .loading-spinner {
            border: 2px solid #f3f4f6;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .thumbnail-mode .image-container {
            background-color: #f9fafb;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-7xl mx-auto p-6">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-4 flex items-center gap-3">
                <i class="fas fa-images text-blue-600"></i>
                Image Gallery Manager
            </h1>
            <p class="text-gray-600 text-lg">
                Browse and manage all images from the <code class="bg-gray-200 px-2 py-1 rounded">/public/images</code> directory
            </p>
        </div>

        <!-- Statistics -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-white rounded-lg shadow p-4">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Total Images</p>
                        <p class="text-2xl font-bold text-blue-600" id="total-images">0</p>
                    </div>
                    <i class="fas fa-image text-2xl text-blue-600"></i>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow p-4">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Categories</p>
                        <p class="text-2xl font-bold text-green-600">6</p>
                    </div>
                    <i class="fas fa-folder-open text-2xl text-green-600"></i>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow p-4">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Hero Images</p>
                        <p class="text-2xl font-bold text-red-600">26</p>
                    </div>
                    <i class="fas fa-image text-2xl text-red-600"></i>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow p-4">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Filtered</p>
                        <p class="text-2xl font-bold text-purple-600" id="filtered-count">0</p>
                    </div>
                    <i class="fas fa-search text-2xl text-purple-600"></i>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">Filters & Search</h2>
                <div class="flex items-center gap-4">
                    <!-- Loading Mode Toggle -->
                    <div class="flex items-center gap-2">
                        <label class="text-sm font-medium text-gray-700">Loading Mode:</label>
                        <div class="flex gap-1">
                            <button data-loading-mode="lazy" class="px-2 py-1 text-xs bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">
                                Lazy
                            </button>
                            <button data-loading-mode="thumbnail" class="px-2 py-1 text-xs bg-blue-500 text-white rounded-md hover:bg-blue-600">
                                Thumbnail
                            </button>
                            <button data-loading-mode="full" class="px-2 py-1 text-xs bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">
                                Full
                            </button>
                        </div>
                    </div>
                    <!-- Grid Size -->
                    <div class="flex items-center gap-2">
                        <label class="text-sm font-medium text-gray-700">Grid:</label>
                        <div class="flex gap-1">
                            <button data-grid-size="small" class="px-2 py-1 text-xs bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">
                                Small
                            </button>
                            <button data-grid-size="medium" class="px-2 py-1 text-xs bg-blue-500 text-white rounded-md hover:bg-blue-600">
                                Medium
                            </button>
                            <button data-grid-size="large" class="px-2 py-1 text-xs bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">
                                Large
                            </button>
                        </div>
                    </div>
                    <!-- Refresh Button -->
                    <button id="refresh-btn" class="px-3 py-1 text-sm bg-green-100 text-green-800 rounded-md hover:bg-green-200">
                        <i class="fas fa-refresh mr-1"></i>
                        Refresh
                    </button>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Search Images</label>
                    <div class="relative">
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input
                            type="text"
                            id="search-input"
                            placeholder="Search by name or category..."
                            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        />
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                    <select id="category-filter" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="all">All Categories</option>
                        <option value="hero">Hero (26)</option>
                        <option value="packages">Packages (2)</option>
                        <option value="amenities">Amenities (4)</option>
                        <option value="ui">UI (3)</option>
                        <option value="rooms">Rooms (0)</option>
                        <option value="villa">Villa (0)</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">File Type</label>
                    <select id="type-filter" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="all">All Types</option>
                        <option value="jpg">JPG</option>
                        <option value="png">PNG</option>
                        <option value="svg">SVG</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Sort By</label>
                    <select id="sort-filter" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="name">Name (A-Z)</option>
                        <option value="name-desc">Name (Z-A)</option>
                        <option value="category">Category</option>
                        <option value="type">File Type</option>
                        <option value="size">File Size</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Image Grid -->
        <div id="image-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Images will be populated by JavaScript -->
        </div>

        <!-- No Results -->
        <div id="no-results" class="bg-white rounded-lg shadow text-center py-12 hidden">
            <i class="fas fa-image text-6xl text-gray-400 mb-4"></i>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">No images found</h3>
            <p class="text-gray-600">
                Try adjusting your search terms or filters to find what you're looking for.
            </p>
        </div>

        <!-- Directory Structure Info -->
        <div class="bg-white rounded-lg shadow p-6 mt-8">
            <h3 class="text-lg font-semibold mb-4">Directory Structure</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-medium text-gray-900 mb-2 flex items-center gap-2">
                        <i class="fas fa-folder-open text-sm"></i>
                        /images/hero/
                    </h4>
                    <p class="text-sm text-gray-600">26 files</p>
                    <p class="text-xs text-gray-500 mt-1">Types: jpg</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-medium text-gray-900 mb-2 flex items-center gap-2">
                        <i class="fas fa-folder-open text-sm"></i>
                        /images/packages/
                    </h4>
                    <p class="text-sm text-gray-600">2 files</p>
                    <p class="text-xs text-gray-500 mt-1">Types: jpg</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-medium text-gray-900 mb-2 flex items-center gap-2">
                        <i class="fas fa-folder-open text-sm"></i>
                        /images/amenities/
                    </h4>
                    <p class="text-sm text-gray-600">4 files</p>
                    <p class="text-xs text-gray-500 mt-1">Types: svg</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-medium text-gray-900 mb-2 flex items-center gap-2">
                        <i class="fas fa-folder-open text-sm"></i>
                        /images/ui/
                    </h4>
                    <p class="text-sm text-gray-600">3 files</p>
                    <p class="text-xs text-gray-500 mt-1">Types: svg</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-medium text-gray-900 mb-2 flex items-center gap-2">
                        <i class="fas fa-folder-open text-sm"></i>
                        /images/rooms/
                    </h4>
                    <p class="text-sm text-gray-600">0 files (empty)</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-medium text-gray-900 mb-2 flex items-center gap-2">
                        <i class="fas fa-folder-open text-sm"></i>
                        /images/villa/
                    </h4>
                    <p class="text-sm text-gray-600">0 files (empty)</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg hidden transform transition-transform duration-300">
        <i class="fas fa-check mr-2"></i>
        <span id="toast-message">Copied to clipboard!</span>
    </div>

    <script>
        // Image inventory with estimated file sizes (KB) based on the current /public/images structure
        const imageInventory = {
            hero: [
                { name: 'DSC02125.JPG', size: 850 }, { name: 'DSC02126.JPG', size: 920 }, 
                { name: 'DSC02129.JPG', size: 780 }, { name: 'DSC02132.JPG', size: 950 }, 
                { name: 'DSC02137.JPG', size: 820 }, { name: 'DSC02140.JPG', size: 890 }, 
                { name: 'DSC02176.JPG', size: 910 }, { name: 'DSC02188.JPG', size: 870 }, 
                { name: 'DSC02192.JPG', size: 840 }, { name: 'DSC02199.JPG', size: 930 },
                { name: 'DSC06769.JPG', size: 750 }, { name: 'DSC06778.JPG', size: 880 }, 
                { name: 'DSC06793.JPG', size: 940 }, { name: 'DSC06806.JPG', size: 860 }, 
                { name: 'DSC06813.JPG', size: 790 }, { name: 'DSC06817.JPG', size: 850 }, 
                { name: 'DSC06826.JPG', size: 920 }, { name: 'DSC06840.JPG', size: 810 }, 
                { name: 'DSCF0006.jpg', size: 980 }, { name: 'DSCF0009.jpg', size: 950 },
                { name: 'DSCF0013.jpg', size: 890 }, { name: 'DSCF0015.jpg', size: 920 }, 
                { name: 'DSCF0019.jpg', size: 870 }, { name: 'villa-living.jpg', size: 420 }, 
                { name: 'villa-main.jpg', size: 380 }, { name: 'villa-pool.jpg', size: 450 }
            ],
            packages: [
                { name: 'business-elite.jpg', size: 320 },
                { name: 'romantic-escape.jpg', size: 350 }
            ],
            amenities: [
                { name: 'air-conditioning.svg', size: 2 },
                { name: 'balcony.svg', size: 1.5 },
                { name: 'tv.svg', size: 1.8 },
                { name: 'wifi.svg', size: 1.2 }
            ],
            ui: [
                { name: 'no-image.svg', size: 0.8 },
                { name: 'placeholder-villa.svg', size: 1.1 },
                { name: 'placeholder.svg', size: 0.9 }
            ],
            rooms: [], // Currently empty
            villa: []  // Currently empty
        };

        let allImages = [];
        let filteredImages = [];
        let currentGridSize = 'medium'; // small, medium, large
        let currentLoadingMode = 'thumbnail'; // lazy, thumbnail, full
        let lazyLoadObserver;
        let loadedImagesCache = new Set();

        // Generate full image inventory
        function generateImageList() {
            allImages = [];
            
            Object.entries(imageInventory).forEach(([category, files]) => {
                files.forEach(fileInfo => {
                    const filename = typeof fileInfo === 'string' ? fileInfo : fileInfo.name;
                    const fileSize = typeof fileInfo === 'object' ? fileInfo.size : 100; // Default 100KB
                    
                    const extension = filename.split('.').pop()?.toLowerCase() || '';
                    const type = ['jpg', 'jpeg'].includes(extension) ? 'jpg' : 
                                extension === 'png' ? 'png' : 
                                extension === 'svg' ? 'svg' : 'other';
                    
                    allImages.push({
                        name: filename,
                        category,
                        url: `images/${category}/${filename}`,
                        fullUrl: `http://localhost/fontend-bookingengine-100/frontend-booking-engine-1/public/images/${category}/${filename}`,
                        type,
                        size: fileSize,
                        id: `${category}-${filename}`.replace(/[^a-zA-Z0-9]/g, '-')
                    });
                });
            });

            filteredImages = [...allImages];
            initializeLazyLoading();
            updateUI();
        }

        // Initialize intersection observer for lazy loading
        function initializeLazyLoading() {
            if (lazyLoadObserver) {
                lazyLoadObserver.disconnect();
            }

            lazyLoadObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        const container = img.closest('.image-container');
                        loadImage(img, container);
                        lazyLoadObserver.unobserve(img);
                    }
                });
            }, {
                rootMargin: '50px 0px',
                threshold: 0.1
            });
        }

        // Load individual image with loading states
        function loadImage(img, container) {
            const imageId = img.dataset.imageId;
            if (loadedImagesCache.has(imageId)) {
                img.src = img.dataset.src;
                img.classList.remove('opacity-0');
                img.classList.add('opacity-100');
                return;
            }

            // Show loading state
            container.classList.add('image-placeholder');
            
            const tempImg = new Image();
            tempImg.onload = () => {
                img.src = img.dataset.src;
                img.classList.remove('opacity-0');
                img.classList.add('opacity-100');
                container.classList.remove('image-placeholder');
                loadedImagesCache.add(imageId);
            };
            
            tempImg.onerror = () => {
                img.classList.remove('opacity-0');
                img.src = 'images/ui/no-image.svg';
                container.classList.remove('image-placeholder');
                console.warn(`Failed to load image: ${img.dataset.filename}`);
            };
            
            tempImg.src = img.dataset.src;
        }

        // Update statistics and image grid
        function updateUI() {
            document.getElementById('total-images').textContent = allImages.length;
            document.getElementById('filtered-count').textContent = filteredImages.length;
            
            const imageGrid = document.getElementById('image-grid');
            const noResults = document.getElementById('no-results');
            
            if (filteredImages.length === 0) {
                imageGrid.innerHTML = '';
                noResults.classList.remove('hidden');
            } else {
                noResults.classList.add('hidden');
                imageGrid.innerHTML = filteredImages.map(image => createImageCard(image)).join('');
            }
        }

        // Create image card HTML
        function createImageCard(image) {
            const categoryColors = {
                hero: 'bg-red-100 text-red-800',
                packages: 'bg-blue-100 text-blue-800',
                amenities: 'bg-green-100 text-green-800',
                ui: 'bg-purple-100 text-purple-800',
                rooms: 'bg-yellow-100 text-yellow-800',
                villa: 'bg-pink-100 text-pink-800'
            };

            const typeColors = {
                jpg: 'bg-blue-100 text-blue-800',
                png: 'bg-green-100 text-green-800',
                svg: 'bg-purple-100 text-purple-800',
                other: 'bg-gray-100 text-gray-800'
            };

            const sizeDisplay = image.size > 1000 ? `${(image.size/1000).toFixed(1)}MB` : `${image.size}KB`;
            
            // Generate image HTML based on loading mode
            let imageHTML = '';
            const fallbackImage = 'images/ui/no-image.svg';
            
            if (currentLoadingMode === 'lazy') {
                // For lazy loading, use data-src and show placeholder initially
                imageHTML = image.type === 'svg' ? 
                    `<img data-src="${image.fullUrl}" alt="${image.name}" class="max-w-full max-h-full object-contain p-4 lazy-image opacity-0" data-image-id="${image.id}" data-filename="${image.name}" onerror="this.src='${fallbackImage}'">` :
                    `<img data-src="${image.fullUrl}" alt="${image.name}" class="w-full h-full object-cover lazy-image opacity-0" data-image-id="${image.id}" data-filename="${image.name}" onerror="this.src='${fallbackImage}'">`;
            } else if (currentLoadingMode === 'thumbnail') {
                // For thumbnail mode, load immediately but with size constraints
                imageHTML = image.type === 'svg' ? 
                    `<img src="${image.fullUrl}" alt="${image.name}" class="max-w-32 max-h-32 object-contain p-2" onerror="this.src='${fallbackImage}'">` :
                    `<img src="${image.fullUrl}" alt="${image.name}" class="max-w-32 max-h-32 object-cover rounded" onerror="this.src='${fallbackImage}'">`;
            } else {
                // Full loading mode - load full images immediately
                imageHTML = image.type === 'svg' ? 
                    `<img src="${image.fullUrl}" alt="${image.name}" class="max-w-full max-h-full object-contain p-4" onerror="this.src='${fallbackImage}'">` :
                    `<img src="${image.fullUrl}" alt="${image.name}" class="w-full h-full object-cover" onerror="this.src='${fallbackImage}'">`;
            }

            return `
                <div class="bg-white rounded-lg shadow overflow-hidden image-card ${currentLoadingMode}-mode" data-size="${image.size}">
                    <div class="aspect-square bg-gray-100 flex items-center justify-center overflow-hidden image-container">
                        ${imageHTML}
                        ${currentLoadingMode === 'lazy' ? '<div class="image-placeholder hidden"><div class="loading-spinner"></div></div>' : ''}
                    </div>
                    
                    <div class="p-4">
                        <div class="mb-3">
                            <h3 class="font-semibold text-gray-900 truncate" title="${image.name}">
                                ${image.name}
                            </h3>
                            <div class="flex gap-2 mt-2 flex-wrap">
                                <span class="px-2 py-1 text-xs rounded-full ${categoryColors[image.category] || 'bg-gray-100 text-gray-800'}">
                                    ${image.category}
                                </span>
                                <span class="px-2 py-1 text-xs rounded-full ${typeColors[image.type] || 'bg-gray-100 text-gray-800'}">
                                    ${image.type.toUpperCase()}
                                </span>
                                <span class="px-2 py-1 text-xs rounded-full ${image.size > 500 ? 'bg-orange-100 text-orange-800' : 'bg-gray-100 text-gray-800'}">
                                    ${sizeDisplay}
                                </span>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <div>
                                <label class="text-xs text-gray-500">Relative URL:</label>
                                <div class="flex items-center gap-2">
                                    <code class="text-xs bg-gray-100 p-1 rounded flex-1 truncate">
                                        ${image.url}
                                    </code>
                                    <button class="copy-btn p-1 rounded hover:bg-gray-100" onclick="copyToClipboard('${image.url}', 'Relative URL')">
                                        <i class="fas fa-copy text-xs"></i>
                                    </button>
                                </div>
                            </div>

                            <div>
                                <label class="text-xs text-gray-500">Full URL:</label>
                                <div class="flex items-center gap-2">
                                    <code class="text-xs bg-gray-100 p-1 rounded flex-1 truncate">
                                        ${image.fullUrl}
                                    </code>
                                    <button class="copy-btn p-1 rounded hover:bg-gray-100" onclick="copyToClipboard('${image.fullUrl}', 'Full URL')">
                                        <i class="fas fa-copy text-xs"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="flex gap-2 pt-2">
                                <button class="flex-1 px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50" onclick="window.open('${image.fullUrl}', '_blank')">
                                    View
                                </button>
                                <button class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50" onclick="downloadImage('${image.fullUrl}', '${image.name}')">
                                    <i class="fas fa-download text-xs"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Filter images based on search and filters
        function filterImages() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const selectedCategory = document.getElementById('category-filter').value;
            const selectedType = document.getElementById('type-filter').value;

            filteredImages = allImages.filter(image => {
                const matchesSearch = !searchTerm || 
                    image.name.toLowerCase().includes(searchTerm) ||
                    image.category.toLowerCase().includes(searchTerm);
                
                const matchesCategory = selectedCategory === 'all' || image.category === selectedCategory;
                const matchesType = selectedType === 'all' || image.type === selectedType;

                return matchesSearch && matchesCategory && matchesType;
            });

            updateUI();
        }

        // Copy to clipboard function
        function copyToClipboard(text, type) {
            navigator.clipboard.writeText(text).then(() => {
                showToast(`${type} copied to clipboard!`);
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast(`${type} copied to clipboard!`);
            });
        }

        // Download image function
        function downloadImage(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.click();
        }

        // Show toast notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            toastMessage.textContent = message;
            toast.classList.remove('hidden');
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // Loading mode control functions
        function setLoadingMode(mode) {
            currentLoadingMode = mode;
            
            // Update button states
            document.querySelectorAll('[data-loading-mode]').forEach(btn => {
                btn.classList.remove('bg-blue-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            document.querySelector(`[data-loading-mode="${mode}"]`).classList.remove('bg-gray-200', 'text-gray-700');
            document.querySelector(`[data-loading-mode="${mode}"]`).classList.add('bg-blue-500', 'text-white');
            
            // Re-render images with new loading mode
            updateUI();
            
            // Initialize lazy loading if needed
            if (mode === 'lazy') {
                setTimeout(() => {
                    const lazyImages = document.querySelectorAll('.lazy-image');
                    lazyImages.forEach(img => {
                        lazyLoadObserver.observe(img);
                    });
                }, 100);
            }
            
            showToast(`Loading mode changed to: ${mode.charAt(0).toUpperCase() + mode.slice(1)}`);
        }

        function setGridSize(size) {
            currentGridSize = size;
            const imageGrid = document.getElementById('image-grid');
            
            // Update grid classes
            imageGrid.classList.remove('grid-cols-2', 'md:grid-cols-3', 'lg:grid-cols-4', 'xl:grid-cols-5', 'xl:grid-cols-6', 'xl:grid-cols-8');
            
            if (size === 'small') {
                imageGrid.classList.add('grid-cols-3', 'md:grid-cols-4', 'lg:grid-cols-6', 'xl:grid-cols-8');
            } else if (size === 'large') {
                imageGrid.classList.add('grid-cols-1', 'md:grid-cols-2', 'lg:grid-cols-3');
            } else {
                imageGrid.classList.add('grid-cols-2', 'md:grid-cols-3', 'lg:grid-cols-4', 'xl:grid-cols-5');
            }
            
            // Update button states
            document.querySelectorAll('[data-grid-size]').forEach(btn => {
                btn.classList.remove('bg-blue-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            document.querySelector(`[data-grid-size="${size}"]`).classList.remove('bg-gray-200', 'text-gray-700');
            document.querySelector(`[data-grid-size="${size}"]`).classList.add('bg-blue-500', 'text-white');
            
            showToast(`Grid size changed to: ${size.charAt(0).toUpperCase() + size.slice(1)}`);
        }

        function refreshGallery() {
            loadedImagesCache.clear();
            generateImageList();
            showToast('Gallery refreshed!');
        }

        // Debug function to test image loading
        function debugImageLoad() {
            console.log('Current loading mode:', currentLoadingMode);
            console.log('Total images:', allImages.length);
            console.log('Filtered images:', filteredImages.length);
            console.log('First image URL:', allImages[0]?.fullUrl);
            
            // Test loading first image
            if (allImages.length > 0) {
                const testImg = new Image();
                testImg.onload = () => console.log('✅ Test image loaded successfully');
                testImg.onerror = () => console.log('❌ Test image failed to load');
                testImg.src = allImages[0].fullUrl;
            }
        }

        // Event listeners
        document.getElementById('search-input').addEventListener('input', filterImages);
        document.getElementById('category-filter').addEventListener('change', filterImages);
        document.getElementById('type-filter').addEventListener('change', filterImages);
        
        // Add event listeners for loading mode and grid size controls
        document.querySelectorAll('[data-loading-mode]').forEach(btn => {
            btn.addEventListener('click', (e) => setLoadingMode(e.target.dataset.loadingMode));
        });
        
        document.querySelectorAll('[data-grid-size]').forEach(btn => {
            btn.addEventListener('click', (e) => setGridSize(e.target.dataset.gridSize));
        });
        
        document.getElementById('refresh-btn').addEventListener('click', refreshGallery);

        // Initialize the application
        generateImageList();
        
        // Debug info (can be removed in production)
        setTimeout(() => {
            debugImageLoad();
        }, 1000);
    </script>
</body>
</html>