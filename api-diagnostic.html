<!DOCTYPE html>
<html>
<head>
    <title>API Diagnostic - Villa Booking System</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 20px auto; padding: 20px; }
        .test-section { background: #f5f5f5; padding: 15px; margin: 15px 0; border-radius: 8px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .loading { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        pre { background: white; padding: 10px; border-radius: 4px; overflow-x: auto; }
        button { background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .url-list { list-style: none; padding: 0; }
        .url-list li { background: white; margin: 5px 0; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üîß API Diagnostic Tool</h1>
    <p>This tool tests various API endpoints to diagnose connectivity issues.</p>
    
    <div class="test-section">
        <h2>üåê Current Environment</h2>
        <ul class="url-list">
            <li><strong>Current URL:</strong> <span id="currentUrl"></span></li>
            <li><strong>Protocol:</strong> <span id="protocol"></span></li>
            <li><strong>Host:</strong> <span id="host"></span></li>
            <li><strong>Port:</strong> <span id="port"></span></li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üì° API Endpoint Tests</h2>
        <button onclick="testAllEndpoints()">üöÄ Test All Endpoints</button>
        <button onclick="clearResults()">üßπ Clear Results</button>
        
        <div id="testResults"></div>
    </div>

    <div class="test-section">
        <h2>üìä Test Specific Endpoints</h2>
        <button onclick="testEndpoint('villa.php')">Test Villa API</button>
        <button onclick="testEndpoint('rooms.php')">Test Rooms API</button>
        <button onclick="testEndpoint('packages.php')">Test Packages API</button>
        <button onclick="testEndpoint('bookings.php')">Test Bookings API</button>
    </div>

    <script>
        // Environment detection
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('protocol').textContent = window.location.protocol;
        document.getElementById('host').textContent = window.location.hostname;
        document.getElementById('port').textContent = window.location.port || 'default';

        // API test configurations
        const apiConfigs = [
            {
                name: 'Local XAMPP (current directory)',
                base: `${window.location.origin}/api/`,
                description: 'API in same directory as this file'
            },
            {
                name: 'Local XAMPP (parent directory)', 
                base: `${window.location.origin}/../api/`,
                description: 'API in parent directory'
            },
            {
                name: 'Local XAMPP (root)',
                base: 'http://localhost/fontend-bookingengine-100/frontend-booking-engine-1/api/',
                description: 'Full localhost XAMPP path'
            },
            {
                name: 'Production API',
                base: 'https://api.rumahdaisycantik.com/',
                description: 'Production server API'
            },
            {
                name: 'Vite Proxy',
                base: '/api/',
                description: 'Vite development proxy'
            }
        ];

        const endpoints = ['villa.php', 'rooms.php', 'packages.php', 'bookings.php'];

        async function testEndpoint(endpoint, baseUrl = null) {
            const resultsDiv = document.getElementById('testResults');
            
            if (baseUrl) {
                // Test specific base URL
                const url = baseUrl + endpoint;
                const resultId = `result-${baseUrl.replace(/[^a-zA-Z0-9]/g, '')}-${endpoint}`;
                
                const resultDiv = document.createElement('div');
                resultDiv.id = resultId;
                resultDiv.className = 'loading';
                resultDiv.innerHTML = `<h4>Testing: ${url}</h4><p>‚è≥ Loading...</p>`;
                resultsDiv.appendChild(resultDiv);

                try {
                    const startTime = Date.now();
                    const response = await fetch(url);
                    const endTime = Date.now();
                    const responseTime = endTime - startTime;
                    
                    if (response.ok) {
                        const data = await response.text();
                        resultDiv.className = 'success';
                        resultDiv.innerHTML = `
                            <h4>‚úÖ SUCCESS: ${url}</h4>
                            <p><strong>Status:</strong> ${response.status} ${response.statusText}</p>
                            <p><strong>Response Time:</strong> ${responseTime}ms</p>
                            <p><strong>Content Type:</strong> ${response.headers.get('content-type')}</p>
                            <details>
                                <summary>Response Data (${data.length} characters)</summary>
                                <pre>${data.substring(0, 1000)}${data.length > 1000 ? '...' : ''}</pre>
                            </details>
                        `;
                    } else {
                        resultDiv.className = 'error';
                        resultDiv.innerHTML = `
                            <h4>‚ùå FAILED: ${url}</h4>
                            <p><strong>Status:</strong> ${response.status} ${response.statusText}</p>
                            <p><strong>Response Time:</strong> ${responseTime}ms</p>
                        `;
                    }
                } catch (error) {
                    resultDiv.className = 'error';
                    resultDiv.innerHTML = `
                        <h4>‚ùå ERROR: ${url}</h4>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p>This usually indicates network connectivity issues or CORS problems.</p>
                    `;
                }
            } else {
                // Test all base URLs for this endpoint
                resultsDiv.innerHTML += `<h3>üîç Testing ${endpoint} across all configurations...</h3>`;
                
                for (const config of apiConfigs) {
                    await testEndpoint(endpoint, config.base);
                }
            }
        }

        async function testAllEndpoints() {
            clearResults();
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<h3>üöÄ Testing all API endpoints...</h3>';
            
            for (const endpoint of endpoints) {
                for (const config of apiConfigs) {
                    await testEndpoint(endpoint, config.base);
                }
                resultsDiv.innerHTML += '<hr>';
            }
            
            resultsDiv.innerHTML += '<h3>‚úÖ All tests completed!</h3>';
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
        }
    </script>
</body>
</html>