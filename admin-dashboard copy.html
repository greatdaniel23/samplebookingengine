<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Admin Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="config.js"></script>
    <style>
        :root {
            --hotel-gold: #B8860B;
            --hotel-cream: #FAF7F0;  
            --hotel-bronze: #8B4513;
            --hotel-navy: #2C3E50;
        }
        
        .btn-hotel-primary {
            background-color: var(--hotel-gold);
            color: white;
            border: 1px solid var(--hotel-gold);
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: all 0.2s;
        }
        
        .btn-hotel-primary:hover {
            background-color: #996D0A;
        }
        
        .btn-hotel-secondary {
            background-color: var(--hotel-cream);
            color: var(--hotel-navy);
            border: 1px solid var(--hotel-gold);
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: all 0.2s;
        }
        
        .text-hotel-navy { color: var(--hotel-navy); }
        .text-hotel-gold { color: var(--hotel-gold); }
        .text-hotel-bronze { color: var(--hotel-bronze); }
        .bg-hotel-cream { background-color: var(--hotel-cream); }
        .bg-hotel-gold { background-color: var(--hotel-gold); }
        .border-hotel-gold { border-color: var(--hotel-gold); }
    </style>
</head>
<body>
    <div id="admin-root"></div>

    <script>
        // Debug configuration loading
        console.log('üîß Admin Dashboard Configuration Check:');
        console.log('CONFIG exists:', typeof CONFIG !== 'undefined');
        console.log('getApiUrl exists:', typeof getApiUrl === 'function');
        console.log('getApiBaseUrl exists:', typeof getApiBaseUrl === 'function');
        
        if (typeof getApiUrl === 'function') {
            console.log('‚úÖ Villa API URL will be:', getApiUrl('villa.php'));
        } else {
            console.error('‚ùå getApiUrl function missing - config.js not loaded properly');
        }
        
        if (typeof CONFIG !== 'undefined') {
            console.log('Environment:', CONFIG.API.ENVIRONMENT);
            console.log('Production Base URL:', CONFIG.API.PRODUCTION_BASE_URL);
        }
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Initialize configuration and log current settings
        if (typeof logConfig === 'function') {
            logConfig();
        }
        
        // API configuration now handled by config.js functions

        // Simple auth check
        function useAuth() {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const adminLoggedIn = sessionStorage.getItem('adminLoggedIn');
                if (adminLoggedIn === 'true') {
                    setIsAuthenticated(true);
                }
                setLoading(false);
            }, []);

            const logout = () => {
                sessionStorage.removeItem('adminLoggedIn');
                sessionStorage.removeItem('adminUser');
                window.location.href = 'admin-login.html';
            };

            return { isAuthenticated, loading, logout };
        }

        // Admin Dashboard Component
        function AdminDashboard() {
            const { isAuthenticated, loading, logout } = useAuth();
            const [activeSection, setActiveSection] = useState('overview');

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-600 mx-auto"></div>
                            <p className="mt-4 text-gray-600">Loading admin dashboard...</p>
                        </div>
                    </div>
                );
            }

            if (!isAuthenticated) {
                window.location.href = 'admin-login.html';
                return null;
            }

            return (
                <div className="min-h-screen bg-gray-50 flex">
                    {/* Left Sidebar */}
                    <div className="w-64 bg-white shadow-lg flex flex-col">
                        {/* Sidebar Header */}
                        <div className="p-6 border-b border-gray-200">
                            <div className="flex items-center">
                                <div className="w-10 h-10 bg-yellow-600 rounded-lg flex items-center justify-center mr-3">
                                    <svg className="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h1 className="text-lg font-bold text-gray-900">Villa Admin</h1>
                                    <p className="text-xs text-gray-500">Dashboard</p>
                                </div>
                            </div>
                        </div>

                        {/* Navigation Menu */}
                        <nav className="flex-1 p-4">
                            <div className="space-y-2">
                                {[
                                    { id: 'overview', name: 'Overview', icon: 'üìä', description: 'Dashboard summary' },
                                    { id: 'bookings', name: 'Bookings', icon: 'üìÖ', description: 'Manage reservations' },
                                    { id: 'rooms', name: 'Rooms', icon: 'üè®', description: 'Room management' },
                                    { id: 'packages', name: 'Packages', icon: 'üì¶', description: 'Special offers' },
                                    { id: 'property', name: 'Property Mgmt', icon: 'üè°', description: 'Property & business' },
                                    { id: 'analytics', name: 'Analytics', icon: 'üìà', description: 'Reports & trends' },
                                    { id: 'settings', name: 'Settings', icon: '‚öôÔ∏è', description: 'System config' }
                                ].map((item) => (
                                    <button
                                        key={item.id}
                                        onClick={() => setActiveSection(item.id)}
                                        className={`w-full flex items-center px-4 py-3 text-left rounded-lg transition-all duration-200 group ${
                                            activeSection === item.id
                                                ? 'bg-yellow-50 text-yellow-800 border-l-4 border-yellow-500 shadow-sm'
                                                : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'
                                        }`}
                                    >
                                        <span className="text-xl mr-3">{item.icon}</span>
                                        <div className="flex-1">
                                            <div className="font-medium">{item.name}</div>
                                            <div className="text-xs text-gray-500 group-hover:text-gray-600">
                                                {item.description}
                                            </div>
                                        </div>
                                    </button>
                                ))}
                            </div>
                        </nav>

                        {/* User Info & Actions */}
                        <div className="p-4 border-t border-gray-200 space-y-3">
                            <div className="flex items-center text-sm text-gray-600 px-2">
                                <svg className="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                                <span className="truncate">Welcome, {sessionStorage.getItem('adminUser')}</span>
                            </div>
                            
                            <button 
                                onClick={() => window.open('image-gallery.html', '_blank')}
                                className="w-full flex items-center px-3 py-2 text-sm bg-blue-50 text-blue-700 rounded-md hover:bg-blue-100 transition-colors"
                            >
                                <svg className="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                Image Gallery
                            </button>
                            
                            <button 
                                onClick={logout}
                                className="w-full flex items-center px-3 py-2 text-sm text-red-600 hover:text-red-700 hover:bg-red-50 rounded-md transition-colors"
                            >
                                <svg className="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                </svg>
                                Logout
                            </button>
                        </div>
                    </div>

                    {/* Main Content Area */}
                    <div className="flex-1 flex flex-col">
                        {/* Top Header */}
                        <header className="bg-white shadow-sm border-b border-gray-200 px-6 py-4">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h2 className="text-2xl font-bold text-gray-900 capitalize">
                                        {activeSection === 'property' ? 'Property Management' :
                                         activeSection === 'analytics' ? 'Analytics & Insights' :
                                         activeSection}
                                    </h2>
                                    <p className="text-sm text-gray-500 mt-1">
                                        {activeSection === 'overview' && 'System overview and quick stats'}
                                        {activeSection === 'bookings' && 'Manage bookings and reservations'}
                                        {activeSection === 'rooms' && 'Configure rooms and availability'}
                                        {activeSection === 'packages' && 'Manage packages and special offers'}
                                        {activeSection === 'property' && 'Manage villa info, business details & reviews'}
                                        {activeSection === 'analytics' && 'View performance metrics and trends'}
                                        {activeSection === 'settings' && 'System configuration and preferences'}
                                    </p>
                                </div>
                                <div className="flex items-center space-x-3">
                                    <div className="text-sm text-gray-500">
                                        {new Date().toLocaleDateString('en-US', { 
                                            weekday: 'long', 
                                            year: 'numeric', 
                                            month: 'long', 
                                            day: 'numeric' 
                                        })}
                                    </div>
                                </div>
                            </div>
                        </header>

                        {/* Content Area */}
                        <main className="flex-1 overflow-auto">
                            <div className="p-6">
                                <div className="bg-white rounded-lg shadow-sm border border-gray-200 min-h-full">
                                    {activeSection === 'overview' && <OverviewSection />}
                                    {activeSection === 'bookings' && <BookingsSection />}
                                    {activeSection === 'rooms' && <RoomsSection />}
                                    {activeSection === 'packages' && <PackagesSection />}
                                    {activeSection === 'property' && <PropertyManagementSection />}
                                    {activeSection === 'analytics' && <AnalyticsSection />}
                                    {activeSection === 'settings' && <SettingsSection />}
                                </div>
                            </div>
                        </main>
                    </div>
                </div>
            );
        }

        // Overview Section
        function OverviewSection() {
            return (
                <div className="p-6">
                    <h2 className="text-2xl font-bold text-gray-900 mb-6">Dashboard Overview</h2>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div className="bg-blue-50 p-6 rounded-lg">
                            <div className="flex items-center">
                                <div className="p-2 bg-blue-100 rounded-lg">
                                    <svg className="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                </div>
                                <div className="ml-4">
                                    <p className="text-sm font-medium text-blue-600">Total Bookings</p>
                                    <p className="text-2xl font-bold text-blue-900">23</p>
                                </div>
                            </div>
                        </div>

                        <div className="bg-green-50 p-6 rounded-lg">
                            <div className="flex items-center">
                                <div className="p-2 bg-green-100 rounded-lg">
                                    <svg className="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                    </svg>
                                </div>
                                <div className="ml-4">
                                    <p className="text-sm font-medium text-green-600">Available Rooms</p>
                                    <p className="text-2xl font-bold text-green-900">5</p>
                                </div>
                            </div>
                        </div>

                        <div className="bg-yellow-50 p-6 rounded-lg">
                            <div className="flex items-center">
                                <div className="p-2 bg-yellow-100 rounded-lg">
                                    <svg className="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                                    </svg>
                                </div>
                                <div className="ml-4">
                                    <p className="text-sm font-medium text-yellow-600">Active Packages</p>
                                    <p className="text-2xl font-bold text-yellow-900">6</p>
                                </div>
                            </div>
                        </div>

                        <div className="bg-purple-50 p-6 rounded-lg">
                            <div className="flex items-center">
                                <div className="p-2 bg-purple-100 rounded-lg">
                                    <svg className="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                    </svg>
                                </div>
                                <div className="ml-4">
                                    <p className="text-sm font-medium text-purple-600">Revenue</p>
                                    <p className="text-2xl font-bold text-purple-900">$12,450</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="bg-gray-50 p-6 rounded-lg">
                        <h3 className="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <button className="p-4 bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow text-left" onClick={() => setActiveSection('property')}>
                                <h4 className="font-medium text-gray-900">Property Management</h4>
                                <p className="text-sm text-gray-600 mt-1">Edit property, business info & amenities</p>
                            </button>
                            <a href="admin-reports.html" className="p-4 bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow text-left block">
                                <h4 className="font-medium text-gray-900">View Reports</h4>
                                <p className="text-sm text-gray-600 mt-1">Access detailed booking and revenue reports</p>
                            </a>
                            <button className="p-4 bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow text-left" onClick={() => setActiveSection('bookings')}>
                                <h4 className="font-medium text-gray-900">Manage Bookings</h4>
                                <p className="text-sm text-gray-600 mt-1">View and edit current bookings</p>
                            </button>
                            <button className="p-4 bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow text-left" onClick={() => setActiveSection('analytics')}>
                                <h4 className="font-medium text-gray-900">Analytics</h4>
                                <p className="text-sm text-gray-600 mt-1">View performance metrics</p>
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Bookings Management Section
        function BookingsSection() {
            const [bookings, setBookings] = useState([]);
            const [rooms, setRooms] = useState([]);
            const [packages, setPackages] = useState([]);
            const [loading, setLoading] = useState(true);
            const [editingBooking, setEditingBooking] = useState(null);
            const [showAddForm, setShowAddForm] = useState(false);
            const [showCalendarSync, setShowCalendarSync] = useState(false);
            const [calendarUrls, setCalendarUrls] = useState(null);
            const [filterStatus, setFilterStatus] = useState('all');
            const [formData, setFormData] = useState({
                room_id: '',
                first_name: '',
                last_name: '',
                email: '',
                phone: '',
                check_in: '',
                check_out: '',
                guests: '',
                total_price: '',
                special_requests: '',
                status: 'confirmed'
            });

            const bookingStatuses = ['pending', 'confirmed', 'cancelled', 'checked_in', 'checked_out'];

            useEffect(() => {
                loadBookings();
                loadRooms();
                loadPackages();
            }, []);

            const loadBookings = async () => {
                try {
                    setLoading(true);
                    const response = await fetch(getApiUrl('bookings.php'));
                    const data = await response.json();
                    console.log('Bookings API Response:', data);
                    if (data.success) {
                        setBookings(data.data);
                        console.log('Bookings loaded:', data.data.length);
                    } else {
                        console.error('Error loading bookings:', data.error);
                        alert('Error loading bookings: ' + data.error);
                    }
                } catch (error) {
                    console.error('Error loading bookings:', error);
                    alert('Error loading bookings. Please check if XAMPP is running. Error: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            const loadRooms = async () => {
                try {
                    const response = await fetch(getApiUrl('rooms.php'));
                    const data = await response.json();
                    if (data.success) {
                        setRooms(data.data.filter(room => room.available));
                    }
                } catch (error) {
                    console.error('Error loading rooms:', error);
                }
            };

            const loadPackages = async () => {
                try {
                    const response = await fetch(getApiUrl('packages.php'));
                    const data = await response.json();
                    if (data.success) {
                        // Admin needs to see ALL packages including inactive ones for management
                        setPackages(data.data);
                    }
                } catch (error) {
                    console.error('Error loading packages:', error);
                }
            };

            const resetForm = () => {
                setFormData({
                    room_id: '',
                    first_name: '',
                    last_name: '',
                    email: '',
                    phone: '',
                    check_in: '',
                    check_out: '',
                    guests: '',
                    total_price: '',
                    special_requests: '',
                    status: 'confirmed'
                });
                setEditingBooking(null);
                setShowAddForm(false);
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                try {
                    const url = editingBooking ? getApiUrl(`bookings.php?id=${editingBooking.id}`) : getApiUrl('bookings.php');
                    const method = editingBooking ? 'PUT' : 'POST';
                    
                    const response = await fetch(url, {
                        method: method,
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData)
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        alert(editingBooking ? 'Booking updated successfully!' : 'Booking created successfully!');
                        resetForm();
                        loadBookings();
                    } else {
                        alert('Error: ' + data.error);
                    }
                } catch (error) {
                    console.error('Error saving booking:', error);
                    alert('Error saving booking: ' + error.message);
                }
            };

            const deleteBooking = async (id) => {
                if (confirm('Are you sure you want to delete this booking?')) {
                    try {
                        const response = await fetch(getApiUrl(`bookings.php?id=${id}`), {
                            method: 'DELETE'
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            alert('Booking deleted successfully!');
                            loadBookings();
                        } else {
                            alert('Error deleting booking: ' + data.error);
                        }
                    } catch (error) {
                        console.error('Error deleting booking:', error);
                        alert('Error deleting booking: ' + error.message);
                    }
                }
            };

            const editBooking = (booking) => {
                setFormData({
                    room_id: booking.room_id,
                    first_name: booking.first_name,
                    last_name: booking.last_name,
                    email: booking.email,
                    phone: booking.phone,
                    check_in: booking.check_in.split(' ')[0], // Get just the date part
                    check_out: booking.check_out.split(' ')[0], // Get just the date part
                    guests: booking.guests,
                    total_price: booking.total_price,
                    special_requests: booking.special_requests || '',
                    status: booking.status
                });
                setEditingBooking(booking);
                setShowAddForm(true);
            };

            const updateBookingStatus = async (id, newStatus) => {
                try {
                    const booking = bookings.find(b => b.id === id);
                    const updatedData = { ...booking, status: newStatus };
                    delete updatedData.room_name; // Remove joined field
                    
                    const response = await fetch(getApiUrl(`bookings.php?id=${id}`), {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(updatedData)
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        alert('Booking status updated successfully!');
                        loadBookings();
                    } else {
                        alert('Error updating status: ' + data.error);
                    }
                } catch (error) {
                    console.error('Error updating status:', error);
                    alert('Error updating status: ' + error.message);
                }
            };

            // iCal Export Functions
            const exportToiCal = async () => {
                try {
                    const params = new URLSearchParams({
                        action: 'calendar',
                        format: 'ics',
                        status: filterStatus
                    });
                    
                    const url = getApiUrl(`ical.php?${params}`);
                    
                    // Create download link
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = 'villa-bookings.ics';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    alert('Calendar exported successfully! You can now import this file into Google Calendar, Outlook, or Apple Calendar.');
                } catch (error) {
                    console.error('Error exporting calendar:', error);
                    alert('Error exporting calendar: ' + error.message);
                }
            };

            const loadCalendarUrls = async () => {
                try {
                    const response = await fetch(getApiUrl('ical.php?action=subscribe'));
                    const data = await response.json();
                    
                    if (data.success) {
                        setCalendarUrls(data);
                    } else {
                        alert('Error loading calendar URLs: ' + data.error);
                    }
                } catch (error) {
                    console.error('Error loading calendar URLs:', error);
                    alert('Error loading calendar URLs: ' + error.message);
                }
            };

            const copyToClipboard = (text) => {
                navigator.clipboard.writeText(text).then(() => {
                    alert('URL copied to clipboard!');
                }).catch(() => {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert('URL copied to clipboard!');
                });
            };

            const filteredBookings = filterStatus === 'all' 
                ? bookings 
                : bookings.filter(booking => booking.status === filterStatus);

            return (
                <div className="p-6">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold text-gray-900">Bookings Management</h2>
                        <div className="flex gap-2">
                            <button 
                                onClick={() => setShowAddForm(true)}
                                className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
                            >
                                Add Booking
                            </button>
                            <button 
                                onClick={exportToiCal}
                                className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2"
                            >
                                üìÖ Export Calendar
                            </button>
                            <button 
                                onClick={() => setShowCalendarSync(true)}
                                className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2"
                            >
                                üîó Calendar Sync
                            </button>
                            <a 
                                href="admin-reports.html" 
                                className="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors"
                            >
                                View Reports
                            </a>
                        </div>
                    </div>

                    {/* Filter Dropdown */}
                    <div className="mb-4">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                            Filter by Status:
                        </label>
                        <select 
                            value={filterStatus}
                            onChange={(e) => setFilterStatus(e.target.value)}
                            className="border border-gray-300 rounded-lg px-3 py-2 bg-white"
                        >
                            <option value="all">All Bookings</option>
                            {bookingStatuses.map(status => (
                                <option key={status} value={status}>
                                    {status.charAt(0).toUpperCase() + status.slice(1).replace('_', ' ')}
                                </option>
                            ))}
                        </select>
                    </div>

                    {loading ? (
                        <div className="text-center py-8">Loading bookings...</div>
                    ) : (
                        <div className="overflow-x-auto">
                            <table className="min-w-full bg-white border border-gray-200">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Guest</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Room</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Dates</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Total</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-200">
                                    {filteredBookings.map((booking) => (
                                        <tr key={booking.id} className="hover:bg-gray-50">
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                <div>
                                                    <div className="font-medium">{booking.first_name} {booking.last_name}</div>
                                                    <div className="text-gray-500">{booking.email}</div>
                                                    <div className="text-gray-500">{booking.phone}</div>
                                                </div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                <div>
                                                    <div className="font-medium">{booking.room_name || `Room ${booking.room_id}`}</div>
                                                    <div className="text-gray-500">{booking.guests} guest{booking.guests > 1 ? 's' : ''}</div>
                                                </div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                <div>
                                                    <div>Check-in: {booking.check_in.split(' ')[0]}</div>
                                                    <div>Check-out: {booking.check_out.split(' ')[0]}</div>
                                                </div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <select 
                                                    value={booking.status}
                                                    onChange={(e) => updateBookingStatus(booking.id, e.target.value)}
                                                    className={`px-2 py-1 text-xs rounded-full border-0 focus:ring-2 ${
                                                        booking.status === 'confirmed' ? 'bg-green-100 text-green-800' :
                                                        booking.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                                                        booking.status === 'checked_in' ? 'bg-blue-100 text-blue-800' :
                                                        booking.status === 'checked_out' ? 'bg-purple-100 text-purple-800' :
                                                        'bg-red-100 text-red-800'
                                                    }`}
                                                >
                                                    {bookingStatuses.map(status => (
                                                        <option key={status} value={status}>
                                                            {status.charAt(0).toUpperCase() + status.slice(1).replace('_', ' ')}
                                                        </option>
                                                    ))}
                                                </select>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                <div className="font-medium">${booking.total_price}</div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <button 
                                                    onClick={() => editBooking(booking)}
                                                    className="text-blue-600 hover:text-blue-900 mr-3"
                                                >
                                                    Edit
                                                </button>
                                                <button 
                                                    onClick={() => deleteBooking(booking.id)}
                                                    className="text-red-600 hover:text-red-900"
                                                >
                                                    Delete
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}

                    {/* Booking Form Modal */}
                    {showAddForm && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-lg p-6 w-full max-w-2xl max-h-screen overflow-y-auto">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-medium">
                                        {editingBooking ? 'Edit Booking' : 'Add New Booking'}
                                    </h3>
                                    <button 
                                        onClick={resetForm}
                                        className="text-gray-400 hover:text-gray-600"
                                    >
                                        ‚úï
                                    </button>
                                </div>

                                <form onSubmit={handleSubmit} className="space-y-4">
                                    <div className="grid gap-4 md:grid-cols-2">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Room *
                                            </label>
                                            <select 
                                                value={formData.room_id}
                                                onChange={(e) => setFormData({...formData, room_id: e.target.value})}
                                                className="w-full border border-gray-300 rounded-lg px-3 py-2"
                                                required
                                            >
                                                <option value="">Select Room</option>
                                                {rooms.map(room => (
                                                    <option key={room.id} value={room.id}>
                                                        {room.name} - ${room.price}/night (Max {room.capacity} guests)
                                                    </option>
                                                ))}
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Number of Guests *
                                            </label>
                                            <input 
                                                type="number"
                                                value={formData.guests}
                                                onChange={(e) => setFormData({...formData, guests: e.target.value})}
                                                className="w-full border border-gray-300 rounded-lg px-3 py-2"
                                                min="1"
                                                required
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                First Name *
                                            </label>
                                            <input 
                                                type="text"
                                                value={formData.first_name}
                                                onChange={(e) => setFormData({...formData, first_name: e.target.value})}
                                                className="w-full border border-gray-300 rounded-lg px-3 py-2"
                                                required
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Last Name *
                                            </label>
                                            <input 
                                                type="text"
                                                value={formData.last_name}
                                                onChange={(e) => setFormData({...formData, last_name: e.target.value})}
                                                className="w-full border border-gray-300 rounded-lg px-3 py-2"
                                                required
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Email *
                                            </label>
                                            <input 
                                                type="email"
                                                value={formData.email}
                                                onChange={(e) => setFormData({...formData, email: e.target.value})}
                                                className="w-full border border-gray-300 rounded-lg px-3 py-2"
                                                required
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Phone *
                                            </label>
                                            <input 
                                                type="tel"
                                                value={formData.phone}
                                                onChange={(e) => setFormData({...formData, phone: e.target.value})}
                                                className="w-full border border-gray-300 rounded-lg px-3 py-2"
                                                required
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Check-in Date *
                                            </label>
                                            <input 
                                                type="date"
                                                value={formData.check_in}
                                                onChange={(e) => setFormData({...formData, check_in: e.target.value})}
                                                className="w-full border border-gray-300 rounded-lg px-3 py-2"
                                                required
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Check-out Date *
                                            </label>
                                            <input 
                                                type="date"
                                                value={formData.check_out}
                                                onChange={(e) => setFormData({...formData, check_out: e.target.value})}
                                                className="w-full border border-gray-300 rounded-lg px-3 py-2"
                                                required
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Total Price *
                                            </label>
                                            <input 
                                                type="number"
                                                step="0.01"
                                                value={formData.total_price}
                                                onChange={(e) => setFormData({...formData, total_price: e.target.value})}
                                                className="w-full border border-gray-300 rounded-lg px-3 py-2"
                                                required
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Status *
                                            </label>
                                            <select 
                                                value={formData.status}
                                                onChange={(e) => setFormData({...formData, status: e.target.value})}
                                                className="w-full border border-gray-300 rounded-lg px-3 py-2"
                                                required
                                            >
                                                {bookingStatuses.map(status => (
                                                    <option key={status} value={status}>
                                                        {status.charAt(0).toUpperCase() + status.slice(1).replace('_', ' ')}
                                                    </option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                            Special Requests
                                        </label>
                                        <textarea 
                                            value={formData.special_requests}
                                            onChange={(e) => setFormData({...formData, special_requests: e.target.value})}
                                            className="w-full border border-gray-300 rounded-lg px-3 py-2"
                                            rows="3"
                                            placeholder="Any special requests or notes..."
                                        />
                                    </div>

                                    <div className="flex justify-end space-x-3 pt-4">
                                        <button 
                                            type="button"
                                            onClick={resetForm}
                                            className="px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors"
                                        >
                                            Cancel
                                        </button>
                                        <button 
                                            type="submit"
                                            className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                        >
                                            {editingBooking ? 'Update Booking' : 'Create Booking'}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* Calendar Sync Modal */}
                    {showCalendarSync && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[80vh] overflow-y-auto">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-semibold">üìÖ Calendar Sync & Integration</h3>
                                    <button 
                                        onClick={() => setShowCalendarSync(false)}
                                        className="text-gray-500 hover:text-gray-700 text-2xl"
                                    >
                                        √ó
                                    </button>
                                </div>

                                <div className="space-y-6">
                                    {/* Export Options */}
                                    <div className="border rounded-lg p-4">
                                        <h4 className="font-semibold mb-3 flex items-center gap-2">
                                            üì§ Export Calendar
                                        </h4>
                                        <p className="text-sm text-gray-600 mb-3">
                                            Download your bookings as an .ics file to import into any calendar application.
                                        </p>
                                        <div className="flex gap-2">
                                            <button 
                                                onClick={exportToiCal}
                                                className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors"
                                            >
                                                üìÖ Download .ics File
                                            </button>
                                        </div>
                                    </div>

                                    {/* Subscription URLs */}
                                    <div className="border rounded-lg p-4">
                                        <h4 className="font-semibold mb-3 flex items-center gap-2">
                                            üîó Calendar Subscription
                                        </h4>
                                        <p className="text-sm text-gray-600 mb-3">
                                            Use these URLs to keep your calendar apps synchronized with live booking data.
                                        </p>
                                        
                                        <button 
                                            onClick={() => {
                                                loadCalendarUrls();
                                            }}
                                            className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors mb-4"
                                        >
                                            üîÑ Generate Sync URLs
                                        </button>

                                        {calendarUrls && (
                                            <div className="space-y-4">
                                                <div className="bg-gray-50 p-3 rounded">
                                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                                        üì± Standard Calendar URL:
                                                    </label>
                                                    <div className="flex gap-2">
                                                        <input 
                                                            type="text" 
                                                            value={calendarUrls.subscribe_url} 
                                                            readOnly 
                                                            className="flex-1 text-xs bg-white border rounded px-2 py-1 text-gray-600"
                                                        />
                                                        <button 
                                                            onClick={() => copyToClipboard(calendarUrls.subscribe_url)}
                                                            className="bg-gray-600 text-white px-3 py-1 text-xs rounded hover:bg-gray-700"
                                                        >
                                                            Copy
                                                        </button>
                                                    </div>
                                                </div>

                                                <div className="bg-gray-50 p-3 rounded">
                                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                                        üçé Apple Calendar / Webcal URL:
                                                    </label>
                                                    <div className="flex gap-2">
                                                        <input 
                                                            type="text" 
                                                            value={calendarUrls.webcal_url} 
                                                            readOnly 
                                                            className="flex-1 text-xs bg-white border rounded px-2 py-1 text-gray-600"
                                                        />
                                                        <button 
                                                            onClick={() => copyToClipboard(calendarUrls.webcal_url)}
                                                            className="bg-gray-600 text-white px-3 py-1 text-xs rounded hover:bg-gray-700"
                                                        >
                                                            Copy
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>

                                    {/* Platform Instructions */}
                                    <div className="border rounded-lg p-4">
                                        <h4 className="font-semibold mb-3 flex items-center gap-2">
                                            üìö Integration Instructions
                                        </h4>
                                        
                                        <div className="space-y-4 text-sm">
                                            <div className="border-l-4 border-blue-500 pl-3">
                                                <h5 className="font-medium">üóìÔ∏è Google Calendar</h5>
                                                <p className="text-gray-600">
                                                    1. Open Google Calendar<br/>
                                                    2. Click "+" next to "Other calendars"<br/>
                                                    3. Select "From URL"<br/>
                                                    4. Paste the Standard Calendar URL<br/>
                                                    5. Click "Add calendar"
                                                </p>
                                            </div>

                                            <div className="border-l-4 border-orange-500 pl-3">
                                                <h5 className="font-medium">üìß Outlook</h5>
                                                <p className="text-gray-600">
                                                    1. Open Outlook Calendar<br/>
                                                    2. Click "Add calendar" ‚Üí "Subscribe from web"<br/>
                                                    3. Paste the Standard Calendar URL<br/>
                                                    4. Name your calendar and click "Import"
                                                </p>
                                            </div>

                                            <div className="border-l-4 border-gray-500 pl-3">
                                                <h5 className="font-medium">üçé Apple Calendar</h5>
                                                <p className="text-gray-600">
                                                    1. Open Calendar app<br/>
                                                    2. File ‚Üí New Calendar Subscription<br/>
                                                    3. Paste the Webcal URL<br/>
                                                    4. Configure settings and click "OK"
                                                </p>
                                            </div>

                                            <div className="border-l-4 border-red-500 pl-3">
                                                <h5 className="font-medium">üè† Airbnb / Booking Platforms</h5>
                                                <p className="text-gray-600">
                                                    1. Go to your listing's calendar settings<br/>
                                                    2. Find "Import calendar" or "Sync calendar"<br/>
                                                    3. Paste the Standard Calendar URL<br/>
                                                    4. Set sync frequency (hourly recommended)
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="flex justify-end mt-6">
                                    <button 
                                        onClick={() => setShowCalendarSync(false)}
                                        className="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"
                                    >
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Rooms Management Section
        function RoomsSection() {
            const [rooms, setRooms] = useState([]);
            const [packages, setPackages] = useState([]);
            const [loading, setLoading] = useState(true);
            const [editingRoom, setEditingRoom] = useState(null);
            const [showAddForm, setShowAddForm] = useState(false);
            const [formData, setFormData] = useState({
                name: '',
                type: 'Standard',
                price: '',
                capacity: '',
                description: '',
                size: '',
                beds: '',
                features: [],
                amenities: [],
                images: [],
                available: true
            });

            const roomTypes = ['Standard', 'Deluxe', 'Suite', 'Family', 'Budget', 'Luxury', 'Business'];

            useEffect(() => {
                loadRooms();
                loadPackages();
            }, []);

            const loadRooms = async () => {
                try {
                    setLoading(true);
                    const response = await fetch(getApiUrl('rooms.php'));
                    const data = await response.json();
                    console.log('Rooms API Response:', data);
                    if (data.success) {
                        setRooms(data.data);
                        console.log('Rooms loaded:', data.data.length);
                    } else {
                        console.error('Error loading rooms:', data.error);
                        alert('Error loading rooms: ' + data.error);
                    }
                } catch (error) {
                    console.error('Error loading rooms:', error);
                    alert('Error loading rooms. Please check if XAMPP is running. Error: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            const loadPackages = async () => {
                try {
                    const response = await fetch(getApiUrl('packages.php'));
                    const data = await response.json();
                    if (data.success) {
                        setPackages(data.data);
                    }
                } catch (error) {
                    console.error('Error loading packages:', error);
                }
            };

            const handleInputChange = (field, value) => {
                setFormData(prev => ({
                    ...prev,
                    [field]: value
                }));
            };

            const handleArrayChange = (field, value) => {
                const items = value.split(',').map(item => item.trim()).filter(item => item);
                setFormData(prev => ({
                    ...prev,
                    [field]: items
                }));
            };

            const resetForm = () => {
                setFormData({
                    name: '',
                    type: 'Standard',
                    price: '',
                    capacity: '',
                    description: '',
                    size: '',
                    beds: '',
                    features: [],
                    amenities: [],
                    images: [],
                    available: true
                });
                setEditingRoom(null);
                setShowAddForm(false);
            };

            const handleEdit = (room) => {
                setFormData({
                    name: room.name,
                    type: room.type,
                    price: room.price.toString(),
                    capacity: room.capacity.toString(),
                    description: room.description || '',
                    size: room.size || '',
                    beds: room.beds || '',
                    features: room.features || [],
                    amenities: room.amenities || [],
                    images: room.images || [],
                    available: room.available
                });
                setEditingRoom(room.id);
                setShowAddForm(true);
            };

            const handleSave = async () => {
                if (!formData.name || !formData.price) {
                    alert('Please fill in required fields (Name and Price)');
                    return;
                }

                const roomData = {
                    ...formData,
                    price: parseFloat(formData.price),
                    capacity: parseInt(formData.capacity) || 2
                };

                try {
                    if (editingRoom) {
                        // Update existing room
                        const response = await fetch(getApiUrl('rooms.php'), {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ ...roomData, id: editingRoom })
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            alert('Room updated successfully!');
                            loadRooms();
                        } else {
                            alert('Error updating room: ' + result.error);
                            return;
                        }
                    } else {
                        // Add new room
                        const response = await fetch(getApiUrl('rooms.php'), {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(roomData)
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            alert('Room added successfully!');
                            loadRooms();
                        } else {
                            alert('Error adding room: ' + result.error);
                            return;
                        }
                    }

                    resetForm();
                } catch (error) {
                    console.error('Error saving room:', error);
                    alert('Error saving room. Please check if XAMPP is running.');
                }
            };

            const handleDelete = async (id) => {
                if (confirm('Are you sure you want to delete this room?')) {
                    try {
                        const response = await fetch(getApiUrl('rooms.php'), {
                            method: 'DELETE',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ id: id })
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            alert('Room deleted successfully!');
                            loadRooms();
                        } else {
                            alert('Error deleting room: ' + result.error);
                        }
                    } catch (error) {
                        console.error('Error deleting room:', error);
                        alert('Error deleting room. Please check if XAMPP is running.');
                    }
                }
            };

            const toggleAvailability = async (id) => {
                try {
                    const room = rooms.find(r => r.id === id);
                    if (!room) return;

                    const response = await fetch(getApiUrl('rooms.php'), {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ 
                            ...room, 
                            available: room.available ? 0 : 1 
                        })
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        loadRooms();
                    } else {
                        alert('Error updating room availability: ' + result.error);
                    }
                } catch (error) {
                    console.error('Error updating room availability:', error);
                    alert('Error updating room availability. Please check if XAMPP is running.');
                }
            };

            const getCompatiblePackages = (room) => {
                return packages.filter(pkg => 
                    (pkg.available || pkg.is_active) && 
                    pkg.max_guests <= room.capacity
                );
            };

            return (
                <div className="p-6">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold text-gray-900">Rooms Management</h2>
                        <div className="flex gap-2">
                            <button 
                                onClick={loadRooms}
                                className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors"
                            >
                                Refresh
                            </button>
                            <button 
                                onClick={() => setShowAddForm(true)}
                                className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
                            >
                                Add Room
                            </button>
                        </div>
                    </div>

                    {/* Add/Edit Form Modal */}
                    {showAddForm && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-lg p-6 w-full max-w-4xl max-h-screen overflow-y-auto">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-semibold">
                                        {editingRoom ? 'Edit Room' : 'Add New Room'}
                                    </h3>
                                    <button 
                                        onClick={resetForm}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        ‚úï
                                    </button>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Room Name*</label>
                                        <input
                                            type="text"
                                            value={formData.name}
                                            onChange={(e) => handleInputChange('name', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="Enter room name"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Room Type</label>
                                        <select
                                            value={formData.type}
                                            onChange={(e) => handleInputChange('type', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        >
                                            {roomTypes.map(type => (
                                                <option key={type} value={type}>{type}</option>
                                            ))}
                                        </select>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Price per Night ($)*</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            value={formData.price}
                                            onChange={(e) => handleInputChange('price', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="0.00"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Capacity (Guests)</label>
                                        <input
                                            type="number"
                                            min="1"
                                            value={formData.capacity}
                                            onChange={(e) => handleInputChange('capacity', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="2"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Room Size</label>
                                        <input
                                            type="text"
                                            value={formData.size}
                                            onChange={(e) => handleInputChange('size', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="e.g., 25 sqm"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Bed Configuration</label>
                                        <input
                                            type="text"
                                            value={formData.beds}
                                            onChange={(e) => handleInputChange('beds', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="e.g., 1 King Bed"
                                        />
                                    </div>

                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                        <textarea
                                            value={formData.description}
                                            onChange={(e) => handleInputChange('description', e.target.value)}
                                            rows="3"
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="Enter room description"
                                        />
                                    </div>

                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Features (comma-separated)</label>
                                        <input
                                            type="text"
                                            value={formData.features.join(', ')}
                                            onChange={(e) => handleArrayChange('features', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="e.g., City View, Balcony, Work Desk"
                                        />
                                    </div>

                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Amenities (comma-separated)</label>
                                        <input
                                            type="text"
                                            value={formData.amenities.join(', ')}
                                            onChange={(e) => handleArrayChange('amenities', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="e.g., WiFi, Air Conditioning, Minibar"
                                        />
                                    </div>

                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Image URLs (comma-separated)</label>
                                        <input
                                            type="text"
                                            value={formData.images.join(', ')}
                                            onChange={(e) => handleArrayChange('images', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="https://example.com/image1.jpg, https://example.com/image2.jpg"
                                        />
                                    </div>

                                    <div className="md:col-span-2">
                                        <label className="flex items-center">
                                            <input
                                                type="checkbox"
                                                checked={formData.available}
                                                onChange={(e) => handleInputChange('available', e.target.checked)}
                                                className="mr-2"
                                            />
                                            <span className="text-sm font-medium text-gray-700">Room Available</span>
                                        </label>
                                    </div>
                                </div>

                                <div className="flex gap-2 mt-6">
                                    <button
                                        onClick={handleSave}
                                        className="flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors"
                                    >
                                        {editingRoom ? 'Update Room' : 'Add Room'}
                                    </button>
                                    <button
                                        onClick={resetForm}
                                        className="flex-1 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {loading ? (
                        <div className="text-center py-8">Loading rooms...</div>
                    ) : (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {rooms.map((room) => (
                                <div key={room.id} className="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                                    <div className="flex justify-between items-start mb-4">
                                        <h3 className="text-lg font-semibold text-gray-900">{room.name}</h3>
                                        <button
                                            onClick={() => toggleAvailability(room.id)}
                                            className={`px-2 py-1 text-xs rounded-full cursor-pointer transition-colors ${
                                                room.available 
                                                    ? 'bg-green-100 text-green-800 hover:bg-green-200' 
                                                    : 'bg-red-100 text-red-800 hover:bg-red-200'
                                            }`}
                                        >
                                            {room.available ? 'Available' : 'Unavailable'}
                                        </button>
                                    </div>
                                    <div className="space-y-2 text-sm text-gray-600 mb-4">
                                        <p><span className="font-medium">Type:</span> {room.type}</p>
                                        <p><span className="font-medium">Price:</span> ${room.price}/night</p>
                                        <p><span className="font-medium">Capacity:</span> {room.capacity} guests</p>
                                        {room.size && <p><span className="font-medium">Size:</span> {room.size}</p>}
                                        {room.beds && <p><span className="font-medium">Beds:</span> {room.beds}</p>}
                                        {room.features && room.features.length > 0 && (
                                            <div>
                                                <span className="font-medium">Features:</span>
                                                <ul className="list-disc list-inside ml-2 mt-1">
                                                    {room.features.slice(0, 3).map((feature, index) => (
                                                        <li key={index} className="text-xs">{feature}</li>
                                                    ))}
                                                </ul>
                                            </div>
                                        )}
                                        {getCompatiblePackages(room).length > 0 && (
                                            <div>
                                                <span className="font-medium">Compatible Packages:</span>
                                                <div className="flex flex-wrap gap-1 mt-1">
                                                    {getCompatiblePackages(room).slice(0, 2).map((pkg, index) => (
                                                        <span key={index} className="px-1 py-0.5 text-xs bg-blue-100 text-blue-800 rounded">
                                                            {pkg.name}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                    <div className="flex gap-2">
                                        <button 
                                            onClick={() => handleEdit(room)}
                                            className="flex-1 bg-blue-600 text-white px-3 py-2 rounded text-sm hover:bg-blue-700 transition-colors"
                                        >
                                            Edit
                                        </button>
                                        <button 
                                            onClick={() => handleDelete(room.id)}
                                            className="flex-1 bg-red-600 text-white px-3 py-2 rounded text-sm hover:bg-red-700 transition-colors"
                                        >
                                            Delete
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // Packages Management Section
        function PackagesSection() {
            const [packages, setPackages] = useState([]);
            const [loading, setLoading] = useState(true);
            const [editingPackage, setEditingPackage] = useState(null);
            const [showAddForm, setShowAddForm] = useState(false);
            const [formData, setFormData] = useState({
                name: '',
                description: '',
                package_type: 'business',
                base_price: '',
                discount_percentage: '',
                min_nights: '',
                max_nights: '',
                max_guests: '',
                is_active: true,
                includes: '', // Store as string for easier typing
                valid_from: '',
                valid_until: '',
                terms: '',
                image_url: ''
            });

            const packageTypes = ['romantic', 'business', 'family', 'luxury', 'weekend', 'holiday', 'spa', 'adventure'];

            useEffect(() => {
                loadPackages();
            }, []);

            const loadPackages = async () => {
                try {
                    setLoading(true);
                    const response = await fetch(getApiUrl('packages.php'));
                    const data = await response.json();
                    console.log('API Response:', data);
                    if (data.success) {
                        setPackages(data.data);
                        console.log('Packages loaded:', data.data.length);
                    } else {
                        console.error('Error loading packages:', data.error);
                        alert('Error loading packages: ' + data.error);
                    }
                } catch (error) {
                    console.error('Error loading packages:', error);
                    alert('Error loading packages. Please check if XAMPP is running. Error: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleInputChange = (field, value) => {
                setFormData(prev => ({
                    ...prev,
                    [field]: value
                }));
            };

            const handleIncludesChange = (value) => {
                // Store the raw string value, don't process until save
                setFormData(prev => ({
                    ...prev,
                    includes: value // Store as string, not array
                }));
            };

            const resetForm = () => {
                setFormData({
                    name: '',
                    description: '',
                    package_type: 'business',
                    base_price: '',
                    discount_percentage: '',
                    min_nights: '',
                    max_nights: '',
                    max_guests: '',
                    is_active: true,
                    includes: '',
                    valid_from: '',
                    valid_until: '',
                    terms: '',
                    image_url: ''
                });
                setEditingPackage(null);
                setShowAddForm(false);
            };

            const handleEdit = (pkg) => {
                const includesValue = pkg.inclusions || pkg.includes || [];
                const includesString = Array.isArray(includesValue) ? includesValue.join(', ') : includesValue.toString();
                
                setFormData({
                    name: pkg.name,
                    description: pkg.description,
                    package_type: pkg.type || pkg.package_type, // Handle both field names
                    base_price: (pkg.price || pkg.base_price || 0).toString(), // Handle both field names
                    discount_percentage: (pkg.discount_percentage || 0).toString(),
                    min_nights: (pkg.min_nights || 1).toString(),
                    max_nights: (pkg.max_nights || 30).toString(),
                    max_guests: (pkg.max_guests || 2).toString(),
                    is_active: pkg.available || pkg.is_active || true,
                    includes: includesString,
                    valid_from: pkg.valid_from || '',
                    valid_until: pkg.valid_until || '',
                    terms: pkg.terms_conditions || pkg.terms || '',
                    image_url: pkg.image_url || ''
                });
                setEditingPackage(pkg.id);
                setShowAddForm(true);
            };

            const handleSave = async () => {
                if (!formData.name || !formData.base_price) {
                    alert('Please fill in required fields (Name and Base Price)');
                    return;
                }

                // Convert includes string to array for API
                const includesArray = formData.includes 
                    ? formData.includes.split(',').map(item => item.trim()).filter(item => item)
                    : [];

                // Convert image_url to images array format
                const imagesArray = formData.image_url 
                    ? [formData.image_url.trim()] 
                    : [];

                const packageData = {
                    ...formData,
                    price: parseFloat(formData.base_price), // Convert base_price to price for API
                    base_price: parseFloat(formData.base_price), // Keep for backward compatibility
                    type: formData.package_type, // Convert package_type to type for API
                    package_type: formData.package_type, // Keep for backward compatibility
                    inclusions: includesArray, // Convert includes to inclusions for API
                    includes: includesArray, // Keep for backward compatibility
                    images: imagesArray, // Convert image_url to images array for API
                    image_url: formData.image_url, // Keep for backward compatibility
                    available: formData.is_active ? 1 : 0, // Convert is_active to available for API
                    is_active: formData.is_active, // Keep for backward compatibility
                    discount_percentage: parseInt(formData.discount_percentage) || 0,
                    min_nights: parseInt(formData.min_nights) || 1,
                    max_nights: parseInt(formData.max_nights) || 30,
                    max_guests: parseInt(formData.max_guests) || 1
                };

                try {
                    if (editingPackage) {
                        // Update existing package
                        const response = await fetch(getApiUrl('packages.php'), {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ ...packageData, id: editingPackage })
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            alert('Package updated successfully!');
                            loadPackages(); // Reload packages from database
                        } else {
                            alert('Error updating package: ' + result.error);
                            return;
                        }
                    } else {
                        // Add new package
                        const response = await fetch(getApiUrl('packages.php'), {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(packageData)
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            alert('Package added successfully!');
                            loadPackages(); // Reload packages from database
                        } else {
                            alert('Error adding package: ' + result.error);
                            return;
                        }
                    }

                    resetForm();
                } catch (error) {
                    console.error('Error saving package:', error);
                    alert('Error saving package. Please check if XAMPP is running.');
                }
            };

            const handleDelete = async (id) => {
                if (confirm('Are you sure you want to delete this package?')) {
                    try {
                        const response = await fetch(getApiUrl('packages.php'), {
                            method: 'DELETE',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ id: id })
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            alert('Package deleted successfully!');
                            loadPackages(); // Reload packages from database
                        } else {
                            alert('Error deleting package: ' + result.error);
                        }
                    } catch (error) {
                        console.error('Error deleting package:', error);
                        alert('Error deleting package. Please check if XAMPP is running.');
                    }
                }
            };

            const toggleStatus = async (id) => {
                try {
                    const packageData = packages.find(pkg => pkg.id === id);
                    if (!packageData) return;

                    const response = await fetch(getApiUrl('packages.php'), {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ 
                            ...packageData, 
                            available: packageData.available ? 0 : 1 
                        })
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        loadPackages(); // Reload packages from database
                    } else {
                        alert('Error updating package status: ' + result.error);
                    }
                } catch (error) {
                    console.error('Error updating package status:', error);
                    alert('Error updating package status. Please check if XAMPP is running.');
                }
            };

            return (
                <div className="p-6">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold text-gray-900">Packages Management</h2>
                        <div className="flex gap-2">
                            <button 
                                onClick={loadPackages}
                                className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors"
                            >
                                Refresh
                            </button>
                            <button 
                                onClick={() => setShowAddForm(true)}
                                className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
                            >
                                Add Package
                            </button>
                        </div>
                    </div>

                    {/* Add/Edit Form Modal */}
                    {showAddForm && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-lg p-6 w-full max-w-2xl max-h-screen overflow-y-auto">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-semibold">
                                        {editingPackage ? 'Edit Package' : 'Add New Package'}
                                    </h3>
                                    <button 
                                        onClick={resetForm}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        ‚úï
                                    </button>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Package Name*</label>
                                        <input
                                            type="text"
                                            value={formData.name}
                                            onChange={(e) => handleInputChange('name', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="Enter package name"
                                        />
                                    </div>

                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                        <textarea
                                            value={formData.description}
                                            onChange={(e) => handleInputChange('description', e.target.value)}
                                            rows="3"
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="Enter package description"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Package Type</label>
                                        <select
                                            value={formData.package_type}
                                            onChange={(e) => handleInputChange('package_type', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        >
                                            {packageTypes.map(type => (
                                                <option key={type} value={type}>{type}</option>
                                            ))}
                                        </select>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Base Price ($)*</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            value={formData.base_price}
                                            onChange={(e) => handleInputChange('base_price', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="0.00"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Discount (%)</label>
                                        <input
                                            type="number"
                                            min="0"
                                            max="100"
                                            value={formData.discount_percentage}
                                            onChange={(e) => handleInputChange('discount_percentage', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="0"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Max Guests</label>
                                        <input
                                            type="number"
                                            min="1"
                                            value={formData.max_guests}
                                            onChange={(e) => handleInputChange('max_guests', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="1"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Min Nights</label>
                                        <input
                                            type="number"
                                            min="1"
                                            value={formData.min_nights}
                                            onChange={(e) => handleInputChange('min_nights', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="1"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Max Nights</label>
                                        <input
                                            type="number"
                                            min="1"
                                            value={formData.max_nights}
                                            onChange={(e) => handleInputChange('max_nights', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="30"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Valid From</label>
                                        <input
                                            type="date"
                                            value={formData.valid_from}
                                            onChange={(e) => handleInputChange('valid_from', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Valid Until</label>
                                        <input
                                            type="date"
                                            value={formData.valid_until}
                                            onChange={(e) => handleInputChange('valid_until', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        />
                                    </div>

                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Package Includes (comma-separated)</label>
                                        <input
                                            type="text"
                                            value={formData.includes}
                                            onChange={(e) => handleIncludesChange(e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="e.g., Breakfast, WiFi, Parking"
                                        />
                                    </div>

                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Terms & Conditions</label>
                                        <textarea
                                            value={formData.terms}
                                            onChange={(e) => handleInputChange('terms', e.target.value)}
                                            rows="3"
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="Enter terms and conditions for this package"
                                        />
                                    </div>

                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Image URL</label>
                                        <input
                                            type="url"
                                            value={formData.image_url}
                                            onChange={(e) => handleInputChange('image_url', e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="https://example.com/image.jpg"
                                        />
                                    </div>

                                    <div className="md:col-span-2">
                                        <label className="flex items-center">
                                            <input
                                                type="checkbox"
                                                checked={formData.is_active}
                                                onChange={(e) => handleInputChange('is_active', e.target.checked)}
                                                className="mr-2"
                                            />
                                            <span className="text-sm font-medium text-gray-700">Active Package</span>
                                        </label>
                                    </div>
                                </div>

                                <div className="flex gap-2 mt-6">
                                    <button
                                        onClick={handleSave}
                                        className="flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors"
                                    >
                                        {editingPackage ? 'Update Package' : 'Add Package'}
                                    </button>
                                    <button
                                        onClick={resetForm}
                                        className="flex-1 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {loading ? (
                        <div className="text-center py-8">Loading packages...</div>
                    ) : (
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            {packages.map((pkg) => (
                                <div key={pkg.id} className="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                                    <div className="flex justify-between items-start mb-4">
                                        <h3 className="text-lg font-semibold text-gray-900">{pkg.name}</h3>
                                        <div className="flex gap-2">
                                            <button
                                                onClick={() => toggleStatus(pkg.id)}
                                                className={`px-2 py-1 text-xs rounded-full cursor-pointer transition-colors ${
                                                    (pkg.available || pkg.is_active) 
                                                        ? 'bg-green-100 text-green-800 hover:bg-green-200' 
                                                        : 'bg-red-100 text-red-800 hover:bg-red-200'
                                                }`}
                                            >
                                                {(pkg.available || pkg.is_active) ? 'Active' : 'Inactive'}
                                            </button>
                                            <span className="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">
                                                {pkg.discount_percentage}% OFF
                                            </span>
                                        </div>
                                    </div>
                                    <p className="text-sm text-gray-600 mb-4">{pkg.description}</p>
                                    <div className="space-y-2 text-sm text-gray-600 mb-4">
                                        <p><span className="font-medium">Type:</span> {pkg.type || pkg.package_type}</p>
                                        <p><span className="font-medium">Price:</span> ${pkg.price || pkg.base_price}</p>
                                        <p><span className="font-medium">Duration:</span> {pkg.duration_days || `${pkg.min_nights}-${pkg.max_nights}`} {pkg.duration_days ? 'days' : 'nights'}</p>
                                        <p><span className="font-medium">Max Guests:</span> {pkg.max_guests}</p>
                                        {pkg.valid_from && pkg.valid_until && (
                                            <p><span className="font-medium">Valid:</span> {pkg.valid_from} to {pkg.valid_until}</p>
                                        )}
                                        {(pkg.inclusions || pkg.includes) && (pkg.inclusions || pkg.includes).length > 0 && (
                                            <div>
                                                <span className="font-medium">Includes:</span>
                                                <ul className="list-disc list-inside ml-2 mt-1">
                                                    {(pkg.inclusions || pkg.includes).map((item, index) => (
                                                        <li key={index} className="text-xs">{item}</li>
                                                    ))}
                                                </ul>
                                            </div>
                                        )}
                                        {pkg.terms && (
                                            <div>
                                                <span className="font-medium">Terms:</span>
                                                <p className="text-xs mt-1">{pkg.terms}</p>
                                            </div>
                                        )}
                                        {pkg.image_url && (
                                            <p><span className="font-medium">Image:</span> 
                                                <a href={pkg.image_url} target="_blank" className="text-blue-600 hover:text-blue-800 ml-1">View Image</a>
                                            </p>
                                        )}
                                    </div>
                                    <div className="flex gap-2">
                                        <button 
                                            onClick={() => handleEdit(pkg)}
                                            className="flex-1 bg-blue-600 text-white px-3 py-2 rounded text-sm hover:bg-blue-700 transition-colors"
                                        >
                                            Edit
                                        </button>
                                        <button 
                                            onClick={() => handleDelete(pkg.id)}
                                            className="flex-1 bg-red-600 text-white px-3 py-2 rounded text-sm hover:bg-red-700 transition-colors"
                                        >
                                            Delete
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // Property Management Section (Merged Villa Info + Business Details + Reviews)
        function PropertyManagementSection() {
            const [loading, setLoading] = useState(true);
            const [saving, setSaving] = useState(false);
            const [isEditing, setIsEditing] = useState(false);
            const [activeTab, setActiveTab] = useState('basic'); // basic | marketing | business | reviews
            const [propertyData, setPropertyData] = useState(() => {
                const businessConfig = window.getBusinessConfig ? window.getBusinessConfig() : {};
                return {
                    // Property
                    propertyName: 'Serene Mountain Retreat',
                    location: 'Aspen, Colorado',
                    marketingDescription: 'Escape to this stunning mountain retreat where modern luxury meets rustic charm. Nestled in the heart of the Rockies, this villa offers breathtaking views.',
                    rating: 4.9,
                    reviews: 128,
                    images: [
                        'https://images.unsplash.com/photo-1580587771525-78b9dba3b914?q=80&w=2574&auto=format&fit=crop',
                        'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?q=80&w=2670&auto=format&fit=crop'
                    ],
                    amenities: [
                        { name: 'High-speed Wifi', icon: 'Wifi' },
                        { name: 'Private Hot Tub', icon: 'Bath' },
                        { name: 'Indoor Fireplace', icon: 'Flame' }
                    ],
                    // Business
                    businessName: businessConfig.NAME || 'Villa Daisy Cantik',
                    businessDescription: businessConfig.DESCRIPTION || 'Experience luxury and tranquility at Villa Daisy Cantik.',
                    email: businessConfig.EMAIL || 'info@rumahdaisycantik.com',
                    phone: businessConfig.PHONE || '+62 361 234 5678',
                    address: businessConfig.ADDRESS || 'Jl. Ubud Raya',
                    city: businessConfig.CITY || 'Ubud',
                    state: businessConfig.STATE || 'Bali',
                    zipCode: '80571',
                    country: businessConfig.COUNTRY || 'Indonesia',
                    website: businessConfig.WEBSITE || 'https://booking.rumahdaisycantik.com',
                    checkInTime: businessConfig.CHECK_IN_TIME || '14:00',
                    checkOutTime: businessConfig.CHECK_OUT_TIME || '12:00',
                    currency: businessConfig.CURRENCY || 'IDR',
                    taxRate: businessConfig.TAX_RATE || '10',
                    cancellationPolicy: businessConfig.CANCELLATION_POLICY || '24',
                    paymentMethods: ['Credit Card', 'Bank Transfer', 'PayPal', 'Cash'],
                    socialMedia: {
                        facebook: businessConfig.SOCIAL_MEDIA?.facebook || 'https://facebook.com/villadaisycantik',
                        instagram: businessConfig.SOCIAL_MEDIA?.instagram || 'https://instagram.com/villadaisycantik',
                        whatsapp: businessConfig.SOCIAL_MEDIA?.whatsapp || 'https://wa.me/6236123456789'
                    }
                };
            });

            useEffect(() => {
                loadPropertyData();
            }, []);

            const loadPropertyData = async () => {
                try {
                    if (!window.getApiUrl) {
                        console.error('‚ùå config.js not loaded - getApiUrl function missing');
                        return;
                    }
                    const apiUrl = window.getApiUrl('villa.php');
                    const response = await fetch(apiUrl);
                    const data = await response.json();
                    if (data.success && data.data) {
                        const d = data.data;
                        setPropertyData(prev => ({
                            ...prev,
                            propertyName: d.name || prev.propertyName,
                            marketingDescription: d.description || prev.marketingDescription,
                            location: d.location || prev.location,
                            rating: d.rating || prev.rating,
                            reviews: d.reviews || prev.reviews,
                            images: d.images?.length ? d.images : prev.images,
                            amenities: d.amenities?.length ? d.amenities : prev.amenities,
                            businessName: d.business_name || prev.businessName,
                            businessDescription: d.business_description || prev.businessDescription,
                            email: d.email || prev.email,
                            phone: d.phone || prev.phone,
                            address: d.address || prev.address,
                            city: d.city || prev.city,
                            state: d.state || prev.state,
                            zipCode: d.zipCode || prev.zipCode,
                            country: d.country || prev.country,
                            website: d.website || prev.website,
                            checkInTime: d.check_in_time || prev.checkInTime,
                            checkOutTime: d.check_out_time || prev.checkOutTime,
                            currency: d.currency || prev.currency,
                            taxRate: d.tax_rate || prev.taxRate,
                            cancellationPolicy: d.cancellation_policy || prev.cancellationPolicy,
                            paymentMethods: d.payment_methods?.length ? d.payment_methods : prev.paymentMethods,
                            socialMedia: d.social_media ? { ...prev.socialMedia, ...d.social_media } : prev.socialMedia
                        }));
                        console.log('‚úÖ Property management data loaded');
                    }
                } catch (e) {
                    console.error('‚ùå Error loading property data', e);
                } finally {
                    setLoading(false);
                }
            };

            const updateField = (field, value) => {
                setPropertyData(prev => ({ ...prev, [field]: value }));
            };
            const updateNestedField = (parent, child, value) => {
                setPropertyData(prev => ({
                    ...prev,
                    [parent]: { ...prev[parent], [child]: value }
                }));
            };

            const handleImageChange = (index, value) => {
                const newImages = [...propertyData.images];
                newImages[index] = value;
                updateField('images', newImages);
            };
            const addImage = () => updateField('images', [...propertyData.images, '']);
            const removeImage = (index) => updateField('images', propertyData.images.filter((_, i) => i !== index));

            const handleAmenityChange = (index, field, value) => {
                const newAmenities = [...propertyData.amenities];
                newAmenities[index] = { ...newAmenities[index], [field]: value };
                updateField('amenities', newAmenities);
            };
            const addAmenity = () => updateField('amenities', [...propertyData.amenities, { name: '', icon: 'Star' }]);
            const removeAmenity = (index) => updateField('amenities', propertyData.amenities.filter((_, i) => i !== index));

            const handleSave = async () => {
                setSaving(true);
                try {
                    if (!window.getApiUrl) {
                        alert('Configuration error: refresh page');
                        setSaving(false);
                        return;
                    }
                    const apiUrl = window.getApiUrl('villa.php');
                    // Map to current backend schema (still expects name/description etc.)
                    const payload = {
                        name: propertyData.propertyName,
                        description: propertyData.marketingDescription,
                        location: propertyData.location,
                        rating: propertyData.rating,
                        reviews: propertyData.reviews,
                        images: propertyData.images,
                        amenities: propertyData.amenities,
                        email: propertyData.email,
                        phone: propertyData.phone,
                        address: propertyData.address,
                        city: propertyData.city,
                        state: propertyData.state,
                        zipCode: propertyData.zipCode,
                        country: propertyData.country,
                        website: propertyData.website,
                        check_in_time: propertyData.checkInTime,
                        check_out_time: propertyData.checkOutTime,
                        currency: propertyData.currency,
                        tax_rate: propertyData.taxRate,
                        cancellation_policy: propertyData.cancellationPolicy,
                        payment_methods: propertyData.paymentMethods,
                        social_media: propertyData.socialMedia,
                        // Future fields (not yet in backend)
                        business_name: propertyData.businessName,
                        business_description: propertyData.businessDescription
                    };
                    console.log('üíæ Saving merged property payload:', payload);
                    const response = await fetch(apiUrl, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    if (result.success) {
                        alert('Property management data saved');
                        setIsEditing(false);
                        await loadPropertyData();
                    } else {
                        alert('Error saving: ' + (result.message || 'Unknown'));
                        console.error(result);
                    }
                } catch (e) {
                    alert('Network error: ' + e.message);
                    console.error(e);
                } finally {
                    setSaving(false);
                }
            };

            if (loading) {
                return <div className="p-6"><div className="py-8 text-center">Loading property management...</div></div>;
            }

            const TabButton = ({ id, label }) => (
                <button
                    onClick={() => setActiveTab(id)}
                    className={`px-4 py-2 text-sm rounded-md border transition-colors ${activeTab === id ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-700 hover:bg-gray-50'}`}
                >{label}</button>
            );

            return (
                <div className="p-6">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold text-gray-900">Property Management</h2>
                        <div className="flex gap-2">
                            {!isEditing ? (
                                <button onClick={() => setIsEditing(true)} className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Edit</button>
                            ) : (
                                <>
                                    <button onClick={() => { setIsEditing(false); loadPropertyData(); }} className="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">Cancel</button>
                                    <button onClick={handleSave} disabled={saving} className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50">{saving ? 'Saving...' : 'Save All'}</button>
                                </>
                            )}
                        </div>
                    </div>

                    {/* Tabs */}
                    <div className="flex flex-wrap gap-2 mb-6">
                        <TabButton id="basic" label="Basic Info" />
                        <TabButton id="marketing" label="Marketing" />
                        <TabButton id="business" label="Business" />
                        <TabButton id="reviews" label="Reviews" />
                    </div>

                    {/* Tab Content */}
                    {activeTab === 'basic' && (
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div className="space-y-6">
                                <div className="bg-gray-50 p-6 rounded-lg">
                                    <h3 className="text-lg font-semibold mb-4">Basic Information</h3>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Property Name</label>
                                            {isEditing ? (
                                                <input type="text" value={propertyData.propertyName} onChange={e => updateField('propertyName', e.target.value)} className="w-full px-3 py-2 border rounded" />
                                            ) : <p>{propertyData.propertyName}</p>}
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Business Name</label>
                                            {isEditing ? (
                                                <input type="text" value={propertyData.businessName} onChange={e => updateField('businessName', e.target.value)} className="w-full px-3 py-2 border rounded" />
                                            ) : <p>{propertyData.businessName}</p>}
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Location</label>
                                            {isEditing ? (
                                                <input type="text" value={propertyData.location} onChange={e => updateField('location', e.target.value)} className="w-full px-3 py-2 border rounded" />
                                            ) : <p>{propertyData.location}</p>}
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Check-in Time</label>
                                                {isEditing ? <input type="time" value={propertyData.checkInTime} onChange={e => updateField('checkInTime', e.target.value)} className="w-full px-3 py-2 border rounded" /> : <p>{propertyData.checkInTime}</p>}
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Check-out Time</label>
                                                {isEditing ? <input type="time" value={propertyData.checkOutTime} onChange={e => updateField('checkOutTime', e.target.value)} className="w-full px-3 py-2 border rounded" /> : <p>{propertyData.checkOutTime}</p>}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-gray-50 p-6 rounded-lg">
                                    <h3 className="text-lg font-semibold mb-4">Contact & Address</h3>
                                    <div className="space-y-4">
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Email</label>
                                                {isEditing ? <input type="email" value={propertyData.email} onChange={e => updateField('email', e.target.value)} className="w-full px-3 py-2 border rounded" /> : <p>{propertyData.email}</p>}
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Phone</label>
                                                {isEditing ? <input type="tel" value={propertyData.phone} onChange={e => updateField('phone', e.target.value)} className="w-full px-3 py-2 border rounded" /> : <p>{propertyData.phone}</p>}
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Street Address</label>
                                            {isEditing ? <input type="text" value={propertyData.address} onChange={e => updateField('address', e.target.value)} className="w-full px-3 py-2 border rounded" /> : <p>{propertyData.address}</p>}
                                        </div>
                                        <div className="grid grid-cols-3 gap-4">
                                            <div>{isEditing ? <input type="text" value={propertyData.city} onChange={e => updateField('city', e.target.value)} className="w-full px-3 py-2 border rounded" /> : <p><span className="font-medium">City:</span> {propertyData.city}</p>}</div>
                                            <div>{isEditing ? <input type="text" value={propertyData.state} onChange={e => updateField('state', e.target.value)} className="w-full px-3 py-2 border rounded" /> : <p><span className="font-medium">State:</span> {propertyData.state}</p>}</div>
                                            <div>{isEditing ? <input type="text" value={propertyData.country} onChange={e => updateField('country', e.target.value)} className="w-full px-3 py-2 border rounded" /> : <p><span className="font-medium">Country:</span> {propertyData.country}</p>}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div className="space-y-6">
                                <div className="bg-gray-50 p-6 rounded-lg">
                                    <h3 className="text-lg font-semibold mb-4">Financial Settings</h3>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Currency</label>
                                            {isEditing ? (
                                                <select value={propertyData.currency} onChange={e => updateField('currency', e.target.value)} className="w-full px-3 py-2 border rounded">
                                                    <option value="IDR">IDR (Rp)</option>
                                                    <option value="USD">USD ($)</option>
                                                    <option value="EUR">EUR (‚Ç¨)</option>
                                                </select>
                                            ) : <p>{propertyData.currency}</p>}
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Tax Rate (%)</label>
                                            {isEditing ? <input type="number" value={propertyData.taxRate} onChange={e => updateField('taxRate', e.target.value)} className="w-full px-3 py-2 border rounded" /> : <p>{propertyData.taxRate}%</p>}
                                        </div>
                                        <div className="col-span-2">
                                            <label className="block text-sm font-medium mb-1">Cancellation Policy (hours before)</label>
                                            {isEditing ? <input type="number" value={propertyData.cancellationPolicy} onChange={e => updateField('cancellationPolicy', e.target.value)} className="w-full px-3 py-2 border rounded" /> : <p>{propertyData.cancellationPolicy} hours</p>}
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-gray-50 p-6 rounded-lg">
                                    <h3 className="text-lg font-semibold mb-4">Social Media</h3>
                                    <div className="space-y-4">
                                        {['facebook','instagram','whatsapp'].map(platform => (
                                            <div key={platform}>
                                                <label className="block text-sm font-medium mb-1 capitalize">{platform}</label>
                                                {isEditing ? <input type="url" value={propertyData.socialMedia[platform]} onChange={e => updateNestedField('socialMedia', platform, e.target.value)} className="w-full px-3 py-2 border rounded" /> : <a href={propertyData.socialMedia[platform]} target="_blank" className="text-blue-600 hover:text-blue-800">{propertyData.socialMedia[platform]}</a>}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'marketing' && (
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div className="space-y-6">
                                <div className="bg-gray-50 p-6 rounded-lg">
                                    <h3 className="text-lg font-semibold mb-4">Marketing Description</h3>
                                    {isEditing ? <textarea rows={6} value={propertyData.marketingDescription} onChange={e => updateField('marketingDescription', e.target.value)} className="w-full px-3 py-2 border rounded" /> : <p>{propertyData.marketingDescription}</p>}
                                </div>
                                <div className="bg-gray-50 p-6 rounded-lg">
                                    <h3 className="text-lg font-semibold mb-4">Business Description / Policies</h3>
                                    {isEditing ? <textarea rows={6} value={propertyData.businessDescription} onChange={e => updateField('businessDescription', e.target.value)} className="w-full px-3 py-2 border rounded" /> : <p>{propertyData.businessDescription}</p>}
                                </div>
                            </div>
                            <div className="space-y-6">
                                <div className="bg-gray-50 p-6 rounded-lg">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-lg font-semibold">Images</h3>
                                        {isEditing && <button onClick={addImage} className="bg-blue-600 text-white px-3 py-1 rounded text-sm">Add Image</button>}
                                    </div>
                                    <div className="space-y-3">
                                        {propertyData.images.map((img, i) => (
                                            <div key={i} className="flex items-center gap-2">
                                                {isEditing ? (
                                                    <>
                                                        <input type="url" value={img} onChange={e => handleImageChange(i, e.target.value)} placeholder="Image URL" className="flex-1 px-3 py-2 border rounded" />
                                                        <button onClick={() => removeImage(i)} className="bg-red-600 text-white px-2 py-2 rounded text-sm">Remove</button>
                                                    </>
                                                ) : (
                                                    <div className="flex items-center gap-3">
                                                        <img src={img} alt={"Image " + (i+1)} className="w-16 h-16 object-cover rounded" />
                                                        <p className="text-xs text-gray-600 truncate flex-1">{img}</p>
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="bg-gray-50 p-6 rounded-lg">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-lg font-semibold">Amenities</h3>
                                        {isEditing && <button onClick={addAmenity} className="bg-blue-600 text-white px-3 py-1 rounded text-sm">Add Amenity</button>}
                                    </div>
                                    <div className="space-y-3">
                                        {propertyData.amenities.map((amenity, i) => (
                                            <div key={i} className="flex items-center gap-2">
                                                {isEditing ? (
                                                    <>
                                                        <input type="text" value={amenity.name} onChange={e => handleAmenityChange(i,'name',e.target.value)} placeholder="Amenity name" className="flex-1 px-3 py-2 border rounded" />
                                                        <select value={amenity.icon} onChange={e => handleAmenityChange(i,'icon',e.target.value)} className="px-3 py-2 border rounded">
                                                            <option>Wifi</option>
                                                            <option>Bath</option>
                                                            <option>Flame</option>
                                                            <option>CookingPot</option>
                                                            <option>Car</option>
                                                            <option>AirVent</option>
                                                            <option>Star</option>
                                                            <option>Home</option>
                                                            <option>Coffee</option>
                                                            <option>Tv</option>
                                                        </select>
                                                        <button onClick={() => removeAmenity(i)} className="bg-red-600 text-white px-2 py-2 rounded text-sm">Remove</button>
                                                    </>
                                                ) : (
                                                    <div className="flex items-center gap-3 p-2 bg-white rounded">
                                                        <span className="text-gray-600">{amenity.icon}</span>
                                                        <span className="text-gray-900">{amenity.name}</span>
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'business' && (
                        <div className="space-y-6">
                            <div className="bg-gray-50 p-6 rounded-lg">
                                <h3 className="text-lg font-semibold mb-4">Online Presence</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Website</label>
                                        {isEditing ? <input type="url" value={propertyData.website} onChange={e => updateField('website', e.target.value)} className="w-full px-3 py-2 border rounded" /> : <a href={propertyData.website} target="_blank" className="text-blue-600 hover:text-blue-800">{propertyData.website}</a>}
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Payment Methods</label>
                                        <div className="flex flex-wrap gap-2">
                                            {propertyData.paymentMethods.map((m,i) => (
                                                <span key={i} className="px-3 py-1 text-xs rounded-full bg-blue-50 text-blue-700 border border-blue-200">{m}</span>
                                            ))}
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Social Media (summary)</label>
                                        <ul className="text-xs text-gray-600 space-y-1">
                                            {Object.entries(propertyData.socialMedia).map(([platform,url]) => (
                                                <li key={platform}><span className="font-medium capitalize">{platform}:</span> <a href={url} target="_blank" className="text-blue-600 hover:underline">{url}</a></li>
                                            ))}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'reviews' && (
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div className="bg-gray-50 p-6 rounded-lg">
                                <h3 className="text-lg font-semibold mb-4">Rating & Reviews</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Rating</label>
                                        {isEditing ? <input type="number" min="0" max="5" step="0.1" value={propertyData.rating} onChange={e => updateField('rating', parseFloat(e.target.value))} className="w-full px-3 py-2 border rounded" /> : <p>{propertyData.rating} / 5</p>}
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Total Reviews</label>
                                        {isEditing ? <input type="number" min="0" value={propertyData.reviews} onChange={e => updateField('reviews', parseInt(e.target.value))} className="w-full px-3 py-2 border rounded" /> : <p>{propertyData.reviews} reviews</p>}
                                    </div>
                                </div>
                            </div>
                            <div className="bg-gray-50 p-6 rounded-lg">
                                <h3 className="text-lg font-semibold mb-4">Summary</h3>
                                <p className="text-sm text-gray-700">This section will later integrate with a reviews API to pull guest feedback and calculate aggregated sentiment scores.</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Analytics Section (New)
        function AnalyticsSection() {
            return (
                <div className="p-6">
                    <h2 className="text-2xl font-bold text-gray-900 mb-6">Analytics & Insights</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                        <div className="bg-indigo-50 p-6 rounded-lg">
                            <h3 className="text-sm font-medium text-indigo-700">Booking Conversion Rate</h3>
                            <p className="text-3xl font-bold text-indigo-900 mt-2">4.2%</p>
                            <p className="text-xs text-indigo-600 mt-1">Last 30 days</p>
                        </div>
                        <div className="bg-pink-50 p-6 rounded-lg">
                            <h3 className="text-sm font-medium text-pink-700">Average Stay Length</h3>
                            <p className="text-3xl font-bold text-pink-900 mt-2">3.4 nights</p>
                            <p className="text-xs text-pink-600 mt-1">Rolling average</p>
                        </div>
                        <div className="bg-teal-50 p-6 rounded-lg">
                            <h3 className="text-sm font-medium text-teal-700">Revenue (Est.)</h3>
                            <p className="text-3xl font-bold text-teal-900 mt-2">Rp 185M</p>
                            <p className="text-xs text-teal-600 mt-1">YTD</p>
                        </div>
                    </div>
                    <div className="bg-white border rounded-lg p-6">
                        <h3 className="text-lg font-semibold mb-4">Upcoming Enhancements</h3>
                        <ul className="list-disc list-inside space-y-2 text-sm text-gray-700">
                            <li>Integrate real booking data for dynamic charts</li>
                            <li>Add date range filter & export to CSV</li>
                            <li>Include occupancy rate & RevPAR metrics</li>
                            <li>Drill-down by room type and package performance</li>
                        </ul>
                    </div>
                </div>
            );
        }

        function SettingsSection() {
            const [settings, setSettings] = useState({
                // System Settings
                siteName: 'Villa Daisy Cantik',
                siteUrl: 'https://booking.rumahdaisycantik.com',
                adminEmail: 'admin@rumahdaisycantik.com',
                
                // Booking Settings  
                maxBookingMonths: '12',
                minBookingDays: '1',
                maxBookingDays: '30',
                bookingTimeLimit: '24',
                
                // Email Settings
                emailEnabled: true,
                emailHost: 'smtp.gmail.com',
                emailPort: '587',
                emailUsername: '',
                emailPassword: '',
                
                // Payment Settings
                currency: 'IDR',
                currencySymbol: 'Rp',
                taxRate: '10',
                serviceCharge: '5',
                
                // Display Settings
                dateFormat: 'DD/MM/YYYY',
                timeFormat: '24',
                language: 'en',
                timezone: 'Asia/Jakarta',
                
                // Security Settings
                sessionTimeout: '60',
                maxLoginAttempts: '5',
                passwordMinLength: '8',
                
                // Maintenance
                maintenanceMode: false,
                maintenanceMessage: 'Site is temporarily down for maintenance. Please check back later.',
                debugMode: false
            });
            
            const [isEditing, setIsEditing] = useState(false);
            const [saving, setSaving] = useState(false);
            const [activeTab, setActiveTab] = useState('system');

            useEffect(() => {
                loadSettings();
            }, []);

            const loadSettings = async () => {
                try {
                    // Load settings from villa.php or a dedicated settings API
                    const response = await fetch(getApiUrl('villa.php'));
                    const data = await response.json();
                    
                    if (data.success && data.data) {
                        // Merge loaded settings with defaults
                        setSettings(prev => ({
                            ...prev,
                            siteName: data.data.name || prev.siteName,
                            adminEmail: data.data.email || prev.adminEmail,
                            currency: data.data.currency || prev.currency,
                            taxRate: data.data.tax_rate || prev.taxRate,
                            // Add more mappings as needed
                        }));
                    }
                } catch (error) {
                    console.error('Error loading settings:', error);
                }
            };

            const handleInputChange = (field, value) => {
                setSettings(prev => ({
                    ...prev,
                    [field]: value
                }));
            };

            const handleSave = async () => {
                setSaving(true);
                try {
                    // Save settings to API
                    const response = await fetch(getApiUrl('villa.php'), {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            // Map settings back to villa API format
                            name: settings.siteName,
                            email: settings.adminEmail,
                            currency: settings.currency,
                            tax_rate: settings.taxRate,
                            // Add system-specific settings
                            settings: settings
                        }),
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        setIsEditing(false);
                        alert('Settings updated successfully!');
                        await loadSettings(); // Reload to confirm changes
                    } else {
                        alert('Error updating settings: ' + (result.message || result.error || 'Unknown error'));
                    }
                } catch (error) {
                    alert('Error updating settings: ' + error.message);
                    console.error('Settings save error:', error);
                } finally {
                    setSaving(false);
                }
            };

            const resetSettings = () => {
                if (confirm('Are you sure you want to reset all settings to defaults? This cannot be undone.')) {
                    loadSettings();
                    setIsEditing(false);
                    alert('Settings reset to defaults');
                }
            };

            const tabs = [
                { id: 'system', name: 'System', icon: '‚öôÔ∏è' },
                { id: 'booking', name: 'Booking', icon: 'üìÖ' },
                { id: 'email', name: 'Email', icon: 'üìß' },
                { id: 'payment', name: 'Payment', icon: 'üí≥' },
                { id: 'display', name: 'Display', icon: 'üé®' },
                { id: 'security', name: 'Security', icon: 'üîí' },
                { id: 'maintenance', name: 'Maintenance', icon: 'üîß' }
            ];

            return (
                <div className="p-6">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold text-gray-900">System Settings</h2>
                        <div className="flex gap-2">
                            {!isEditing ? (
                                <button 
                                    onClick={() => setIsEditing(true)}
                                    className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
                                >
                                    Edit Settings
                                </button>
                            ) : (
                                <>
                                    <button 
                                        onClick={() => setIsEditing(false)}
                                        className="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors"
                                    >
                                        Cancel
                                    </button>
                                    <button 
                                        onClick={resetSettings}
                                        className="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors"
                                    >
                                        Reset
                                    </button>
                                    <button 
                                        onClick={handleSave}
                                        disabled={saving}
                                        className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50"
                                    >
                                        {saving ? 'Saving...' : 'Save Settings'}
                                    </button>
                                </>
                            )}
                        </div>
                    </div>

                    {/* Settings Tabs */}
                    <div className="mb-6">
                        <nav className="flex space-x-4 overflow-x-auto">
                            {tabs.map((tab) => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex items-center px-4 py-2 text-sm font-medium rounded-lg whitespace-nowrap transition-colors ${
                                        activeTab === tab.id
                                            ? 'bg-blue-100 text-blue-800 border border-blue-300'
                                            : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                                    }`}
                                >
                                    <span className="mr-2">{tab.icon}</span>
                                    {tab.name}
                                </button>
                            ))}
                        </nav>
                    </div>

                    <div className="bg-white rounded-lg border">
                        {/* System Settings Tab */}
                        {activeTab === 'system' && (
                            <div className="p-6">
                                <h3 className="text-lg font-semibold mb-4">System Configuration</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Site Name</label>
                                        {isEditing ? (
                                            <input
                                                type="text"
                                                value={settings.siteName}
                                                onChange={(e) => handleInputChange('siteName', e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                        ) : (
                                            <p className="text-gray-900 py-2">{settings.siteName}</p>
                                        )}
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Site URL</label>
                                        {isEditing ? (
                                            <input
                                                type="url"
                                                value={settings.siteUrl}
                                                onChange={(e) => handleInputChange('siteUrl', e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                        ) : (
                                            <p className="text-gray-900 py-2">{settings.siteUrl}</p>
                                        )}
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Admin Email</label>
                                        {isEditing ? (
                                            <input
                                                type="email"
                                                value={settings.adminEmail}
                                                onChange={(e) => handleInputChange('adminEmail', e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                        ) : (
                                            <p className="text-gray-900 py-2">{settings.adminEmail}</p>
                                        )}
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Language</label>
                                        {isEditing ? (
                                            <select
                                                value={settings.language}
                                                onChange={(e) => handleInputChange('language', e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            >
                                                <option value="en">English</option>
                                                <option value="id">Bahasa Indonesia</option>
                                            </select>
                                        ) : (
                                            <p className="text-gray-900 py-2">{settings.language === 'en' ? 'English' : 'Bahasa Indonesia'}</p>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Maintenance Tab */}
                        {activeTab === 'maintenance' && (
                            <div className="p-6">
                                <h3 className="text-lg font-semibold mb-4">Maintenance & Debug</h3>
                                <div className="space-y-6">
                                    <div className="flex items-center justify-between p-4 bg-orange-50 rounded-lg">
                                        <div>
                                            <h4 className="font-medium text-orange-900">Maintenance Mode</h4>
                                            <p className="text-sm text-orange-700">Enable to show maintenance page to visitors</p>
                                        </div>
                                        {isEditing ? (
                                            <label className="relative inline-flex items-center cursor-pointer">
                                                <input
                                                    type="checkbox"
                                                    checked={settings.maintenanceMode}
                                                    onChange={(e) => handleInputChange('maintenanceMode', e.target.checked)}
                                                    className="sr-only peer"
                                                />
                                                <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-600"></div>
                                            </label>
                                        ) : (
                                            <span className={`px-3 py-1 rounded-full text-sm ${settings.maintenanceMode ? 'bg-orange-100 text-orange-800' : 'bg-green-100 text-green-800'}`}>
                                                {settings.maintenanceMode ? 'Enabled' : 'Disabled'}
                                            </span>
                                        )}
                                    </div>

                                    <div className="flex items-center justify-between p-4 bg-blue-50 rounded-lg">
                                        <div>
                                            <h4 className="font-medium text-blue-900">Debug Mode</h4>
                                            <p className="text-sm text-blue-700">Show detailed error messages and debug info</p>
                                        </div>
                                        {isEditing ? (
                                            <label className="relative inline-flex items-center cursor-pointer">
                                                <input
                                                    type="checkbox"
                                                    checked={settings.debugMode}
                                                    onChange={(e) => handleInputChange('debugMode', e.target.checked)}
                                                    className="sr-only peer"
                                                />
                                                <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                            </label>
                                        ) : (
                                            <span className={`px-3 py-1 rounded-full text-sm ${settings.debugMode ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'}`}>
                                                {settings.debugMode ? 'Enabled' : 'Disabled'}
                                            </span>
                                        )}
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Maintenance Message</label>
                                        {isEditing ? (
                                            <textarea
                                                value={settings.maintenanceMessage}
                                                onChange={(e) => handleInputChange('maintenanceMessage', e.target.value)}
                                                rows="3"
                                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                        ) : (
                                            <p className="text-gray-900 py-2 bg-gray-50 rounded-md px-3">{settings.maintenanceMessage}</p>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Payment Settings Tab */}
                        {activeTab === 'payment' && (
                            <div className="p-6">
                                <h3 className="text-lg font-semibold mb-4">Payment Configuration</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Currency</label>
                                        {isEditing ? (
                                            <select
                                                value={settings.currency}
                                                onChange={(e) => handleInputChange('currency', e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            >
                                                <option value="IDR">Indonesian Rupiah (IDR)</option>
                                                <option value="USD">US Dollar (USD)</option>
                                                <option value="EUR">Euro (EUR)</option>
                                            </select>
                                        ) : (
                                            <p className="text-gray-900 py-2">{settings.currency}</p>
                                        )}
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Tax Rate (%)</label>
                                        {isEditing ? (
                                            <input
                                                type="number"
                                                value={settings.taxRate}
                                                onChange={(e) => handleInputChange('taxRate', e.target.value)}
                                                min="0"
                                                max="100"
                                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                        ) : (
                                            <p className="text-gray-900 py-2">{settings.taxRate}%</p>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Add more tabs as needed */}
                        {['booking', 'email', 'display', 'security'].includes(activeTab) && (
                            <div className="p-6">
                                <h3 className="text-lg font-semibold mb-4 capitalize">{activeTab} Settings</h3>
                                <div className="text-center py-8 text-gray-500">
                                    <p>{activeTab.charAt(0).toUpperCase() + activeTab.slice(1)} settings panel coming soon...</p>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<AdminDashboard />, document.getElementById('admin-root'));
    </script>
</body>
</html>
