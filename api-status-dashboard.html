<!DOCTYPE html>
<html>
<head>
    <title>üîß API Status Dashboard</title>
    <meta charset="utf-8">
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f8f9fa;
        }
        .header { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .status-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .status-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .success { border-left: 4px solid #28a745; }
        .error { border-left: 4px solid #dc3545; }
        .warning { border-left: 4px solid #ffc107; }
        .info { border-left: 4px solid #17a2b8; }
        .status-icon { font-size: 24px; margin-right: 10px; }
        .status-title { font-size: 18px; font-weight: 600; margin-bottom: 10px; }
        .status-detail { color: #666; font-size: 14px; margin-bottom: 8px; }
        .code-block { background: #f1f3f4; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; overflow-x: auto; }
        .button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        .button:hover { background: #0056b3; }
        .button.secondary { background: #6c757d; }
        .button.success { background: #28a745; }
        .button.danger { background: #dc3545; }
        .refresh-info { background: #e9ecef; padding: 15px; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîß Villa API Status Dashboard</h1>
        <p>Real-time diagnostic tool to identify why your app is using dummy data instead of live API data.</p>
        <button class="button success" onclick="runFullDiagnostic()">üöÄ Run Full Diagnostic</button>
        <button class="button secondary" onclick="location.reload()">üîÑ Refresh Page</button>
    </div>

    <div id="diagnosticResults" class="status-grid">
        <!-- Results will be populated by JavaScript -->
    </div>

    <script>
        const diagnosticResults = document.getElementById('diagnosticResults');

        // Environment Info
        function addEnvironmentCard() {
            const card = document.createElement('div');
            card.className = 'status-card info';
            card.innerHTML = `
                <div class="status-title">üåê Environment Information</div>
                <div class="status-detail"><strong>Current URL:</strong> ${window.location.href}</div>
                <div class="status-detail"><strong>Host:</strong> ${window.location.hostname}:${window.location.port}</div>
                <div class="status-detail"><strong>Protocol:</strong> ${window.location.protocol}</div>
                <div class="status-detail"><strong>User Agent:</strong> ${navigator.userAgent.substring(0, 50)}...</div>
            `;
            diagnosticResults.appendChild(card);
        }

        // Test API endpoint
        async function testAPIEndpoint(name, url, description) {
            const card = document.createElement('div');
            card.className = 'status-card warning';
            card.innerHTML = `
                <div class="status-title">‚è≥ Testing ${name}</div>
                <div class="status-detail">${description}</div>
                <div class="status-detail"><strong>URL:</strong> ${url}</div>
                <div class="status-detail">Testing connectivity...</div>
            `;
            diagnosticResults.appendChild(card);

            try {
                const startTime = Date.now();
                const response = await fetch(url);
                const endTime = Date.now();
                const responseTime = endTime - startTime;

                if (response.ok) {
                    const contentType = response.headers.get('content-type') || '';
                    let responseData = '';
                    
                    try {
                        if (contentType.includes('application/json')) {
                            const jsonData = await response.json();
                            responseData = JSON.stringify(jsonData, null, 2);
                        } else {
                            responseData = await response.text();
                        }
                    } catch (e) {
                        responseData = 'Could not parse response data';
                    }

                    card.className = 'status-card success';
                    card.innerHTML = `
                        <div class="status-title">‚úÖ ${name} - SUCCESS</div>
                        <div class="status-detail">${description}</div>
                        <div class="status-detail"><strong>URL:</strong> ${url}</div>
                        <div class="status-detail"><strong>Status:</strong> ${response.status} ${response.statusText}</div>
                        <div class="status-detail"><strong>Response Time:</strong> ${responseTime}ms</div>
                        <div class="status-detail"><strong>Content-Type:</strong> ${contentType}</div>
                        <div class="code-block">${responseData.substring(0, 500)}${responseData.length > 500 ? '...' : ''}</div>
                    `;
                } else {
                    card.className = 'status-card error';
                    card.innerHTML = `
                        <div class="status-title">‚ùå ${name} - FAILED</div>
                        <div class="status-detail">${description}</div>
                        <div class="status-detail"><strong>URL:</strong> ${url}</div>
                        <div class="status-detail"><strong>Status:</strong> ${response.status} ${response.statusText}</div>
                        <div class="status-detail"><strong>Response Time:</strong> ${responseTime}ms</div>
                        <div class="status-detail">Server returned an error status</div>
                    `;
                }
            } catch (error) {
                card.className = 'status-card error';
                card.innerHTML = `
                    <div class="status-title">‚ùå ${name} - CONNECTION ERROR</div>
                    <div class="status-detail">${description}</div>
                    <div class="status-detail"><strong>URL:</strong> ${url}</div>
                    <div class="status-detail"><strong>Error:</strong> ${error.message}</div>
                    <div class="status-detail">This usually indicates network issues or CORS problems</div>
                `;
            }
        }

        // Configuration Analysis
        function addConfigurationCard() {
            const card = document.createElement('div');
            card.className = 'status-card info';
            
            // Try to determine what configuration is being used
            const isDevelopment = window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost';
            const expectedApiUrl = isDevelopment ? '/api/' : 'https://api.rumahdaisycantik.com/';
            
            card.innerHTML = `
                <div class="status-title">‚öôÔ∏è Configuration Analysis</div>
                <div class="status-detail"><strong>Environment:</strong> ${isDevelopment ? 'Development' : 'Production'}</div>
                <div class="status-detail"><strong>Expected API Base:</strong> ${expectedApiUrl}</div>
                <div class="status-detail"><strong>Vite Proxy:</strong> ${isDevelopment ? 'Should be active' : 'Not used in production'}</div>
                <div class="refresh-info">
                    <strong>How it should work:</strong><br>
                    ${isDevelopment ? 
                        'In development, React app calls /api/villa.php ‚Üí Vite proxy forwards to XAMPP ‚Üí PHP returns data' :
                        'In production, React app calls https://api.rumahdaisycantik.com/villa.php directly'
                    }
                </div>
            `;
            diagnosticResults.appendChild(card);
        }

        // Dummy Data Analysis
        function addDummyDataCard() {
            const card = document.createElement('div');
            card.className = 'status-card warning';
            card.innerHTML = `
                <div class="status-title">‚ö†Ô∏è Dummy Data Issue</div>
                <div class="status-detail">Your app is showing <code>src/data/dummy.ts</code> content instead of real API data</div>
                <div class="status-detail"><strong>Root Cause:</strong> API calls are failing, so React hooks fall back to dummy data</div>
                <div class="status-detail"><strong>File Location:</strong> <code>src/data/dummy.ts</code></div>
                <div class="refresh-info">
                    <strong>What's happening:</strong><br>
                    1. Your React app tries to fetch from API<br>
                    2. API call fails (network/proxy/server error)<br>
                    3. App falls back to dummy data in <code>villaData</code><br>
                    4. You see fake "Serene Mountain Retreat" data instead of real villa data
                </div>
            `;
            diagnosticResults.appendChild(card);
        }

        // Solution Steps
        function addSolutionCard() {
            const card = document.createElement('div');
            card.className = 'status-card info';
            card.innerHTML = `
                <div class="status-title">üîß Solution Steps</div>
                <div class="status-detail">Based on test results above, here's what needs to be fixed:</div>
                <div class="refresh-info">
                    <strong>1. Verify XAMPP is running:</strong><br>
                    ‚Ä¢ Apache and MySQL should be running in XAMPP Control Panel<br><br>
                    
                    <strong>2. Check your PHP API:</strong><br>
                    ‚Ä¢ Test direct access: <a href="http://localhost/fontend-bookingengine-100/frontend-booking-engine-1/api/villa.php" target="_blank">Direct PHP Test</a><br><br>
                    
                    <strong>3. Check Vite proxy:</strong><br>
                    ‚Ä¢ Restart dev server if proxy config changed<br>
                    ‚Ä¢ Check console for proxy errors<br><br>
                    
                    <strong>4. Verify database:</strong><br>
                    ‚Ä¢ Ensure your database has villa data<br>
                    ‚Ä¢ Check API responses are valid JSON
                </div>
            `;
            diagnosticResults.appendChild(card);
        }

        // Main diagnostic function
        async function runFullDiagnostic() {
            // Clear previous results
            diagnosticResults.innerHTML = '';
            
            // Add information cards
            addEnvironmentCard();
            addConfigurationCard();
            addDummyDataCard();
            
            // Test different API endpoints
            await testAPIEndpoint(
                'Vite Proxy API', 
                '/api/villa.php',
                'Tests if Vite development proxy is working correctly'
            );
            
            await testAPIEndpoint(
                'Direct XAMPP API', 
                'http://localhost/fontend-bookingengine-100/frontend-booking-engine-1/api/villa.php',
                'Tests direct access to XAMPP PHP API'
            );
            
            await testAPIEndpoint(
                'Production API', 
                'https://api.rumahdaisycantik.com/villa.php',
                'Tests production API server connectivity'
            );

            // Test other endpoints
            await testAPIEndpoint(
                'Rooms API (Vite Proxy)', 
                '/api/rooms.php',
                'Tests rooms endpoint through Vite proxy'
            );

            await testAPIEndpoint(
                'Packages API (Vite Proxy)', 
                '/api/packages.php',
                'Tests packages endpoint through Vite proxy'
            );
            
            // Add solution card at the end
            addSolutionCard();
        }

        // Run diagnostic on page load
        runFullDiagnostic();
    </script>
</body>
</html>