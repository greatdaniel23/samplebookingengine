<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Gallery - Frontend Booking Engine</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #F5F2E8 0%, #E6A500 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            color: #2F3A4F;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .header p {
            color: #7A5C3F;
            font-size: 1.1rem;
        }
        
        .folder-section {
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .folder-title {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2F3A4F;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #E6A500;
            display: flex;
            align-items: center;
        }
        
        .folder-icon {
            background: #E6A500;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.2rem;
        }
        
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .image-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        
        .image-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .image-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 1px solid #eee;
        }
        
        .image-info {
            padding: 15px;
        }
        
        .image-name {
            font-weight: bold;
            color: #2F3A4F;
            margin-bottom: 5px;
            font-size: 0.95rem;
        }
        
        .image-path {
            color: #7A5C3F;
            font-size: 0.85rem;
            word-break: break-all;
        }
        
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #7A5C3F;
            font-size: 1.1rem;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #E6A500;
        }
        
        .stat-label {
            color: #2F3A4F;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
        }
        
        .modal-content {
            position: relative;
            margin: auto;
            display: block;
            max-width: 90%;
            max-height: 90%;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #E6A500;
        }
        
        /* Folder Selector Styles */
        .folder-selector {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .selector-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .selector-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2F3A4F;
            margin: 0;
        }
        
        .selector-actions {
            display: flex;
            gap: 10px;
        }
        
        .folder-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .folder-option {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .folder-option:hover {
            border-color: #E6A500;
            background: #fffbf0;
        }
        
        .folder-option.selected {
            border-color: #E6A500;
            background: #E6A500;
            color: white;
        }
        
        .folder-checkbox {
            margin-right: 12px;
            width: 18px;
            height: 18px;
            accent-color: #E6A500;
        }
        
        .folder-label {
            display: flex;
            align-items: center;
            flex: 1;
            cursor: pointer;
        }
        
        .folder-emoji {
            font-size: 1.2rem;
            margin-right: 10px;
        }
        
        .folder-info {
            flex: 1;
        }
        
        .folder-name {
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .folder-desc {
            font-size: 0.85rem;
            opacity: 0.8;
        }
        
        .action-btn {
            padding: 8px 16px;
            border: 2px solid #E6A500;
            background: white;
            color: #E6A500;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover {
            background: #E6A500;
            color: white;
        }
        
        .action-btn.primary {
            background: #E6A500;
            color: white;
        }
        
        .action-btn.primary:hover {
            background: #2F3A4F;
        }
        
        /* Error image styling */
        .image-card img[src=""], .image-card img[src*="data:image"] {
            border: 2px dashed #E6A500 !important;
            background: #F5F2E8;
        }
        
        .error-img {
            background: repeating-linear-gradient(
                45deg,
                #f0f0f0,
                #f0f0f0 10px,
                #e0e0e0 10px,
                #e0e0e0 20px
            );
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üñºÔ∏è Image Gallery</h1>
            <p>Browse all images in the hosting folder</p>
            <div style="margin-top: 15px; padding: 10px; background: rgba(230, 165, 0, 0.1); border-radius: 8px; font-size: 0.9rem;">
                <strong>üìç Base Path:</strong> <span id="current-path" style="color: #2F3A4F;">Loading...</span>
                <br>
                <strong>üîß Mode:</strong> <span id="scan-mode" style="color: #7A5C3F;">Detecting...</span>
            </div>
            
            <!-- Dynamic Path Detection Panel -->
            <div class="detection-panel" style="margin-top: 15px; padding: 15px; background: rgba(47, 58, 79, 0.1); border-radius: 10px;">
                <div class="detection-status" id="detectionStatus" style="margin-bottom: 10px;">
                    <span style="font-size: 1.2rem;">üîç</span>
                    <span id="statusText" style="margin-left: 8px; color: #2F3A4F;">Detecting image paths...</span>
                </div>
                <button class="search-btn" id="searchBtn" onclick="manualPathDetection()" 
                        style="background: #E6A500; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                    üîé Search for Images
                </button>
                <div class="path-info" id="pathInfo" style="display: none; margin-top: 10px; font-size: 0.85rem;">
                    <strong style="color: #2F3A4F;">Found image locations:</strong>
                    <div class="path-list" id="pathList" style="margin-top: 5px;"></div>
                </div>
            </div>
        </div>

        <!-- Folder Selector -->
        <div class="folder-selector">
            <div class="selector-header">
                <h2 class="selector-title">üìÅ Select Folders to Display</h2>
                <div class="selector-actions">
                    <button class="action-btn" onclick="selectAllFolders()">Select All</button>
                    <button class="action-btn" onclick="deselectAllFolders()">Deselect All</button>
                    <button class="action-btn primary" onclick="loadSelectedFolders()">Update Gallery</button>
                </div>
            </div>
            
            <div class="folder-options" id="folder-options">
                <!-- Folder checkboxes will be generated here -->
            </div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" id="total-images">0</div>
                <div class="stat-label">Total Images</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="total-folders">0</div>
                <div class="stat-label">Selected Folders</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="total-size">0 MB</div>
                <div class="stat-label">Est. Size</div>
            </div>
        </div>

        <div id="gallery-content">
            <div class="loading">Loading images...</div>
        </div>
    </div>

    <!-- Modal for fullscreen image view -->
    <div id="imageModal" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="modalImage">
    </div>

    <script>
        // ===== DYNAMIC HOSTING CONFIGURATION =====
        const CONFIG = {
            // Will be set dynamically after path detection
            basePath: null,
            detectedPaths: [],
            
            // Enable/disable real file scanning (requires PHP)
            enableRealScan: true,
            
            // Fallback mode (uses mock data when real files not accessible)
            useFallback: false,
            
            // Hosting-specific settings
            domain: window.location.hostname,
            protocol: window.location.protocol,
            
            // Detection status
            pathDetectionComplete: false,
            workingPaths: []
        };
        
        // Enhanced path detection for room images with subfolder support
        async function detectWorkingPaths() {
            // Focus specifically on booking domain room images
            const possiblePaths = [
                'https://booking.rumahdaisycantik.com/images/rooms',
                'https://rumahdaisycantik.com/images/rooms',
                '/images/rooms'
            ];
            
            console.log('üîç Testing', possiblePaths.length, 'possible room image paths...');
            
            const workingPaths = [];
            
            // Test each path by trying to scan for images and subfolders
            for (const path of possiblePaths) {
                try {
                    console.log(`Testing path: ${path}`);
                    const testResult = await testImagePath(path);
                    if (testResult.hasImages || testResult.hasSubfolders) {
                        workingPaths.push({
                            path: path,
                            imageCount: testResult.imageCount,
                            subfolderCount: testResult.subfolderCount || 0,
                            sampleImages: testResult.sampleImages,
                            sampleFolders: testResult.sampleFolders || []
                        });
                        
                        const pathInfo = testResult.hasSubfolders ? 
                            `${testResult.subfolderCount} subfolders with images` :
                            `${testResult.imageCount} direct images`;
                        console.log(`‚úÖ Found ${pathInfo} at: ${path}`);
                    }
                } catch (error) {
                    console.log(`‚ùå Failed to access: ${path} - ${error.message}`);
                }
            }
            
            CONFIG.workingPaths = workingPaths;
            CONFIG.detectedPaths = possiblePaths;
            
            if (workingPaths.length > 0) {
                // Prefer paths with subfolders, then by total content
                const bestPath = workingPaths.sort((a, b) => {
                    if (a.subfolderCount !== b.subfolderCount) {
                        return b.subfolderCount - a.subfolderCount; // More subfolders is better
                    }
                    return b.imageCount - a.imageCount; // More images is better
                })[0];
                
                CONFIG.basePath = bestPath.path;
                
                const pathType = bestPath.subfolderCount > 0 ? 'subfolder structure' : 'flat structure';
                console.log(`üéØ Selected best path: ${CONFIG.basePath} (${pathType})`);
            } else {
                CONFIG.useFallback = true;
                console.log('‚ö†Ô∏è No working room image paths found, using fallback mode');
            }
            
            CONFIG.pathDetectionComplete = true;
            updateDetectionUI();
            return workingPaths;
        }
        
        // Test if the room images path contains accessible images or subfolders
        async function testImagePath(basePath) {
            // First, try to discover subfolders within the rooms directory
            try {
                const folderScanUrl = `https://api.rumahdaisycantik.com/image-scanner.php?action=folders&basePath=${encodeURIComponent(basePath)}`;
                const folderResponse = await fetch(folderScanUrl);
                if (folderResponse.ok) {
                    const folderData = await folderResponse.json();
                    if (folderData.success && folderData.folders && folderData.folders.length > 0) {
                        // Found subfolders, test a few for images
                        let totalImages = 0;
                        const sampleFolders = folderData.folders.slice(0, 3);
                        
                        for (const folder of sampleFolders) {
                            try {
                                const folderImageUrl = `https://api.rumahdaisycantik.com/image-scanner.php?folder=${folder}&basePath=${encodeURIComponent(basePath)}`;
                                const imageResponse = await fetch(folderImageUrl);
                                if (imageResponse.ok) {
                                    const imageData = await imageResponse.json();
                                    if (imageData.success && imageData.images) {
                                        totalImages += imageData.images.length;
                                    }
                                }
                            } catch (error) {
                                // Continue with other folders
                            }
                        }
                        
                        return {
                            hasImages: false, // No direct images in root
                            hasSubfolders: true,
                            imageCount: totalImages,
                            subfolderCount: folderData.folders.length,
                            sampleFolders: sampleFolders,
                            sampleImages: []
                        };
                    }
                }
            } catch (error) {
                console.log('Subfolder detection failed, testing for direct images');
            }
            
            // Try to use image-scanner.php for direct room images
            try {
                const scannerUrl = `https://api.rumahdaisycantik.com/image-scanner.php?folder=rooms&basePath=${encodeURIComponent(basePath)}`;
                const response = await fetch(scannerUrl);
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.images && data.images.length > 0) {
                        return {
                            hasImages: true,
                            hasSubfolders: false,
                            imageCount: data.images.length,
                            subfolderCount: 0,
                            sampleImages: data.images.slice(0, 3).map(img => typeof img === 'object' ? img.name : img),
                            sampleFolders: []
                        };
                    }
                }
            } catch (error) {
                console.log('Direct image scanner not available, trying manual test');
            }
            
            // Fallback: try to fetch common room image names directly
            const roomTestImages = [
                'room1.jpg', 'deluxe-room.jpg', 'suite.jpg', 'bedroom.jpg', 
                'pool-view.jpg', 'ocean-view.jpg', 'standard-room.webp'
            ];
            
            let foundImages = 0;
            const sampleImages = [];
            
            for (const testImg of roomTestImages) {
                try {
                    const testUrl = `${basePath}/${testImg}`;
                    const response = await fetch(testUrl, { method: 'HEAD' });
                    if (response.ok) {
                        foundImages++;
                        sampleImages.push(testImg);
                        if (sampleImages.length >= 3) break;
                    }
                } catch (error) {
                    // Continue testing other images
                }
            }
            
            return { 
                hasImages: foundImages > 0,
                hasSubfolders: false,
                imageCount: foundImages,
                subfolderCount: 0,
                sampleImages: sampleImages,
                sampleFolders: []
            };
        }
        
        // Dynamic image folder structure - will be populated after detection
        let imageFolders = [
            {
                name: 'All Images',
                path: 'all',
                icon: 'üì∏',
                description: 'All available images in the directory'
            }
        ];
        
        // Room images folder discovery - discover subfolders within rooms
        async function discoverImageFolders() {
            if (!CONFIG.basePath) {
                return imageFolders; // Return default if no path detected
            }
            
            // Discover subfolders within booking.rumahdaisycantik.com/images/rooms/
            try {
                const response = await fetch(`https://api.rumahdaisycantik.com/image-scanner.php?action=folders&basePath=${encodeURIComponent(CONFIG.basePath)}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.folders && data.folders.length > 0) {
                        // Convert discovered folders to gallery format
                        const discoveredFolders = data.folders.map(folderName => ({
                            name: formatFolderName(folderName),
                            path: folderName,
                            icon: getRoomFolderIcon(folderName),
                            description: getRoomFolderDescription(folderName)
                        }));
                        
                        console.log(`üìÅ Discovered ${discoveredFolders.length} room subfolders`);
                        return discoveredFolders;
                    }
                }
            } catch (error) {
                console.log('Folder discovery failed, using fallback structure');
            }
            
            // Fallback: Return common room folder structure
            return [
                { name: 'Standard Rooms', path: 'standard', icon: 'üõèÔ∏è', description: 'Standard room accommodations' },
                { name: 'Deluxe Rooms', path: 'deluxe', icon: 'üåü', description: 'Deluxe room accommodations' },
                { name: 'Suites', path: 'suites', icon: 'üëë', description: 'Premium suite accommodations' },
                { name: 'Villas', path: 'villas', icon: 'üèñÔ∏è', description: 'Private villa accommodations' }
            ];
        }
        
        // Check if the detected path has subfolders
        async function checkForSubfolders() {
            const testFolders = ['hero', 'packages', 'amenities'];
            
            for (const folder of testFolders) {
                try {
                    const response = await fetch(`https://api.rumahdaisycantik.com/image-scanner.php?folder=${folder}`);
                    if (response.ok) {
                        const data = await response.json();
                        if (data.success && data.images && data.images.length > 0) {
                            return true; // Found images in subfolders
                        }
                    }
                } catch (error) {
                    continue;
                }
            }
            return false; // No subfolders with images found
        }
        
        // Format folder name for display
        function formatFolderName(folderName) {
            if (folderName === 'all') return 'All Images';
            return folderName.charAt(0).toUpperCase() + folderName.slice(1).replace(/[-_]/g, ' ');
        }
        
        // Get appropriate icon for folder
        function getFolderIcon(folderName) {
            const iconMap = {
                'hero': 'üèûÔ∏è',
                'packages': 'üì¶', 
                'amenities': 'üèñÔ∏è',
                'ui': 'üé®',
                'uploads': 'üìÅ',
                'all': 'üì∏',
                'gallery': 'üñºÔ∏è',
                'photos': 'üì∑'
            };
            return iconMap[folderName.toLowerCase()] || 'üìÅ';
        }
        
        // Get description for folder
        function getFolderDescription(folderName) {
            const descMap = {
                'hero': 'Main banner and hero section images',
                'packages': 'Package and offer related images',
                'amenities': 'Resort amenities and facilities',
                'ui': 'User interface elements and icons',
                'uploads': 'User uploaded content',
                'all': 'All available images in the directory',
                'gallery': 'Image gallery collection',
                'photos': 'Photo collection'
            };
            return descMap[folderName.toLowerCase()] || `${formatFolderName(folderName)} folder content`;
        }
        
        // Get appropriate icon for room folders
        function getRoomFolderIcon(folderName) {
            const roomIconMap = {
                'standard': 'üõèÔ∏è',
                'deluxe': 'üåü', 
                'suite': 'üëë',
                'suites': 'üëë',
                'villa': 'üèñÔ∏è',
                'villas': 'üèñÔ∏è',
                'family': 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',
                'ocean': 'üåä',
                'pool': 'üèä‚Äç‚ôÇÔ∏è',
                'garden': 'üå∫',
                'presidential': 'üèÜ',
                'honeymoon': 'üíï',
                'business': 'üíº'
            };
            
            const lowerName = folderName.toLowerCase();
            for (const [key, icon] of Object.entries(roomIconMap)) {
                if (lowerName.includes(key)) {
                    return icon;
                }
            }
            return 'üè®'; // Default room icon
        }
        
        // Get description for room folders
        function getRoomFolderDescription(folderName) {
            const roomDescMap = {
                'standard': 'Standard room accommodations with essential amenities',
                'deluxe': 'Deluxe rooms with enhanced features and comfort',
                'suite': 'Spacious suites with separate living areas',
                'suites': 'Spacious suites with separate living areas',
                'villa': 'Private villas with exclusive amenities',
                'villas': 'Private villas with exclusive amenities',
                'family': 'Family-friendly rooms with extra space',
                'ocean': 'Rooms with stunning ocean views',
                'pool': 'Rooms with pool access or views',
                'garden': 'Rooms overlooking beautiful gardens',
                'presidential': 'The most luxurious presidential accommodations',
                'honeymoon': 'Romantic rooms perfect for couples',
                'business': 'Business-oriented rooms with work facilities'
            };
            
            const lowerName = folderName.toLowerCase();
            for (const [key, desc] of Object.entries(roomDescMap)) {
                if (lowerName.includes(key)) {
                    return desc;
                }
            }
            return `${formatFolderName(folderName)} room images`;
        }

        // Common image extensions
        const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.svg', '.webp', '.bmp'];
        
        let totalImages = 0;
        let totalFolders = 0;
        let selectedFolders = new Set();

        // Initialize with all folders selected
        imageFolders.forEach((_, index) => selectedFolders.add(index));

        // Function to check if a file is an image
        function isImage(filename) {
            return imageExtensions.some(ext => filename.toLowerCase().endsWith(ext));
        }

        // Function to get file size estimate (rough calculation)
        function getEstimatedSize(filename) {
            const ext = filename.toLowerCase();
            if (ext.endsWith('.jpg') || ext.endsWith('.jpeg')) return 0.5; // MB
            if (ext.endsWith('.png')) return 1; // MB
            if (ext.endsWith('.gif')) return 0.3; // MB
            if (ext.endsWith('.svg')) return 0.05; // MB
            if (ext.endsWith('.webp')) return 0.3; // MB
            return 0.5; // Default
        }

        // Function to load images from specific room subfolders
        async function loadFolderImages(folder) {
            // Load from specific subfolder within rooms (e.g., rooms/deluxe, rooms/suites)
            const folderPath = `rooms/${folder.path}`;
            
            if (CONFIG.enableRealScan) {
                try {
                    const images = await loadRealImages(folderPath);
                    if (images && images.length > 0) {
                        return images;
                    }
                } catch (error) {
                    console.log(`Failed to load images from ${folderPath}, using fallback`);
                }
            }
            
            // Fallback to mock images for this specific folder type
            return getFallbackImages(folder.path);
        }
        
        // Manual path detection trigger
        async function manualPathDetection() {
            const searchBtn = document.getElementById('searchBtn');
            const statusText = document.getElementById('statusText');
            
            searchBtn.disabled = true;
            searchBtn.innerHTML = '‚è≥ Searching...';
            statusText.textContent = 'Scanning all possible image locations...';
            
            try {
                const workingPaths = await detectWorkingPaths();
                
                if (workingPaths.length > 0) {
                    statusText.innerHTML = `‚úÖ Found ${workingPaths.length} working path(s)`;
                    showPathResults(workingPaths);
                    // Refresh the gallery with new path
                    initializeGallery();
                } else {
                    statusText.innerHTML = '‚ùå No accessible image paths found';
                }
            } catch (error) {
                statusText.innerHTML = '‚ö†Ô∏è Detection failed: ' + error.message;
            }
            
            searchBtn.disabled = false;
            searchBtn.innerHTML = 'üîé Search for Images';
        }
        
        // Update detection UI
        function updateDetectionUI() {
            const statusText = document.getElementById('statusText');
            const pathInfo = document.getElementById('pathInfo');
            
            if (CONFIG.pathDetectionComplete) {
                if (CONFIG.workingPaths.length > 0) {
                    statusText.innerHTML = `‚úÖ Active path: <strong>${CONFIG.basePath}</strong>`;
                    showPathResults(CONFIG.workingPaths);
                } else {
                    statusText.innerHTML = '‚ùå No working paths found - using fallback';
                }
            }
        }
        
        // Show path detection results
        function showPathResults(workingPaths) {
            const pathInfo = document.getElementById('pathInfo');
            const pathList = document.getElementById('pathList');
            
            pathList.innerHTML = '';
            
            workingPaths.forEach((pathResult, index) => {
                const pathItem = document.createElement('div');
                pathItem.style.cssText = 'margin: 5px 0; padding: 8px; background: rgba(255,255,255,0.7); border-radius: 4px; border-left: 3px solid #E6A500;';
                
                const isActive = pathResult.path === CONFIG.basePath;
                pathItem.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: ${isActive ? 'bold' : 'normal'}; color: ${isActive ? '#E6A500' : '#2F3A4F'};">
                            ${isActive ? 'üéØ' : 'üìÅ'} ${pathResult.path}
                        </span>
                        <span style="color: #7A5C3F; font-size: 0.8rem;">${pathResult.imageCount} images</span>
                    </div>
                    ${pathResult.sampleImages.length > 0 ? 
                        `<div style="margin-top: 5px; color: #666; font-size: 0.75rem;">Sample: ${pathResult.sampleImages.slice(0, 3).join(', ')}</div>` : ''
                    }
                `;
                
                if (!isActive) {
                    pathItem.style.cursor = 'pointer';
                    pathItem.onclick = () => switchToPath(pathResult.path);
                }
                
                pathList.appendChild(pathItem);
            });
            
            pathInfo.style.display = 'block';
        }
        
        // Switch to a different detected path
        function switchToPath(newPath) {
            CONFIG.basePath = newPath;
            updateDetectionUI();
            initializeGallery();
            console.log(`Switched to path: ${newPath}`);
        }
        
        // Function to scan real images from room subfolders using PHP backend
        async function loadRealImages(folderPath) {
            // Scan specific subfolder (e.g., 'rooms/deluxe', 'rooms/suites')
            if (CONFIG.basePath) {
                try {
                    const response = await fetch(`https://api.rumahdaisycantik.com/image-scanner.php?folder=${encodeURIComponent(folderPath)}&basePath=${encodeURIComponent(CONFIG.basePath)}`);
                    if (response.ok) {
                        const data = await response.json();
                        if (data.success && data.images) {
                            // Extract image names from the response
                            const imageNames = data.images.map(img => {
                                if (typeof img === 'object' && img.name) {
                                    return img.name;
                                }
                                return img;
                            });
                            console.log(`üì∏ Found ${imageNames.length} images in ${folderPath}`);
                            return imageNames;
                        }
                    }
                } catch (error) {
                    console.log(`Image scanner failed for ${folderPath}, trying alternative`);
                }
            }
            
            // Fallback scanner without custom basePath
            try {
                const response = await fetch(`https://api.rumahdaisycantik.com/image-scanner.php?folder=${encodeURIComponent(folderPath)}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.images) {
                        const imageNames = data.images.map(img => {
                            if (typeof img === 'object' && img.name) {
                                return img.name;
                            }
                            return img;
                        });
                        return imageNames;
                    }
                }
            } catch (error) {
                console.log(`Image scanner not available for ${folderPath}, using fallback`);
            }
            return null;
        }
        
        // Fallback mock images for different room types
        function getFallbackImages(folderPath) {
            const mockImages = {
                'standard': [
                    'standard-room-1.jpg', 'standard-room-2.webp', 'standard-bathroom.jpg',
                    'standard-twin-beds.jpg', 'standard-balcony.webp'
                ],
                'deluxe': [
                    'deluxe-suite-1.jpg', 'deluxe-bedroom.webp', 'deluxe-bathroom.jpg',
                    'deluxe-living-area.jpg', 'deluxe-balcony-view.webp'
                ],
                'suites': [
                    'presidential-suite.jpg', 'honeymoon-suite.webp', 'junior-suite-balcony.jpg',
                    'suite-living-room.jpg', 'suite-master-bedroom.webp'
                ],
                'villas': [
                    'family-villa-bedroom.jpg', 'villa-pool-view.webp', 'villa-garden.jpg',
                    'villa-terrace.jpg', 'villa-kitchen.webp'
                ],
                'ocean': [
                    'ocean-view-room.jpg', 'ocean-suite-balcony.webp', 'ocean-terrace.jpg'
                ],
                'pool': [
                    'pool-view-suite.webp', 'pool-access-room.jpg', 'poolside-villa.jpg'
                ],
                'garden': [
                    'garden-view-room.jpg', 'garden-suite-terrace.webp', 'garden-villa.jpg'
                ],
                'family': [
                    'family-room-bunk-beds.jpg', 'family-suite-living.webp', 'family-villa.jpg'
                ],
                'business': [
                    'business-room.jpg', 'business-desk-area.webp', 'business-meeting-space.jpg'
                ]
            };
            
            // Return images for specific room type or empty array
            return mockImages[folderPath] || [];
        }

        // Function to create room image card HTML for subfolder structure
        function createImageCard(imageName, folderPath, folderName) {
            // Room images are in basePath/subfolder (e.g., booking.rumahdaisycantik.com/images/rooms/deluxe/)
            const imagePath = `${CONFIG.basePath}/${folderPath}/${imageName}`;
            const estimatedSize = getEstimatedSize(imageName);
            
            return `
                <div class="image-card" onclick="openModal('${imagePath}')">
                    <img src="${imagePath}" alt="${imageName}" 
                         onerror="handleImageError(this, '${imageName}')"
                         loading="lazy">
                    <div class="image-info">
                        <div class="image-name">${imageName}</div>
                        <div class="image-path">${folderName} ‚Ä¢ ~${estimatedSize.toFixed(1)} MB</div>
                    </div>
                </div>
            `;
        }

        // Function to create folder section
        function createFolderSection(folder, images) {
            if (images.length === 0) {
                return `
                    <div class="folder-section">
                        <div class="folder-title">
                            <div class="folder-icon">${folder.icon}</div>
                            ${folder.name}
                        </div>
                        <div class="error-message">No images found in this folder</div>
                    </div>
                `;
            }

            const imageCards = images.map(img => createImageCard(img, folder.path, folder.name)).join('');
            
            return `
                <div class="folder-section">
                    <div class="folder-title">
                        <div class="folder-icon">${folder.icon}</div>
                        ${folder.name} (${images.length} images)
                    </div>
                    <p style="color: #7A5C3F; margin-bottom: 15px; font-style: italic;">${folder.description}</p>
                    <div class="image-grid">
                        ${imageCards}
                    </div>
                </div>
            `;
        }

        // Function to update statistics
        function updateStats() {
            document.getElementById('total-images').textContent = totalImages;
            document.getElementById('total-folders').textContent = totalFolders;
            document.getElementById('total-size').textContent = `${(totalImages * 0.5).toFixed(1)} MB`;
        }

        // Function to open modal
        function openModal(imagePath) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modal.style.display = 'block';
            modalImg.src = imagePath;
        }

        // Close modal functionality
        document.querySelector('.close').onclick = function() {
            document.getElementById('imageModal').style.display = 'none';
        }

        // Handle image loading errors with multiple fallback options
        function handleImageError(img, imageName) {
            const fallbacks = [
                createDataURLPlaceholder(imageName),
                'data:image/svg+xml;base64,' + btoa(`
                    <svg width="200" height="150" xmlns="http://www.w3.org/2000/svg">
                        <rect width="100%" height="100%" fill="#f0f0f0" stroke="#ddd" stroke-width="2"/>
                        <text x="50%" y="40%" text-anchor="middle" fill="#999" font-size="14" font-family="Arial">
                            Image Not Found
                        </text>
                        <text x="50%" y="60%" text-anchor="middle" fill="#666" font-size="10" font-family="Arial">
                            ${imageName}
                        </text>
                    </svg>
                `),
                'data:image/svg+xml;base64,' + btoa(`
                    <svg width="200" height="150" xmlns="http://www.w3.org/2000/svg">
                        <rect width="100%" height="100%" fill="#E6A500" opacity="0.1"/>
                        <text x="50%" y="50%" text-anchor="middle" fill="#E6A500" font-size="20">
                            üì∑
                        </text>
                    </svg>
                `)
            ];
            
            // Try fallbacks in sequence
            let currentFallback = 0;
            
            const tryNextFallback = () => {
                if (currentFallback < fallbacks.length) {
                    img.src = fallbacks[currentFallback];
                    img.style.opacity = '0.7';
                    img.style.border = '2px dashed #ddd';
                    currentFallback++;
                } else {
                    // Final fallback - solid color
                    img.style.background = 'linear-gradient(45deg, #f0f0f0 25%, transparent 25%), linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #f0f0f0 75%), linear-gradient(-45deg, transparent 75%, #f0f0f0 75%)';
                    img.style.backgroundSize = '20px 20px';
                    img.style.backgroundPosition = '0 0, 0 10px, 10px -10px, -10px 0px';
                    img.src = '';
                    img.style.minHeight = '150px';
                }
            };
            
            img.onerror = tryNextFallback;
            tryNextFallback();
        }
        
        // Create a data URL placeholder with the image name
        function createDataURLPlaceholder(imageName) {
            const canvas = document.createElement('canvas');
            canvas.width = 200;
            canvas.height = 150;
            const ctx = canvas.getContext('2d');
            
            // Background
            ctx.fillStyle = '#F5F2E8';
            ctx.fillRect(0, 0, 200, 150);
            
            // Border
            ctx.strokeStyle = '#E6A500';
            ctx.lineWidth = 2;
            ctx.strokeRect(0, 0, 200, 150);
            
            // Icon
            ctx.font = '30px Arial';
            ctx.fillStyle = '#E6A500';
            ctx.textAlign = 'center';
            ctx.fillText('üì∑', 100, 60);
            
            // Text
            ctx.font = '12px Arial';
            ctx.fillStyle = '#7A5C3F';
            ctx.fillText('Image Not Found', 100, 90);
            
            ctx.font = '10px Arial';
            ctx.fillStyle = '#999';
            const shortName = imageName.length > 20 ? imageName.substring(0, 20) + '...' : imageName;
            ctx.fillText(shortName, 100, 110);
            
            return canvas.toDataURL();
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('imageModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // Function to generate folder selector checkboxes (dynamic)
        async function generateFolderSelector() {
            const folderOptions = document.getElementById('folder-options');
            
            // Discover available folders first
            imageFolders = await discoverImageFolders();
            
            // Reset selected folders to match discovered structure
            selectedFolders.clear();
            imageFolders.forEach((_, index) => selectedFolders.add(index));
            
            const checkboxes = imageFolders.map((folder, index) => {
                const isSelected = selectedFolders.has(index);
                return `
                    <div class="folder-option ${isSelected ? 'selected' : ''}" onclick="toggleFolder(${index})">
                        <input type="checkbox" class="folder-checkbox" ${isSelected ? 'checked' : ''} 
                               onchange="event.stopPropagation(); toggleFolder(${index})">
                        <div class="folder-label">
                            <span class="folder-emoji">${folder.icon}</span>
                            <div class="folder-info">
                                <div class="folder-name">${folder.name}</div>
                                <div class="folder-desc">${folder.description}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            folderOptions.innerHTML = checkboxes;
            
            // Update the selector title based on structure type
            const selectorTitle = document.querySelector('.selector-title');
            if (imageFolders.length === 1 && imageFolders[0].path === 'all') {
                selectorTitle.textContent = 'üì∏ Display Options';
                // Hide folder selection for flat structure, show all by default
                document.querySelector('.folder-selector').style.display = 'none';
            } else {
                selectorTitle.textContent = 'üìÅ Select Folders to Display';
                document.querySelector('.folder-selector').style.display = 'block';
            }
        }
        
        // Function to toggle folder selection
        function toggleFolder(index) {
            const folderOption = document.querySelectorAll('.folder-option')[index];
            const checkbox = folderOption.querySelector('.folder-checkbox');
            
            if (selectedFolders.has(index)) {
                selectedFolders.delete(index);
                folderOption.classList.remove('selected');
                checkbox.checked = false;
            } else {
                selectedFolders.add(index);
                folderOption.classList.add('selected');
                checkbox.checked = true;
            }
        }
        
        // Function to select all folders
        function selectAllFolders() {
            imageFolders.forEach((_, index) => selectedFolders.add(index));
            document.querySelectorAll('.folder-option').forEach((option, index) => {
                option.classList.add('selected');
                option.querySelector('.folder-checkbox').checked = true;
            });
        }
        
        // Function to deselect all folders
        function deselectAllFolders() {
            selectedFolders.clear();
            document.querySelectorAll('.folder-option').forEach(option => {
                option.classList.remove('selected');
                option.querySelector('.folder-checkbox').checked = false;
            });
        }
        
        // Function to load only selected folders
        async function loadSelectedFolders() {
            if (selectedFolders.size === 0) {
                alert('Please select at least one folder to display.');
                return;
            }
            
            const galleryContent = document.getElementById('gallery-content');
            galleryContent.innerHTML = '<div class="loading">Loading selected folders...</div>';

            let allSections = '';
            totalImages = 0;
            totalFolders = selectedFolders.size;

            for (let i = 0; i < imageFolders.length; i++) {
                if (selectedFolders.has(i)) {
                    const folder = imageFolders[i];
                    try {
                        const images = await loadFolderImages(folder);
                        totalImages += images.length;
                        allSections += createFolderSection(folder, images);
                    } catch (error) {
                        console.error(`Error loading folder ${folder.name}:`, error);
                        allSections += createFolderSection(folder, []);
                    }
                }
            }

            galleryContent.innerHTML = allSections || '<div class="error-message">No folders selected</div>';
            updateStats();
        }

        // Main function to load all images (now loads selected folders)
        async function loadAllImages() {
            generateFolderSelector();
            await loadSelectedFolders();
        }

        // Initialize the gallery system
        async function initializeGallery() {
            // Show current configuration
            document.getElementById('current-path').textContent = CONFIG.basePath || 'Detecting...';
            document.getElementById('scan-mode').textContent = CONFIG.enableRealScan ? 'Real File Scanning + Fallback' : 'Fallback Mode Only';
            
            await loadAllImages();
        }
        
        // Load images when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            // Start automatic path detection
            console.log('üöÄ Starting automatic path detection...');
            
            try {
                await detectWorkingPaths();
            } catch (error) {
                console.error('Automatic detection failed:', error);
                CONFIG.useFallback = true;
            }
            
            // Initialize the gallery with detected or fallback paths
            await initializeGallery();
        });
    </script>
</body>
</html>